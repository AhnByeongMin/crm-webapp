<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚´ ì˜ˆì•½ ê´€ë¦¬</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1400px; margin: 0 auto; }

        /* ë ˆì´ì•„ì›ƒ */
        .main-layout { display: grid; grid-template-columns: 420px 1fr; gap: 20px; margin-top: 20px; align-items: start; }

        /* ìº˜ë¦°ë” ì˜ì—­ */
        .calendar-section { background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); height: fit-content; position: sticky; top: 20px; }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #667eea; }
        .calendar-header h3 { font-size: 18px; color: #333; }
        .calendar-nav { display: flex; gap: 10px; margin-bottom: 15px; }
        .calendar-nav button { background: #667eea; color: white; border: none; border-radius: 4px; padding: 8px 16px; cursor: pointer; font-size: 14px; transition: all 0.2s; }
        .calendar-nav button:hover { background: #5568d3; transform: translateY(-1px); box-shadow: 0 2px 6px rgba(102, 126, 234, 0.3); }
        .calendar-month { font-size: 18px; font-weight: bold; color: #667eea; margin-bottom: 15px; text-align: center; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; }
        .calendar-day-header { text-align: center; font-size: 12px; font-weight: bold; color: #666; padding: 10px 0; background: #f8f9fa; border-radius: 4px; }
        .calendar-day-header.sunday { color: #dc3545; }
        .calendar-day-header.saturday { color: #0066ff; }
        .calendar-day { aspect-ratio: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 14px; border-radius: 6px; cursor: pointer; position: relative; transition: all 0.2s; background: #f8f9fa; border: 2px solid transparent; }
        .calendar-day:hover { background: #e9ecef; transform: translateY(-2px); box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
        .calendar-day.other-month { color: #ccc; opacity: 0.5; }
        .calendar-day.sunday { color: #dc3545; }
        .calendar-day.saturday { color: #0066ff; }
        .calendar-day.holiday { color: #dc3545; font-weight: bold; }
        .calendar-day.today { background: #667eea; color: white !important; font-weight: bold; border-color: #667eea; }
        .calendar-day.has-reminder { background: #fff3cd; font-weight: bold; border: 2px solid #ffc107; }
        .calendar-day.has-reminder.today { background: #dc3545; border-color: #dc3545; color: white !important; }
        .calendar-day.selected { background: #667eea; color: white !important; border-color: #5568d3; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2); }
        .reminder-count { font-size: 10px; margin-top: 2px; padding: 2px 6px; background: rgba(220, 53, 69, 0.9); color: white; border-radius: 10px; font-weight: bold; min-width: 18px; text-align: center; }
        .holiday-name { font-size: 9px; color: #dc3545; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); white-space: nowrap; }

        /* í†µê³„ ë°•ìŠ¤ */
        .stats-box { background: #667eea; color: white; border-radius: 8px; padding: 15px; margin-top: 15px; }
        .stats-box h4 { font-size: 14px; margin-bottom: 12px; }
        .stats-item { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px; }
        .stats-item:last-child { margin-bottom: 0; }
        .stats-value { font-weight: bold; font-size: 16px; }

        /* í•„í„° ì˜ì—­ */
        .filter-section { padding: 15px 20px; background: white; border-radius: 8px 8px 0 0; border-bottom: 1px solid #e9ecef; display: flex; align-items: center; gap: 15px; flex-wrap: wrap; margin-bottom: 0; }
        .filter-section label { display: flex; align-items: center; gap: 8px; cursor: pointer; }

        /* ë²„íŠ¼ */
        .btn-primary { padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; transition: all 0.2s; box-shadow: 0 2px 4px rgba(102, 126, 234, 0.2); }
        .btn-primary:hover { background: #5568d3; transform: translateY(-1px); box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3); }
        .btn-success { padding: 6px 12px; background: #28a745; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; transition: all 0.2s; box-shadow: 0 1px 3px rgba(40, 167, 69, 0.2); }
        .btn-success:hover { background: #218838; transform: translateY(-1px); box-shadow: 0 2px 6px rgba(40, 167, 69, 0.3); }
        .btn-danger { padding: 6px 12px; background: #dc3545; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; transition: all 0.2s; box-shadow: 0 1px 3px rgba(220, 53, 69, 0.2); }
        .btn-danger:hover { background: #c82333; transform: translateY(-1px); box-shadow: 0 2px 6px rgba(220, 53, 69, 0.3); }
        .btn-secondary { padding: 6px 12px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; transition: all 0.2s; box-shadow: 0 1px 3px rgba(108, 117, 125, 0.2); }
        .btn-secondary:hover { background: #5a6268; transform: translateY(-1px); box-shadow: 0 2px 6px rgba(108, 117, 125, 0.3); }

        /* ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ ì˜ì—­ */
        .reminders-section { background: white; border-radius: 0 0 8px 8px; padding: 20px; height: calc(100vh - 130px); max-height: calc(100vh - 130px); overflow-y: auto; }
        .reminders-wrapper { position: sticky; top: 20px; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); background: white; }
        .reminders-section::-webkit-scrollbar { width: 8px; }
        .reminders-section::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        .reminders-section::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        .reminders-section::-webkit-scrollbar-thumb:hover { background: #555; }

        /* ì˜ˆì•½ ì¹´ë“œ */
        .reminders-grid { display: grid; gap: 15px; }
        .reminder-card { background: white; border: 1px solid #ddd; border-radius: 8px; padding: 20px; transition: all 0.3s; position: relative; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .reminder-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.15); transform: translateY(-2px); }
        .reminder-card.completed { opacity: 0.6; background: #f8f9fa; }
        .reminder-card.today { border-left: 4px solid #dc3545; background: #fff5f5; }
        .reminder-card.upcoming { border-left: 4px solid #ffc107; background: #fffbf0; }
        .reminder-card.past { border-left: 4px solid #6c757d; }

        .reminder-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px; }
        .reminder-title { font-size: 18px; font-weight: bold; color: #333; margin-bottom: 8px; }
        .reminder-datetime { display: flex; align-items: center; gap: 8px; color: #666; font-size: 14px; margin-bottom: 8px; }
        .reminder-content { color: #666; line-height: 1.5; margin-bottom: 15px; }
        .reminder-actions { display: flex; gap: 8px; }

        .badge { display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: bold; }
        .badge-today { background: #dc3545; color: white; }
        .badge-upcoming { background: #ffc107; color: #000; }
        .badge-past { background: #6c757d; color: white; }
        .badge-completed { background: #28a745; color: white; }

        .empty-state { text-align: center; padding: 60px 20px; color: #999; }
        .empty-state-icon { font-size: 64px; margin-bottom: 20px; }

        /* ëª¨ë‹¬ */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; align-items: center; justify-content: center; }
        .modal-overlay.active { display: flex; }
        .modal-box { background: white; border-radius: 8px; padding: 30px; max-width: 500px; width: 90%; box-shadow: 0 4px 20px rgba(0,0,0,0.3); }
        .modal-title { font-size: 20px; font-weight: bold; margin-bottom: 20px; color: #333; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        .form-group input, .form-group textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
        .form-group textarea { min-height: 100px; resize: vertical; }
        .modal-buttons { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }

        /* í† ìŠ¤íŠ¸ */
        .toast-container { position: fixed; bottom: 20px; right: 20px; z-index: 10000; display: flex; flex-direction: column; gap: 10px; max-width: 350px; }
        .toast { background: white; padding: 15px 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); transform: translateX(400px); animation: slideIn 0.3s forwards; border-left: 4px solid #667eea; }
        .toast.slide-out { animation: slideOut 0.3s forwards; }
        @keyframes slideIn { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes slideOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(400px); opacity: 0; } }

        /* ì•Œë¦¼ ë°°ë„ˆ */
        .alert-banner { padding: 15px; border-radius: 4px; margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }
        .alert-banner.info { background: #d1ecf1; border-left: 4px solid #0c5460; color: #0c5460; }
        .alert-banner.warning { background: #fff3cd; border-left: 4px solid #856404; color: #856404; }
        .alert-banner.danger { background: #f8d7da; border-left: 4px solid #721c24; color: #721c24; }

        /* ë„ì›€ë§ ë²„íŠ¼ */
        .help-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            z-index: 9997;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .help-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.6);
        }
        .help-button:active {
            transform: scale(0.95);
        }

        /* ë„ì›€ë§ ëª¨ë‹¬ */
        .help-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10001;
            align-items: center;
            justify-content: center;
        }
        .help-modal.active {
            display: flex;
        }
        .help-modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            animation: slideUpModal 0.3s ease-out;
        }
        @keyframes slideUpModal {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .help-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #667eea;
        }
        .help-modal-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .help-modal-close {
            background: none;
            border: none;
            font-size: 28px;
            color: #999;
            cursor: pointer;
            transition: color 0.2s;
        }
        .help-modal-close:hover {
            color: #333;
        }
        .help-section {
            margin-bottom: 25px;
        }
        .help-section-title {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .help-content {
            color: #555;
            line-height: 1.8;
            font-size: 15px;
        }
        .help-content ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .help-content li {
            margin: 8px 0;
        }
        .help-content strong {
            color: #333;
            font-weight: 600;
        }
        .help-tip {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .help-tip strong {
            color: #667eea;
        }
    </style>
    <script src="/static/js/banner.js" defer></script>
</head>
<body>
    <div class="toast-container" id="toastContainer"></div>

    <div class="container">
        {% include 'includes/header.html' %}

        <div class="main-layout">
            <!-- ìº˜ë¦°ë” ì˜ì—­ -->
            <div class="calendar-section">
                <div class="calendar-header">
                    <h3>ğŸ“… ìº˜ë¦°ë”</h3>
                    <div style="display: flex; gap: 6px;">
                        <button style="padding: 6px 12px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; transition: all 0.2s; box-shadow: 0 1px 3px rgba(108, 117, 125, 0.2);" onmouseover="this.style.background='#5a6268'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 2px 6px rgba(108, 117, 125, 0.3)';" onmouseout="this.style.background='#6c757d'; this.style.transform='translateY(0)'; this.style.boxShadow='0 1px 3px rgba(108, 117, 125, 0.2)';" onclick="clearDateFilter()" id="clearFilterBtn" style="display: none;">ì „ì²´</button>
                        <button style="padding: 6px 12px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; transition: all 0.2s; box-shadow: 0 1px 3px rgba(102, 126, 234, 0.2);" onmouseover="this.style.background='#5568d3'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 2px 6px rgba(102, 126, 234, 0.3)';" onmouseout="this.style.background='#667eea'; this.style.transform='translateY(0)'; this.style.boxShadow='0 1px 3px rgba(102, 126, 234, 0.2)';" onclick="goToToday()">ì˜¤ëŠ˜</button>
                    </div>
                </div>
                <div class="calendar-nav">
                    <button onclick="changeMonth(-1)">â—€ ì´ì „</button>
                    <button onclick="changeMonth(1)">ë‹¤ìŒ â–¶</button>
                </div>
                <div class="calendar-month" id="calendarMonth"></div>
                <div class="calendar-grid" id="calendarGrid">
                    <!-- ìš”ì¼ í—¤ë” -->
                    <div class="calendar-day-header sunday">ì¼</div>
                    <div class="calendar-day-header">ì›”</div>
                    <div class="calendar-day-header">í™”</div>
                    <div class="calendar-day-header">ìˆ˜</div>
                    <div class="calendar-day-header">ëª©</div>
                    <div class="calendar-day-header">ê¸ˆ</div>
                    <div class="calendar-day-header saturday">í† </div>
                    <!-- ë‚ ì§œëŠ” JSë¡œ ìƒì„± -->
                </div>

                <!-- í†µê³„ ë°•ìŠ¤ -->
                <div class="stats-box">
                    <h4>ğŸ“Š ì˜ˆì•½ í†µê³„</h4>
                    <div class="stats-item">
                        <span>ì „ì²´</span>
                        <span class="stats-value" id="totalCount">0</span>
                    </div>
                    <div class="stats-item">
                        <span>ë¯¸ì™„ë£Œ</span>
                        <span class="stats-value" id="pendingCount">0</span>
                    </div>
                    <div class="stats-item">
                        <span>ì™„ë£Œ</span>
                        <span class="stats-value" id="completedCount">0</span>
                    </div>
                </div>
            </div>

            <!-- ì˜ˆì•½ ëª©ë¡ ì˜ì—­ -->
            <div class="reminders-wrapper">
                <div class="filter-section">
                    <button class="btn-primary" onclick="openAddModal()">+ ìƒˆ ì˜ˆì•½ ì¶”ê°€</button>
                    <label>
                        <input type="checkbox" id="showCompleted" onchange="loadReminders()">
                        <span>ì™„ë£Œëœ í•­ëª© ë³´ê¸°</span>
                    </label>
                    <input type="text" id="searchKeyword" placeholder="ê²€ìƒ‰..." onkeyup="loadReminders()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 200px; margin-left: auto;">
                </div>
                <div class="reminders-section">
                    <div id="alertBanners"></div>
                    <div id="remindersContainer">
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“…</div>
                            <p>ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% include 'includes/today_reminders.html' %}

    <script>
        // ì „ì—­ ë³€ìˆ˜ë“¤ì€ reminder_modal.htmlì—ì„œ ì´ë¯¸ ì„ ì–¸ë¨
        // let currentEditingId = null;
        // let selectedDate = null;
        let allReminders = []; // ì „ì²´ ì˜ˆì•½ ë°ì´í„° (í†µê³„ìš©)
        let currentYear = new Date().getFullYear();
        let currentMonth = new Date().getMonth();
        let holidays = {}; // ê³µíœ´ì¼ ë°ì´í„° (APIì—ì„œ ë¡œë“œ)

        // ê³µíœ´ì¼ ë°ì´í„° ë¡œë“œ
        async function loadHolidays(year) {
            try {
                const response = await fetch(`/api/holidays?year=${year}`);
                const data = await response.json();
                // í•´ë‹¹ ë…„ë„ì˜ ê³µíœ´ì¼ ë°ì´í„° ë³‘í•©
                Object.assign(holidays, data);
            } catch (error) {
                console.error('ê³µíœ´ì¼ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', async () => {
            // í˜„ì¬ ë…„ë„ì™€ ë‹¤ìŒ ë…„ë„ ê³µíœ´ì¼ ë¡œë“œ
            await loadHolidays(currentYear);
            if (currentMonth === 11) {
                await loadHolidays(currentYear + 1);
            }

            loadReminders();
            renderCalendar();
        });

        // ìº˜ë¦°ë” ë Œë”ë§
        function renderCalendar() {
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const prevLastDay = new Date(currentYear, currentMonth, 0);

            const firstDayOfWeek = firstDay.getDay();
            const lastDate = lastDay.getDate();
            const prevLastDate = prevLastDay.getDate();

            const monthNames = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
            document.getElementById('calendarMonth').textContent = `${currentYear}ë…„ ${monthNames[currentMonth]}`;

            const grid = document.getElementById('calendarGrid');
            const dayHeaders = grid.querySelectorAll('.calendar-day-header');
            grid.innerHTML = '';
            dayHeaders.forEach(header => grid.appendChild(header));

            const today = new Date();
            const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;

            // ì´ì „ ë‹¬ ë‚ ì§œ
            for (let i = firstDayOfWeek - 1; i >= 0; i--) {
                const day = prevLastDate - i;
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day other-month';
                dayEl.textContent = day;
                grid.appendChild(dayEl);
            }

            // í˜„ì¬ ë‹¬ ë‚ ì§œ
            for (let day = 1; day <= lastDate; day++) {
                const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day';

                // ìš”ì¼ ê³„ì‚° (0=ì¼ìš”ì¼, 6=í† ìš”ì¼)
                const dayOfWeek = new Date(currentYear, currentMonth, day).getDay();

                // ë‚ ì§œ ìˆ«ì
                const dateNum = document.createElement('div');
                dateNum.textContent = day;
                dayEl.appendChild(dateNum);

                // ìš”ì¼ë³„ ìƒ‰ìƒ
                if (dayOfWeek === 0) {
                    dayEl.classList.add('sunday');
                } else if (dayOfWeek === 6) {
                    dayEl.classList.add('saturday');
                }

                // ê³µíœ´ì¼ í‘œì‹œ
                if (holidays[dateStr]) {
                    dayEl.classList.add('holiday');
                }

                if (dateStr === todayStr) {
                    dayEl.classList.add('today');
                }

                if (selectedDate === dateStr) {
                    dayEl.classList.add('selected');
                }

                // ì˜ˆì•½ì´ ìˆëŠ” ë‚ ì§œ í‘œì‹œ + ê°œìˆ˜ í‘œì‹œ
                const remindersOnDate = allReminders.filter(r => r.scheduled_date === dateStr);
                if (remindersOnDate.length > 0) {
                    dayEl.classList.add('has-reminder');
                    const countEl = document.createElement('div');
                    countEl.className = 'reminder-count';
                    countEl.textContent = remindersOnDate.length;
                    dayEl.appendChild(countEl);
                }

                dayEl.onclick = () => selectDate(dateStr);
                grid.appendChild(dayEl);
            }

            // ë‹¤ìŒ ë‹¬ ë‚ ì§œ
            const remainingDays = 42 - (firstDayOfWeek + lastDate);
            for (let day = 1; day <= remainingDays; day++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day other-month';
                dayEl.textContent = day;
                grid.appendChild(dayEl);
            }
        }

        // ì›” ë³€ê²½
        async function changeMonth(delta) {
            currentMonth += delta;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
                await loadHolidays(currentYear);
            } else if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
                await loadHolidays(currentYear);
            }
            renderCalendar();
        }

        // ì˜¤ëŠ˜ë¡œ ì´ë™
        function goToToday() {
            const today = new Date();
            currentYear = today.getFullYear();
            currentMonth = today.getMonth();
            const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            selectedDate = todayStr;
            updateClearFilterButton();
            renderCalendar();
            loadReminders();
        }

        // ë‚ ì§œ ì„ íƒ
        function selectDate(dateStr) {
            selectedDate = dateStr;
            updateClearFilterButton();
            renderCalendar();
            loadReminders();
        }

        // ë‚ ì§œ í•„í„° ì´ˆê¸°í™”
        function clearDateFilter() {
            selectedDate = null;
            updateClearFilterButton();
            renderCalendar();
            loadReminders();
        }

        // "ì „ì²´" ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€ ì—…ë°ì´íŠ¸
        function updateClearFilterButton() {
            const btn = document.getElementById('clearFilterBtn');
            if (selectedDate) {
                btn.style.display = 'block';
            } else {
                btn.style.display = 'none';
            }
        }

        // ì˜ˆì•½ ëª©ë¡ ë¡œë“œ
        async function loadReminders() {
            const showCompleted = document.getElementById('showCompleted').checked;

            // í•­ìƒ ì „ì²´ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (í†µê³„ìš©)
            const allResponse = await fetch(`/api/reminders?show_completed=true`);
            allReminders = await allResponse.json();

            // í‘œì‹œìš© ë°ì´í„°
            const response = await fetch(`/api/reminders?show_completed=${showCompleted}`);
            let reminders = await response.json();

            // ê²€ìƒ‰ í•„í„°ë§
            const keyword = document.getElementById('searchKeyword').value.toLowerCase();
            if (keyword) {
                reminders = reminders.filter(r =>
                    r.title.toLowerCase().includes(keyword) ||
                    (r.content && r.content.toLowerCase().includes(keyword))
                );
            }

            // ë‚ ì§œ í•„í„°ë§ (ìº˜ë¦°ë”ì—ì„œ ì„ íƒí•œ ë‚ ì§œ)
            if (selectedDate) {
                reminders = reminders.filter(r => r.scheduled_date === selectedDate);
            }

            renderReminders(reminders);
            updateStats(allReminders); // í•­ìƒ ì „ì²´ ë°ì´í„°ë¡œ í†µê³„ ê³„ì‚°
            updateAlertBanners(reminders);
            renderCalendar(); // ìº˜ë¦°ë” ì—…ë°ì´íŠ¸
        }

        // ì˜ˆì•½ ëª©ë¡ ë Œë”ë§
        function renderReminders(reminders) {
            const container = document.getElementById('remindersContainer');

            if (reminders.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“…</div>
                        <p>${selectedDate ? selectedDate + 'ì— ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤' : 'ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤'}</p>
                    </div>
                `;
                return;
            }

            const today = new Date().toISOString().split('T')[0];
            const now = new Date();

            const todayReminders = [];
            const upcomingReminders = [];
            const pastReminders = [];

            reminders.forEach(r => {
                const reminderDate = r.scheduled_date;
                const reminderDateTime = new Date(`${r.scheduled_date}T${r.scheduled_time}`);

                if (reminderDate === today) {
                    todayReminders.push(r);
                } else if (reminderDateTime > now) {
                    upcomingReminders.push(r);
                } else {
                    pastReminders.push(r);
                }
            });

            let html = '<div class="reminders-grid">';

            if (todayReminders.length > 0) {
                todayReminders.forEach(r => {
                    html += renderReminderCard(r, 'today');
                });
            }

            upcomingReminders.forEach(r => {
                html += renderReminderCard(r, 'upcoming');
            });

            pastReminders.forEach(r => {
                html += renderReminderCard(r, 'past');
            });

            html += '</div>';
            container.innerHTML = html;
        }

        // ì˜ˆì•½ ì¹´ë“œ ë Œë”ë§
        function renderReminderCard(reminder, type) {
            const completed = reminder.is_completed === 1;
            const completedClass = completed ? 'completed' : '';

            let badge = '';
            if (type === 'today') badge = '<span class="badge badge-today">ğŸ”´ ì˜¤ëŠ˜</span>';
            else if (type === 'upcoming') badge = '<span class="badge badge-upcoming">â° ì˜ˆì •</span>';
            else if (type === 'past') badge = '<span class="badge badge-past">ğŸ“‹ ì§€ë‚¨</span>';

            if (completed) badge = '<span class="badge badge-completed">âœ… ì™„ë£Œ</span>';

            return `
                <div class="reminder-card ${type} ${completedClass}">
                    <div class="reminder-header">
                        <div>
                            <div class="reminder-title">${escapeHtml(reminder.title)}</div>
                            <div class="reminder-datetime">
                                ğŸ“… ${reminder.scheduled_date} ${reminder.scheduled_time}
                                ${badge}
                            </div>
                        </div>
                    </div>
                    ${reminder.content ? `<div class="reminder-content">${escapeHtml(reminder.content)}</div>` : ''}
                    <div class="reminder-actions">
                        <button class="btn-success" onclick="toggleComplete(${reminder.id})">
                            ${completed ? 'ë¯¸ì™„ë£Œë¡œ ë³€ê²½' : 'ì™„ë£Œ ì²˜ë¦¬'}
                        </button>
                        <button class="btn-secondary" onclick="openEditModal(${reminder.id})">ìˆ˜ì •</button>
                        <button class="btn-danger" onclick="deleteReminder(${reminder.id})">ì‚­ì œ</button>
                    </div>
                </div>
            `;
        }

        // í†µê³„ ì—…ë°ì´íŠ¸ (í•­ìƒ ì „ì²´ ë°ì´í„° ê¸°ì¤€)
        function updateStats(allData) {
            const total = allData.length;
            const completed = allData.filter(r => r.is_completed === 1).length;
            const pending = total - completed;

            document.getElementById('totalCount').textContent = total;
            document.getElementById('pendingCount').textContent = pending;
            document.getElementById('completedCount').textContent = completed;
        }

        // ì•Œë¦¼ ë°°ë„ˆ ì—…ë°ì´íŠ¸
        function updateAlertBanners(reminders) {
            const container = document.getElementById('alertBanners');
            const today = new Date().toISOString().split('T')[0];
            const now = new Date();

            const todayReminders = reminders.filter(r => r.scheduled_date === today && r.is_completed === 0);
            const pastReminders = reminders.filter(r => {
                const reminderDateTime = new Date(`${r.scheduled_date}T${r.scheduled_time}`);
                return reminderDateTime < now && r.is_completed === 0 && r.scheduled_date !== today;
            });

            let html = '';

            if (todayReminders.length > 0) {
                html += `
                    <div class="alert-banner danger">
                        <strong>ğŸ”´ ì˜¤ëŠ˜ ì˜ˆì•½ ${todayReminders.length}ê±´</strong>ì´ ìˆìŠµë‹ˆë‹¤!
                    </div>
                `;
            }

            if (pastReminders.length > 0) {
                html += `
                    <div class="alert-banner warning">
                        <strong>âš ï¸ ì§€ë‚œ ì˜ˆì•½ ${pastReminders.length}ê±´</strong>ì´ ë¯¸ì™„ë£Œ ìƒíƒœì…ë‹ˆë‹¤.
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        // ì™„ë£Œ ìƒíƒœ í† ê¸€
        async function toggleComplete(id) {
            const response = await fetch(`/api/reminders/${id}/complete`, { method: 'PATCH' });
            if (response.ok) {
                showToast('ì„±ê³µ', 'ì™„ë£Œ ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
                loadReminders();
            }
        }

        // ì˜ˆì•½ ì‚­ì œ
        async function deleteReminder(id) {
            if (!confirm('ì´ ì˜ˆì•½ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            const response = await fetch(`/api/reminders/${id}`, { method: 'DELETE' });
            if (response.ok) {
                showToast('ì„±ê³µ', 'ì˜ˆì•½ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                loadReminders();
            }
        }

        // í† ìŠ¤íŠ¸ ì•Œë¦¼
        function showToast(title, message) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `
                <div style="flex: 1;">
                    <div style="font-weight: bold; margin-bottom: 4px;">${escapeHtml(title)}</div>
                    <div style="font-size: 13px; color: #666;">${escapeHtml(message)}</div>
                </div>
            `;

            container.appendChild(toast);

            setTimeout(() => {
                toast.classList.add('slide-out');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // HTML ì´ìŠ¤ì¼€ì´í”„
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ë„ì›€ë§ ëª¨ë‹¬ ì œì–´
        function openHelpModal() {
            document.getElementById('helpModal').classList.add('active');
        }

        function closeHelpModal() {
            document.getElementById('helpModal').classList.remove('active');
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.addEventListener('DOMContentLoaded', () => {
            const helpModal = document.getElementById('helpModal');
            if (helpModal) {
                helpModal.addEventListener('click', (e) => {
                    if (e.target === helpModal) {
                        closeHelpModal();
                    }
                });
            }
        });

    </script>

    <!-- ë„ì›€ë§ ë²„íŠ¼ -->
    <button class="help-button" onclick="openHelpModal()" title="ì‚¬ìš©ë²• ë„ì›€ë§">
        â“
    </button>

    <!-- ë„ì›€ë§ ëª¨ë‹¬ -->
    <div class="help-modal" id="helpModal">
        <div class="help-modal-content">
            <div class="help-modal-header">
                <div class="help-modal-title">
                    ğŸ“– ë‚´ ì˜ˆì•½ ê´€ë¦¬ ì‚¬ìš©ë²•
                </div>
                <button class="help-modal-close" onclick="closeHelpModal()">&times;</button>
            </div>

            <div class="help-section">
                <div class="help-section-title">ğŸ“… ìº˜ë¦°ë” ì‚¬ìš©í•˜ê¸°</div>
                <div class="help-content">
                    <ul>
                        <li><strong>ë‚ ì§œ í´ë¦­</strong>: í•´ë‹¹ ë‚ ì§œì˜ ì˜ˆì•½ë§Œ í‘œì‹œ</li>
                        <li><strong>ë‹¤ì‹œ í´ë¦­</strong>: í•„í„° í•´ì œ (ì „ì²´ ì˜ˆì•½ í‘œì‹œ)</li>
                        <li><strong>ë…¸ë€ìƒ‰ í‘œì‹œ</strong>: ì˜ˆì•½ì´ ìˆëŠ” ë‚ ì§œ</li>
                        <li><strong>ë¹¨ê°„ìƒ‰ í‘œì‹œ</strong>: ì˜¤ëŠ˜ ì˜ˆì•½ì´ ìˆëŠ” ë‚ ì§œ</li>
                        <li><strong>ì˜¤ëŠ˜ ë²„íŠ¼</strong>: í˜„ì¬ ì›”ë¡œ ì´ë™</li>
                    </ul>
                </div>
            </div>

            <div class="help-section">
                <div class="help-section-title">ğŸ“Š í†µê³„ ì •ë³´</div>
                <div class="help-content">
                    <ul>
                        <li><strong>ì „ì²´</strong>: ëª¨ë“  ì˜ˆì•½ ê°œìˆ˜</li>
                        <li><strong>ë¯¸ì™„ë£Œ</strong>: ì•„ì§ ì™„ë£Œë˜ì§€ ì•Šì€ ì˜ˆì•½</li>
                        <li><strong>ì™„ë£Œ</strong>: ì™„ë£Œ ì²˜ë¦¬ëœ ì˜ˆì•½</li>
                        <li>í†µê³„ëŠ” <strong>í•„í„°ì™€ ë¬´ê´€í•˜ê²Œ í•­ìƒ ì „ì²´ ë°ì´í„°</strong> ê¸°ì¤€ì…ë‹ˆë‹¤</li>
                    </ul>
                </div>
            </div>

            <div class="help-section">
                <div class="help-section-title">ğŸ“ ì˜ˆì•½ ì¶”ê°€í•˜ê¸°</div>
                <div class="help-content">
                    <ul>
                        <li><strong>"+ ìƒˆ ì˜ˆì•½ ì¶”ê°€"</strong> ë²„íŠ¼ í´ë¦­</li>
                        <li>ìº˜ë¦°ë”ì—ì„œ ë‚ ì§œë¥¼ ì„ íƒí•œ ìƒíƒœë©´ ìë™ìœ¼ë¡œ ë‚ ì§œ ì…ë ¥ë¨</li>
                        <li><strong>ê°œì¸ì •ë³´ ë³´í˜¸</strong>: ì „í™”ë²ˆí˜¸ ì…ë ¥ ì‹œ ì €ì¥ì´ ì°¨ë‹¨ë©ë‹ˆë‹¤</li>
                    </ul>
                </div>
            </div>

            <div class="help-section">
                <div class="help-section-title">ğŸ” ê²€ìƒ‰ ë° í•„í„°</div>
                <div class="help-content">
                    <ul>
                        <li><strong>ê²€ìƒ‰ì°½</strong>: ì œëª©ì´ë‚˜ ë‚´ìš©ìœ¼ë¡œ ê²€ìƒ‰</li>
                        <li><strong>ì™„ë£Œëœ í•­ëª© ë³´ê¸°</strong>: ì²´í¬í•˜ë©´ ì™„ë£Œëœ ì˜ˆì•½ë„ í‘œì‹œ</li>
                        <li><strong>ìº˜ë¦°ë” ë‚ ì§œ ì„ íƒ</strong>: íŠ¹ì • ë‚ ì§œì˜ ì˜ˆì•½ë§Œ í‘œì‹œ</li>
                    </ul>
                </div>
            </div>

            <div class="help-tip">
                <strong>ğŸ’¡ ê°œì¸ì •ë³´ ë³´í˜¸:</strong> ì „í™”ë²ˆí˜¸ ëŒ€ì‹  ìƒë‹´ë²ˆí˜¸(CO), ê³ ê°ë²ˆí˜¸(CU), ë˜ëŠ” ì´ë¦„ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”.
            </div>
        </div>
    </div>
</body>
</html>
