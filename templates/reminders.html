<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚´ ì˜ˆì•½ ê´€ë¦¬</title>

    <!-- PWA ë©”íƒ€ íƒœê·¸ -->
    <meta name="description" content="ë‚´ ì˜ˆì•½ ê´€ë¦¬">
    <meta name="theme-color" content="#667eea">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="í•˜ë£¨CRM">
    <link rel="manifest" href="/static/manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="/static/icon-192.png">
    <link rel="apple-touch-icon" href="/static/icon-192.png">

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <!-- Service Worker ë“±ë¡ì€ ê°€ì¥ ë¨¼ì € -->
    <script src="/static/js/sw-register.js"></script>
    <!-- ê·¸ ë‹¤ìŒ auto-updateì™€ push-notifications -->
    <script src="/static/js/sw-auto-update.js"></script>
    <script src="/static/js/push-notifications.js" defer></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1400px; margin: 0 auto; }

        /* ë ˆì´ì•„ì›ƒ */
        .main-layout { display: grid; grid-template-columns: 420px 1fr; gap: 20px; margin-top: 20px; align-items: start; }

        /* ìº˜ë¦°ë” ì˜ì—­ */
        .calendar-section { background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); height: fit-content; position: sticky; top: 20px; }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #667eea; }
        .calendar-header h3 { font-size: 18px; color: #333; }
        .calendar-nav { display: flex; gap: 10px; margin-bottom: 15px; }
        .calendar-nav button { background: #667eea; color: white; border: none; border-radius: 4px; padding: 8px 16px; cursor: pointer; font-size: 14px; transition: all 0.2s; }
        .calendar-nav button:hover { background: #5568d3; transform: translateY(-1px); box-shadow: 0 2px 6px rgba(102, 126, 234, 0.3); }
        .calendar-month { font-size: 18px; font-weight: bold; color: #667eea; margin-bottom: 15px; text-align: center; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; }
        .calendar-day-header { text-align: center; font-size: 12px; font-weight: bold; color: #666; padding: 10px 0; background: #f8f9fa; border-radius: 4px; }
        .calendar-day-header.sunday { color: #dc3545; }
        .calendar-day-header.saturday { color: #0066ff; }
        .calendar-day { aspect-ratio: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 14px; border-radius: 6px; cursor: pointer; position: relative; transition: all 0.2s; background: #f8f9fa; border: 2px solid transparent; }
        .calendar-day:hover { background: #e9ecef; transform: translateY(-2px); box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
        .calendar-day.other-month { color: #ccc; opacity: 0.5; }
        .calendar-day.sunday { color: #dc3545; }
        .calendar-day.saturday { color: #0066ff; }
        .calendar-day.holiday { color: #dc3545; font-weight: bold; }
        .calendar-day.today { background: #667eea; color: white !important; font-weight: bold; border-color: #667eea; }
        .calendar-day.has-reminder { background: #fff3cd; font-weight: bold; border: 2px solid #ffc107; }
        .calendar-day.has-reminder.today { background: #dc3545; border-color: #dc3545; color: white !important; }
        .calendar-day.selected { background: #667eea; color: white !important; border-color: #5568d3; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2); }
        .reminder-count { font-size: 10px; margin-top: 2px; padding: 2px 6px; background: rgba(220, 53, 69, 0.9); color: white; border-radius: 10px; font-weight: bold; min-width: 18px; text-align: center; }
        .holiday-name { font-size: 9px; color: #dc3545; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); white-space: nowrap; }

        /* í†µê³„ ë°•ìŠ¤ */
        .stats-box { background: #667eea; color: white; border-radius: 8px; padding: 15px; margin-top: 15px; }
        .stats-box h4 { font-size: 14px; margin-bottom: 12px; }
        .stats-item { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px; }
        .stats-item:last-child { margin-bottom: 0; }
        .stats-value { font-weight: bold; font-size: 16px; }

        /* í•„í„° ì˜ì—­ */
        .filter-section { padding: 15px 20px; background: white; border-radius: 8px 8px 0 0; border-bottom: 1px solid #e9ecef; display: flex; align-items: center; gap: 15px; flex-wrap: wrap; margin-bottom: 0; }
        .filter-section label { display: flex; align-items: center; gap: 8px; cursor: pointer; }

        /* ë²„íŠ¼ */
        .btn-primary { padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; transition: all 0.2s; box-shadow: 0 2px 4px rgba(102, 126, 234, 0.2); }
        .btn-primary:hover { background: #5568d3; transform: translateY(-1px); box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3); }
        .btn-success { padding: 6px 12px; background: #28a745; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; transition: all 0.2s; box-shadow: 0 1px 3px rgba(40, 167, 69, 0.2); }
        .btn-success:hover { background: #218838; transform: translateY(-1px); box-shadow: 0 2px 6px rgba(40, 167, 69, 0.3); }
        .btn-danger { padding: 6px 12px; background: #dc3545; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; transition: all 0.2s; box-shadow: 0 1px 3px rgba(220, 53, 69, 0.2); }
        .btn-danger:hover { background: #c82333; transform: translateY(-1px); box-shadow: 0 2px 6px rgba(220, 53, 69, 0.3); }
        .btn-secondary { padding: 6px 12px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; transition: all 0.2s; box-shadow: 0 1px 3px rgba(108, 117, 125, 0.2); }
        .btn-secondary:hover { background: #5a6268; transform: translateY(-1px); box-shadow: 0 2px 6px rgba(108, 117, 125, 0.3); }

        /* ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ ì˜ì—­ */
        .reminders-section { background: white; border-radius: 0 0 8px 8px; padding: 20px; height: calc(100vh - 130px); max-height: calc(100vh - 130px); overflow-y: auto; }
        .reminders-wrapper { position: sticky; top: 20px; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); background: white; }
        .reminders-section::-webkit-scrollbar { width: 8px; }
        .reminders-section::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        .reminders-section::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        .reminders-section::-webkit-scrollbar-thumb:hover { background: #555; }

        /* ì˜ˆì•½ ì¹´ë“œ */
        .reminders-grid { display: grid; gap: 15px; }
        .reminder-card { background: white; border: 1px solid #ddd; border-radius: 8px; padding: 20px; transition: all 0.3s; position: relative; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .reminder-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.15); transform: translateY(-2px); }
        .reminder-card.completed { opacity: 0.6; background: #f8f9fa; }
        .reminder-card.today { border-left: 4px solid #dc3545; background: #fff5f5; }
        .reminder-card.upcoming { border-left: 4px solid #ffc107; background: #fffbf0; }
        .reminder-card.past { border-left: 4px solid #6c757d; }

        .reminder-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px; }
        .reminder-title { font-size: 18px; font-weight: bold; color: #333; margin-bottom: 8px; }
        .reminder-datetime { display: flex; align-items: center; gap: 8px; color: #666; font-size: 14px; margin-bottom: 8px; }
        .reminder-content { color: #666; line-height: 1.5; margin-bottom: 15px; }
        .reminder-actions { display: flex; gap: 8px; }

        .badge { display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: bold; }
        .badge-today { background: #dc3545; color: white; }
        .badge-upcoming { background: #ffc107; color: #000; }
        .badge-past { background: #6c757d; color: white; }
        .badge-completed { background: #28a745; color: white; }

        .empty-state { text-align: center; padding: 60px 20px; color: #999; }
        .empty-state-icon { font-size: 64px; margin-bottom: 20px; }

        /* ëª¨ë‹¬ */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; align-items: center; justify-content: center; }
        .modal-overlay.active { display: flex; }
        .modal-box { background: white; border-radius: 8px; padding: 30px; max-width: 500px; width: 90%; box-shadow: 0 4px 20px rgba(0,0,0,0.3); }
        .modal-title { font-size: 20px; font-weight: bold; margin-bottom: 20px; color: #333; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        .form-group input, .form-group textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
        .form-group textarea { min-height: 100px; resize: vertical; }
        .modal-buttons { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }

        /* í† ìŠ¤íŠ¸ */
        .toast-container { position: fixed; bottom: 20px; right: 20px; z-index: 10000; display: flex; flex-direction: column; gap: 10px; max-width: 350px; }
        .toast { background: white; padding: 15px 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); transform: translateX(400px); animation: slideIn 0.3s forwards; border-left: 4px solid #667eea; }
        .toast.slide-out { animation: slideOut 0.3s forwards; }
        @keyframes slideIn { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes slideOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(400px); opacity: 0; } }

        /* ì•Œë¦¼ ë°°ë„ˆ */
        .alert-banner { padding: 15px; border-radius: 4px; margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }
        .alert-banner.info { background: #d1ecf1; border-left: 4px solid #0c5460; color: #0c5460; }
        .alert-banner.warning { background: #fff3cd; border-left: 4px solid #856404; color: #856404; }
        .alert-banner.danger { background: #f8d7da; border-left: 4px solid #721c24; color: #721c24; }

        /* ë„ì›€ë§ ì„¹ì…˜ (ì˜ˆì•½ í˜ì´ì§€ ì „ìš©) */
        .help-section {
            margin-bottom: 25px;
        }
        .help-section-title {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• (768px ì´í•˜) */
        @media (max-width: 768px) {
            body { padding: 10px; }

            /* ê·¸ë¦¬ë“œë¥¼ ì„¸ë¡œ ë°°ì¹˜ë¡œ ë³€ê²½ */
            .main-layout {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            /* ìº˜ë¦°ë” ì„¹ì…˜ - sticky í•´ì œ */
            .calendar-section {
                position: static;
                padding: 15px;
            }

            /* ìº˜ë¦°ë” ê·¸ë¦¬ë“œ ì¡°ì • */
            .calendar-day {
                font-size: 12px;
            }
            .calendar-day-header {
                font-size: 11px;
                padding: 8px 0;
            }
            .reminder-count {
                font-size: 9px;
                padding: 1px 4px;
                min-width: 14px;
            }
            .holiday-name {
                font-size: 8px;
            }

            /* ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ ì˜ì—­ */
            .reminders-wrapper {
                position: static;
            }
            .reminders-section {
                height: auto;
                max-height: none;
                padding: 15px;
            }

            /* í•„í„° ì„¹ì…˜ */
            .filter-section {
                padding: 12px 15px;
                gap: 10px;
            }
            .filter-section label {
                font-size: 14px;
            }

            /* ì˜ˆì•½ ì¹´ë“œ */
            .reminder-card {
                padding: 15px;
            }
            .reminder-title {
                font-size: 16px;
            }
            .reminder-actions {
                flex-wrap: wrap;
            }
            .reminder-actions button {
                min-height: 44px;
                padding: 10px 14px;
            }

            /* ë²„íŠ¼ í„°ì¹˜ ì˜ì—­ í™•ë³´ */
            .btn-primary, .btn-success, .btn-danger, .btn-secondary {
                min-height: 44px;
                padding: 10px 16px;
            }
            .calendar-nav button {
                min-height: 44px;
                padding: 10px 14px;
            }

            /* í†µê³„ ë°•ìŠ¤ */
            .stats-box {
                padding: 12px;
            }
            .stats-item {
                font-size: 13px;
            }
        }

        /* ì‘ì€ ëª¨ë°”ì¼ (480px ì´í•˜) */
        @media (max-width: 480px) {
            .calendar-header h3 {
                font-size: 16px;
            }
            .calendar-month {
                font-size: 16px;
            }
            .calendar-nav {
                gap: 5px;
            }
            .calendar-nav button {
                padding: 8px 10px;
                font-size: 13px;
            }
            .reminder-header {
                flex-direction: column;
                gap: 8px;
            }
            .reminder-datetime {
                font-size: 13px;
            }
        }
    </style>
    <script src="/static/js/banner.js" defer></script>
    <script src="/static/js/keyboard-shortcuts.js" defer></script>
</head>
<body>
    <div class="toast-container" id="toastContainer"></div>

    <div class="container">
        {% include 'includes/header.html' %}

        <div class="main-layout">
            <!-- ìº˜ë¦°ë” ì˜ì—­ -->
            <div class="calendar-section">
                <div class="calendar-header">
                    <h3>ğŸ“… ìº˜ë¦°ë”</h3>
                    <div style="display: flex; gap: 6px;">
                        <button style="padding: 6px 12px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; transition: all 0.2s; box-shadow: 0 1px 3px rgba(108, 117, 125, 0.2);" onmouseover="this.style.background='#5a6268'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 2px 6px rgba(108, 117, 125, 0.3)';" onmouseout="this.style.background='#6c757d'; this.style.transform='translateY(0)'; this.style.boxShadow='0 1px 3px rgba(108, 117, 125, 0.2)';" onclick="clearDateFilter()" id="clearFilterBtn" style="display: none;">ì „ì²´</button>
                        <button style="padding: 6px 12px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; transition: all 0.2s; box-shadow: 0 1px 3px rgba(102, 126, 234, 0.2);" onmouseover="this.style.background='#5568d3'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 2px 6px rgba(102, 126, 234, 0.3)';" onmouseout="this.style.background='#667eea'; this.style.transform='translateY(0)'; this.style.boxShadow='0 1px 3px rgba(102, 126, 234, 0.2)';" onclick="goToToday()">ì˜¤ëŠ˜</button>
                    </div>
                </div>
                <div class="calendar-nav">
                    <button onclick="changeMonth(-1)">â—€ ì´ì „</button>
                    <button onclick="changeMonth(1)">ë‹¤ìŒ â–¶</button>
                </div>
                <div class="calendar-month" id="calendarMonth"></div>
                <div class="calendar-grid" id="calendarGrid">
                    <!-- ìš”ì¼ í—¤ë” -->
                    <div class="calendar-day-header sunday">ì¼</div>
                    <div class="calendar-day-header">ì›”</div>
                    <div class="calendar-day-header">í™”</div>
                    <div class="calendar-day-header">ìˆ˜</div>
                    <div class="calendar-day-header">ëª©</div>
                    <div class="calendar-day-header">ê¸ˆ</div>
                    <div class="calendar-day-header saturday">í† </div>
                    <!-- ë‚ ì§œëŠ” JSë¡œ ìƒì„± -->
                </div>

                <!-- í†µê³„ ë°•ìŠ¤ -->
                <div class="stats-box">
                    <h4>ğŸ“Š ì˜ˆì•½ í†µê³„</h4>
                    <div class="stats-item">
                        <span>ì „ì²´</span>
                        <span class="stats-value" id="totalCount">0</span>
                    </div>
                    <div class="stats-item">
                        <span>ë¯¸ì™„ë£Œ</span>
                        <span class="stats-value" id="pendingCount">0</span>
                    </div>
                    <div class="stats-item">
                        <span>ì™„ë£Œ</span>
                        <span class="stats-value" id="completedCount">0</span>
                    </div>
                </div>

                <!-- ì•Œë¦¼ ì„¤ì • ë²„íŠ¼ -->
                <button onclick="openNotificationSettingsModal()" style="width: 100%; margin-top: 15px; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.3s;">
                    ğŸ”” ì•Œë¦¼ ì„¤ì •
                </button>
            </div>

            <!-- ì˜ˆì•½ ëª©ë¡ ì˜ì—­ -->
            <div class="reminders-wrapper">
                <div class="filter-section">
                    <button class="btn-primary" onclick="openAddModal()">+ ìƒˆ ì˜ˆì•½ ì¶”ê°€</button>
                    <label>
                        <input type="checkbox" id="showCompleted" onchange="loadReminders()">
                        <span>ì™„ë£Œëœ í•­ëª© ë³´ê¸°</span>
                    </label>
                    <input type="text" id="searchKeyword" placeholder="ê²€ìƒ‰..." onkeyup="loadReminders()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 200px; margin-left: auto;">
                </div>
                <div class="reminders-section">
                    <div id="alertBanners"></div>
                    <div id="remindersContainer">
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“…</div>
                            <p>ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% include 'includes/today_reminders.html' %}

    <script>
        // ì „ì—­ ë³€ìˆ˜ë“¤ì€ reminder_modal.htmlì—ì„œ ì´ë¯¸ ì„ ì–¸ë¨
        // let currentEditingId = null;
        // let selectedDate = null;
        let allReminders = []; // ì „ì²´ ì˜ˆì•½ ë°ì´í„° (í†µê³„ìš©)
        let currentYear = new Date().getFullYear();
        let currentMonth = new Date().getMonth();
        let holidays = {}; // ê³µíœ´ì¼ ë°ì´í„° (APIì—ì„œ ë¡œë“œ)

        // ê³µíœ´ì¼ ë°ì´í„° ë¡œë“œ
        async function loadHolidays(year) {
            try {
                const response = await fetch(`/api/holidays?year=${year}`);
                const data = await response.json();
                // í•´ë‹¹ ë…„ë„ì˜ ê³µíœ´ì¼ ë°ì´í„° ë³‘í•©
                Object.assign(holidays, data);
            } catch (error) {
                console.error('ê³µíœ´ì¼ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', async () => {
            // í˜„ì¬ ë…„ë„ì™€ ë‹¤ìŒ ë…„ë„ ê³µíœ´ì¼ ë¡œë“œ
            await loadHolidays(currentYear);
            if (currentMonth === 11) {
                await loadHolidays(currentYear + 1);
            }

            loadReminders();
            renderCalendar();
        });

        // ìº˜ë¦°ë” ë Œë”ë§
        function renderCalendar() {
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const prevLastDay = new Date(currentYear, currentMonth, 0);

            const firstDayOfWeek = firstDay.getDay();
            const lastDate = lastDay.getDate();
            const prevLastDate = prevLastDay.getDate();

            const monthNames = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
            document.getElementById('calendarMonth').textContent = `${currentYear}ë…„ ${monthNames[currentMonth]}`;

            const grid = document.getElementById('calendarGrid');
            const dayHeaders = grid.querySelectorAll('.calendar-day-header');
            grid.innerHTML = '';
            dayHeaders.forEach(header => grid.appendChild(header));

            const today = new Date();
            const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;

            // ì´ì „ ë‹¬ ë‚ ì§œ
            for (let i = firstDayOfWeek - 1; i >= 0; i--) {
                const day = prevLastDate - i;
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day other-month';
                dayEl.textContent = day;
                grid.appendChild(dayEl);
            }

            // í˜„ì¬ ë‹¬ ë‚ ì§œ
            for (let day = 1; day <= lastDate; day++) {
                const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day';

                // ìš”ì¼ ê³„ì‚° (0=ì¼ìš”ì¼, 6=í† ìš”ì¼)
                const dayOfWeek = new Date(currentYear, currentMonth, day).getDay();

                // ë‚ ì§œ ìˆ«ì
                const dateNum = document.createElement('div');
                dateNum.textContent = day;
                dayEl.appendChild(dateNum);

                // ìš”ì¼ë³„ ìƒ‰ìƒ
                if (dayOfWeek === 0) {
                    dayEl.classList.add('sunday');
                } else if (dayOfWeek === 6) {
                    dayEl.classList.add('saturday');
                }

                // ê³µíœ´ì¼ í‘œì‹œ
                if (holidays[dateStr]) {
                    dayEl.classList.add('holiday');
                }

                if (dateStr === todayStr) {
                    dayEl.classList.add('today');
                }

                if (selectedDate === dateStr) {
                    dayEl.classList.add('selected');
                }

                // ì˜ˆì•½ì´ ìˆëŠ” ë‚ ì§œ í‘œì‹œ + ê°œìˆ˜ í‘œì‹œ
                const remindersOnDate = allReminders.filter(r => r.scheduled_date === dateStr);
                if (remindersOnDate.length > 0) {
                    dayEl.classList.add('has-reminder');
                    const countEl = document.createElement('div');
                    countEl.className = 'reminder-count';
                    countEl.textContent = remindersOnDate.length;
                    dayEl.appendChild(countEl);
                }

                dayEl.onclick = () => selectDate(dateStr);
                grid.appendChild(dayEl);
            }

            // ë‹¤ìŒ ë‹¬ ë‚ ì§œ
            const remainingDays = 42 - (firstDayOfWeek + lastDate);
            for (let day = 1; day <= remainingDays; day++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day other-month';
                dayEl.textContent = day;
                grid.appendChild(dayEl);
            }
        }

        // ì›” ë³€ê²½
        async function changeMonth(delta) {
            currentMonth += delta;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
                await loadHolidays(currentYear);
            } else if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
                await loadHolidays(currentYear);
            }
            renderCalendar();
        }

        // ì˜¤ëŠ˜ë¡œ ì´ë™
        function goToToday() {
            const today = new Date();
            currentYear = today.getFullYear();
            currentMonth = today.getMonth();
            const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            selectedDate = todayStr;
            updateClearFilterButton();
            renderCalendar();
            loadReminders();
        }

        // ë‚ ì§œ ì„ íƒ
        function selectDate(dateStr) {
            selectedDate = dateStr;
            updateClearFilterButton();
            renderCalendar();
            loadReminders();
        }

        // ë‚ ì§œ í•„í„° ì´ˆê¸°í™”
        function clearDateFilter() {
            selectedDate = null;
            updateClearFilterButton();
            renderCalendar();
            loadReminders();
        }

        // "ì „ì²´" ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€ ì—…ë°ì´íŠ¸
        function updateClearFilterButton() {
            const btn = document.getElementById('clearFilterBtn');
            if (selectedDate) {
                btn.style.display = 'block';
            } else {
                btn.style.display = 'none';
            }
        }

        // ì˜ˆì•½ ëª©ë¡ ë¡œë“œ
        async function loadReminders() {
            const showCompleted = document.getElementById('showCompleted').checked;

            // í•­ìƒ ì „ì²´ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (í†µê³„ìš©)
            const allResponse = await fetch(`/api/reminders?show_completed=true`);
            allReminders = await allResponse.json();

            // í‘œì‹œìš© ë°ì´í„°
            const response = await fetch(`/api/reminders?show_completed=${showCompleted}`);
            let reminders = await response.json();

            // ê²€ìƒ‰ í•„í„°ë§
            const keyword = document.getElementById('searchKeyword').value.toLowerCase();
            if (keyword) {
                reminders = reminders.filter(r =>
                    r.title.toLowerCase().includes(keyword) ||
                    (r.content && r.content.toLowerCase().includes(keyword))
                );
            }

            // ë‚ ì§œ í•„í„°ë§ (ìº˜ë¦°ë”ì—ì„œ ì„ íƒí•œ ë‚ ì§œ)
            if (selectedDate) {
                reminders = reminders.filter(r => r.scheduled_date === selectedDate);
            }

            renderReminders(reminders);
            updateStats(allReminders); // í•­ìƒ ì „ì²´ ë°ì´í„°ë¡œ í†µê³„ ê³„ì‚°
            updateAlertBanners(reminders);
            renderCalendar(); // ìº˜ë¦°ë” ì—…ë°ì´íŠ¸
        }

        // ì˜ˆì•½ ëª©ë¡ ë Œë”ë§
        function renderReminders(reminders) {
            const container = document.getElementById('remindersContainer');

            if (reminders.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“…</div>
                        <p>${selectedDate ? selectedDate + 'ì— ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤' : 'ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤'}</p>
                    </div>
                `;
                return;
            }

            const today = new Date().toISOString().split('T')[0];
            const now = new Date();

            const todayReminders = [];
            const upcomingReminders = [];
            const pastReminders = [];

            reminders.forEach(r => {
                const reminderDate = r.scheduled_date;
                const reminderDateTime = new Date(`${r.scheduled_date}T${r.scheduled_time}`);

                if (reminderDate === today) {
                    todayReminders.push(r);
                } else if (reminderDateTime > now) {
                    upcomingReminders.push(r);
                } else {
                    pastReminders.push(r);
                }
            });

            let html = '<div class="reminders-grid">';

            if (todayReminders.length > 0) {
                todayReminders.forEach(r => {
                    html += renderReminderCard(r, 'today');
                });
            }

            upcomingReminders.forEach(r => {
                html += renderReminderCard(r, 'upcoming');
            });

            pastReminders.forEach(r => {
                html += renderReminderCard(r, 'past');
            });

            html += '</div>';
            container.innerHTML = html;
        }

        // ì˜ˆì•½ ì¹´ë“œ ë Œë”ë§
        function renderReminderCard(reminder, type) {
            const completed = reminder.is_completed === 1;
            const completedClass = completed ? 'completed' : '';

            let badge = '';
            if (type === 'today') badge = '<span class="badge badge-today">ğŸ”´ ì˜¤ëŠ˜</span>';
            else if (type === 'upcoming') badge = '<span class="badge badge-upcoming">â° ì˜ˆì •</span>';
            else if (type === 'past') badge = '<span class="badge badge-past">ğŸ“‹ ì§€ë‚¨</span>';

            if (completed) badge = '<span class="badge badge-completed">âœ… ì™„ë£Œ</span>';

            return `
                <div class="reminder-card ${type} ${completedClass}">
                    <div class="reminder-header">
                        <div>
                            <div class="reminder-title">${escapeHtml(reminder.title)}</div>
                            <div class="reminder-datetime">
                                ğŸ“… ${reminder.scheduled_date} ${reminder.scheduled_time}
                                ${badge}
                            </div>
                        </div>
                    </div>
                    ${reminder.content ? `<div class="reminder-content">${escapeHtml(reminder.content)}</div>` : ''}
                    <div class="reminder-actions">
                        <button class="btn-success" onclick="toggleComplete(${reminder.id})">
                            ${completed ? 'ë¯¸ì™„ë£Œë¡œ ë³€ê²½' : 'ì™„ë£Œ ì²˜ë¦¬'}
                        </button>
                        <button class="btn-secondary" onclick="openEditModal(${reminder.id})">ìˆ˜ì •</button>
                        <button class="btn-danger" onclick="deleteReminder(${reminder.id})">ì‚­ì œ</button>
                    </div>
                </div>
            `;
        }

        // í†µê³„ ì—…ë°ì´íŠ¸ (í•­ìƒ ì „ì²´ ë°ì´í„° ê¸°ì¤€)
        function updateStats(allData) {
            const total = allData.length;
            const completed = allData.filter(r => r.is_completed === 1).length;
            const pending = total - completed;

            document.getElementById('totalCount').textContent = total;
            document.getElementById('pendingCount').textContent = pending;
            document.getElementById('completedCount').textContent = completed;
        }

        // ì•Œë¦¼ ë°°ë„ˆ ì—…ë°ì´íŠ¸
        function updateAlertBanners(reminders) {
            const container = document.getElementById('alertBanners');
            const today = new Date().toISOString().split('T')[0];
            const now = new Date();

            const todayReminders = reminders.filter(r => r.scheduled_date === today && r.is_completed === 0);
            const pastReminders = reminders.filter(r => {
                const reminderDateTime = new Date(`${r.scheduled_date}T${r.scheduled_time}`);
                return reminderDateTime < now && r.is_completed === 0 && r.scheduled_date !== today;
            });

            let html = '';

            if (todayReminders.length > 0) {
                html += `
                    <div class="alert-banner danger">
                        <strong>ğŸ”´ ì˜¤ëŠ˜ ì˜ˆì•½ ${todayReminders.length}ê±´</strong>ì´ ìˆìŠµë‹ˆë‹¤!
                    </div>
                `;
            }

            if (pastReminders.length > 0) {
                html += `
                    <div class="alert-banner warning">
                        <strong>âš ï¸ ì§€ë‚œ ì˜ˆì•½ ${pastReminders.length}ê±´</strong>ì´ ë¯¸ì™„ë£Œ ìƒíƒœì…ë‹ˆë‹¤.
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        // ì™„ë£Œ ìƒíƒœ í† ê¸€
        async function toggleComplete(id) {
            const response = await fetch(`/api/reminders/${id}/complete`, { method: 'PATCH' });
            if (response.ok) {
                showToast('ì„±ê³µ', 'ì™„ë£Œ ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
                loadReminders();
            }
        }

        // ì˜ˆì•½ ì‚­ì œ
        async function deleteReminder(id) {
            if (!confirm('ì´ ì˜ˆì•½ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            const response = await fetch(`/api/reminders/${id}`, { method: 'DELETE' });
            if (response.ok) {
                showToast('ì„±ê³µ', 'ì˜ˆì•½ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                loadReminders();
            }
        }

        // í† ìŠ¤íŠ¸ ì•Œë¦¼
        function showToast(title, message) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `
                <div style="flex: 1;">
                    <div style="font-weight: bold; margin-bottom: 4px;">${escapeHtml(title)}</div>
                    <div style="font-size: 13px; color: #666;">${escapeHtml(message)}</div>
                </div>
            `;

            container.appendChild(toast);

            setTimeout(() => {
                toast.classList.add('slide-out');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // HTML ì´ìŠ¤ì¼€ì´í”„
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ë„ì›€ë§ ëª¨ë‹¬ ì œì–´
        function openHelpModal() {
            document.getElementById('helpModal').classList.add('active');
            document.body.style.overflow = 'hidden'; // ë°°ê²½ ìŠ¤í¬ë¡¤ ë°©ì§€
        }

        function closeHelpModal() {
            document.getElementById('helpModal').classList.remove('active');
            document.body.style.overflow = ''; // ë°°ê²½ ìŠ¤í¬ë¡¤ ë³µì›
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.addEventListener('DOMContentLoaded', () => {
            const helpModal = document.getElementById('helpModal');
            if (helpModal) {
                helpModal.addEventListener('click', (e) => {
                    if (e.target === helpModal) {
                        closeHelpModal();
                    }
                });
            }
        });

    </script>

    <!-- ë„ì›€ë§ ë²„íŠ¼ -->
    <button class="help-button" onclick="openHelpModal()" title="ì‚¬ìš©ë²• ë„ì›€ë§">
        â“
    </button>

    <!-- ë„ì›€ë§ ëª¨ë‹¬ -->
    <div class="help-modal" id="helpModal">
        <div class="help-modal-content">
            <div class="help-modal-header">
                <div class="help-modal-title">
                    ğŸ“– ë‚´ ì˜ˆì•½ ê´€ë¦¬ ì‚¬ìš©ë²•
                </div>
                <button class="help-modal-close" onclick="closeHelpModal()">&times;</button>
            </div>

            <div class="help-modal-body">
            <div class="help-section">
                <div class="help-section-title">ğŸ“… ìº˜ë¦°ë” ì‚¬ìš©í•˜ê¸°</div>
                <div class="help-content">
                    <ul>
                        <li><strong>ë‚ ì§œ í´ë¦­</strong>: í•´ë‹¹ ë‚ ì§œì˜ ì˜ˆì•½ë§Œ í‘œì‹œ</li>
                        <li><strong>ë‹¤ì‹œ í´ë¦­</strong>: í•„í„° í•´ì œ (ì „ì²´ ì˜ˆì•½ í‘œì‹œ)</li>
                        <li><strong>ë…¸ë€ìƒ‰ í‘œì‹œ</strong>: ì˜ˆì•½ì´ ìˆëŠ” ë‚ ì§œ</li>
                        <li><strong>ë¹¨ê°„ìƒ‰ í‘œì‹œ</strong>: ì˜¤ëŠ˜ ì˜ˆì•½ì´ ìˆëŠ” ë‚ ì§œ</li>
                        <li><strong>ì˜¤ëŠ˜ ë²„íŠ¼</strong>: í˜„ì¬ ì›”ë¡œ ì´ë™</li>
                    </ul>
                </div>
            </div>

            <div class="help-section">
                <div class="help-section-title">ğŸ“Š í†µê³„ ì •ë³´</div>
                <div class="help-content">
                    <ul>
                        <li><strong>ì „ì²´</strong>: ëª¨ë“  ì˜ˆì•½ ê°œìˆ˜</li>
                        <li><strong>ë¯¸ì™„ë£Œ</strong>: ì•„ì§ ì™„ë£Œë˜ì§€ ì•Šì€ ì˜ˆì•½</li>
                        <li><strong>ì™„ë£Œ</strong>: ì™„ë£Œ ì²˜ë¦¬ëœ ì˜ˆì•½</li>
                        <li>í†µê³„ëŠ” <strong>í•„í„°ì™€ ë¬´ê´€í•˜ê²Œ í•­ìƒ ì „ì²´ ë°ì´í„°</strong> ê¸°ì¤€ì…ë‹ˆë‹¤</li>
                    </ul>
                </div>
            </div>

            <div class="help-section">
                <div class="help-section-title">ğŸ“ ì˜ˆì•½ ì¶”ê°€í•˜ê¸°</div>
                <div class="help-content">
                    <ul>
                        <li><strong>"+ ìƒˆ ì˜ˆì•½ ì¶”ê°€"</strong> ë²„íŠ¼ í´ë¦­</li>
                        <li>ìº˜ë¦°ë”ì—ì„œ ë‚ ì§œë¥¼ ì„ íƒí•œ ìƒíƒœë©´ ìë™ìœ¼ë¡œ ë‚ ì§œ ì…ë ¥ë¨</li>
                        <li><strong>ê°œì¸ì •ë³´ ë³´í˜¸</strong>: ì „í™”ë²ˆí˜¸ ì…ë ¥ ì‹œ ì €ì¥ì´ ì°¨ë‹¨ë©ë‹ˆë‹¤</li>
                    </ul>
                </div>
            </div>

            <div class="help-section">
                <div class="help-section-title">ğŸ” ê²€ìƒ‰ ë° í•„í„°</div>
                <div class="help-content">
                    <ul>
                        <li><strong>ê²€ìƒ‰ì°½</strong>: ì œëª©ì´ë‚˜ ë‚´ìš©ìœ¼ë¡œ ê²€ìƒ‰</li>
                        <li><strong>ì™„ë£Œëœ í•­ëª© ë³´ê¸°</strong>: ì²´í¬í•˜ë©´ ì™„ë£Œëœ ì˜ˆì•½ë„ í‘œì‹œ</li>
                        <li><strong>ìº˜ë¦°ë” ë‚ ì§œ ì„ íƒ</strong>: íŠ¹ì • ë‚ ì§œì˜ ì˜ˆì•½ë§Œ í‘œì‹œ</li>
                    </ul>
                </div>
            </div>

            <div class="help-section">
                <div class="help-section-title">ğŸ”” ì•Œë¦¼ ì„¤ì •</div>
                <div class="help-content">
                    <ul>
                        <li><strong>ì•Œë¦¼ ì„¤ì • ë²„íŠ¼</strong>: ìº˜ë¦°ë” í•˜ë‹¨ì˜ ë²„íŠ¼ í´ë¦­</li>
                        <li><strong>ì˜ˆì•½ ì•Œë¦¼ ì‹œê°„</strong>: ì˜ˆì•½ ëª‡ ë¶„ ì „ì— ì•Œë¦¼ ë°›ì„ì§€ ì„¤ì • (5ë¶„~1ì‹œê°„)</li>
                        <li><strong>ë°˜ë³µ ì•Œë¦¼</strong>: ë¯¸ì™„ë£Œ ì˜ˆì•½ì— ëŒ€í•´ ë°˜ë³µ ì•Œë¦¼ (ê°„ê²©, ì¢…ë£Œ ì‹œì  ì„¤ì •)</li>
                        <li><strong>ì•„ì¹¨ ì¼ì¼ ìš”ì•½</strong>: ë§¤ì¼ ì„¤ì •ëœ ì‹œê°„ì— ì˜¤ëŠ˜ ì˜ˆì•½ ëª©ë¡ ì•Œë¦¼</li>
                        <li><strong>í…ŒìŠ¤íŠ¸ ë²„íŠ¼</strong>: ì¼ì¼ ìš”ì•½ ì•Œë¦¼ ì¦‰ì‹œ ë°œì†¡ í…ŒìŠ¤íŠ¸</li>
                    </ul>
                    <div class="help-tip" style="margin-top: 10px;">
                        <strong>ğŸ’¡ Tip:</strong> ì•Œë¦¼ì„ ë°›ìœ¼ë ¤ë©´ ë¸Œë¼ìš°ì €ì—ì„œ ì•Œë¦¼ ê¶Œí•œì„ í—ˆìš©í•´ì•¼ í•©ë‹ˆë‹¤!
                    </div>
                </div>
            </div>

            <div class="help-tip">
                <strong>ğŸ’¡ ê°œì¸ì •ë³´ ë³´í˜¸:</strong> ì „í™”ë²ˆí˜¸ ëŒ€ì‹  ìƒë‹´ë²ˆí˜¸(CO), ê³ ê°ë²ˆí˜¸(CU), ë˜ëŠ” ì´ë¦„ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”.
            </div>
            </div>
        </div>
    </div>

    <!-- ì•Œë¦¼ ì„¤ì • ëª¨ë‹¬ -->
    <div class="modal-overlay" id="notificationSettingsModal">
        <div class="modal-box" style="max-width: 480px;">
            <div class="modal-title">ğŸ”” ì•Œë¦¼ ì„¤ì •</div>

            <!-- ì˜ˆì•½ ì•Œë¦¼ ì‹œê°„ ì„¤ì • -->
            <div class="form-group">
                <label>â° ì˜ˆì•½ ì•Œë¦¼ ì‹œê°„</label>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <select id="reminderMinutes" style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="5">5ë¶„ ì „</option>
                        <option value="10">10ë¶„ ì „</option>
                        <option value="15">15ë¶„ ì „</option>
                        <option value="30" selected>30ë¶„ ì „</option>
                        <option value="60">1ì‹œê°„ ì „</option>
                    </select>
                    <span style="color: #666; font-size: 13px;">ì— ì²« ì•Œë¦¼</span>
                </div>
            </div>

            <!-- ë°˜ë³µ ì•Œë¦¼ ì„¤ì • -->
            <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; font-weight: bold; margin-bottom: 10px;">
                    <input type="checkbox" id="repeatEnabled" style="width: 18px; height: 18px;">
                    ğŸ” ë°˜ë³µ ì•Œë¦¼ (ë¯¸ì™„ë£Œ ì‹œ)
                </label>
                <div id="repeatSettings" style="margin-left: 28px; display: none;">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; flex-wrap: wrap;">
                        <span>ë§¤</span>
                        <select id="repeatInterval" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="3">3ë¶„</option>
                            <option value="5" selected>5ë¶„</option>
                            <option value="10">10ë¶„</option>
                        </select>
                        <span>ë§ˆë‹¤,</span>
                        <select id="repeatUntilMinutes" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="0">ì˜ˆì•½ ì‹œê°„ê¹Œì§€</option>
                            <option value="5">5ë¶„ ì „ê¹Œì§€</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- ì•„ì¹¨ ì¼ì¼ ìš”ì•½ -->
            <div style="margin-bottom: 20px; padding: 15px; background: #fff8e1; border-radius: 8px;">
                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; font-weight: bold; margin-bottom: 10px;">
                    <input type="checkbox" id="dailySummaryEnabled" checked style="width: 18px; height: 18px;">
                    ğŸ“… ì•„ì¹¨ ì¼ì¼ ìš”ì•½ ì•Œë¦¼
                </label>
                <div id="dailySummarySettings" style="margin-left: 28px;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span>ë§¤ì¼</span>
                        <input type="time" id="dailySummaryTime" value="09:00" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px;">
                        <span>ì— ì˜¤ëŠ˜ ì¼ì • ì•Œë¦¼</span>
                    </div>
                </div>
            </div>

            <div class="modal-buttons">
                <button class="btn-secondary" onclick="closeNotificationSettingsModal()">ì·¨ì†Œ</button>
                <button class="btn-success" onclick="testDailySummary()">ğŸ“¤ í…ŒìŠ¤íŠ¸</button>
                <button class="btn-primary" onclick="saveNotificationSettings()">ğŸ’¾ ì €ì¥</button>
            </div>
        </div>
    </div>

    <script>
        // ì•Œë¦¼ ì„¤ì • ëª¨ë‹¬ ì œì–´
        function openNotificationSettingsModal() {
            loadNotificationSettings();
            document.getElementById('notificationSettingsModal').classList.add('active');
        }

        function closeNotificationSettingsModal() {
            document.getElementById('notificationSettingsModal').classList.remove('active');
        }

        // ì•Œë¦¼ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadNotificationSettings() {
            try {
                const response = await fetch('/api/notification-settings');
                if (response.ok) {
                    const settings = await response.json();
                    document.getElementById('reminderMinutes').value = settings.reminder_minutes || 30;
                    document.getElementById('repeatEnabled').checked = settings.repeat_enabled || false;
                    document.getElementById('repeatInterval').value = settings.repeat_interval || 5;
                    document.getElementById('repeatUntilMinutes').value = settings.repeat_until_minutes || 0;
                    document.getElementById('dailySummaryEnabled').checked = settings.daily_summary_enabled !== false;
                    document.getElementById('dailySummaryTime').value = settings.daily_summary_time || '09:00';

                    document.getElementById('repeatSettings').style.display = settings.repeat_enabled ? 'block' : 'none';
                    document.getElementById('dailySummarySettings').style.display = settings.daily_summary_enabled !== false ? 'block' : 'none';
                }
            } catch (error) {
                console.error('ì•Œë¦¼ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
            }
        }

        // ì•Œë¦¼ ì„¤ì • ì €ì¥
        async function saveNotificationSettings() {
            const settings = {
                reminder_minutes: parseInt(document.getElementById('reminderMinutes').value),
                repeat_enabled: document.getElementById('repeatEnabled').checked,
                repeat_interval: parseInt(document.getElementById('repeatInterval').value),
                repeat_until_minutes: parseInt(document.getElementById('repeatUntilMinutes').value),
                daily_summary_enabled: document.getElementById('dailySummaryEnabled').checked,
                daily_summary_time: document.getElementById('dailySummaryTime').value
            };

            try {
                const response = await fetch('/api/notification-settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(settings)
                });

                if (response.ok) {
                    showToast('ì•Œë¦¼ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    closeNotificationSettingsModal();
                } else {
                    showToast('ì €ì¥ ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('ì•Œë¦¼ ì„¤ì • ì €ì¥ ì‹¤íŒ¨:', error);
                showToast('ì €ì¥ ì‹¤íŒ¨');
            }
        }

        // ì¼ì¼ ìš”ì•½ í…ŒìŠ¤íŠ¸
        async function testDailySummary() {
            try {
                const response = await fetch('/api/notification-settings/test-daily-summary', { method: 'POST' });
                const result = await response.json();

                if (result.success > 0) {
                    showToast('ì¼ì¼ ìš”ì•½ ì•Œë¦¼ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                } else if (result.message) {
                    showToast(result.message);
                } else {
                    showToast('ë°œì†¡ ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('ì¼ì¼ ìš”ì•½ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', error);
                showToast('í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨');
            }
        }

        // ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('repeatEnabled').addEventListener('change', function() {
                document.getElementById('repeatSettings').style.display = this.checked ? 'block' : 'none';
            });
            document.getElementById('dailySummaryEnabled').addEventListener('change', function() {
                document.getElementById('dailySummarySettings').style.display = this.checked ? 'block' : 'none';
            });
        });
    </script>
</body>
</html>
