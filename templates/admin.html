<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ê´€ë¦¬ì í˜ì´ì§€</title>

    <!-- PWA ë©”íƒ€ íƒœê·¸ -->
    <meta name="description" content="ê¸´ê¸‰ ìƒí™©ì„ ìœ„í•œ ì—…ë¬´ í• ë‹¹ ë° ì±„íŒ… ì‹œìŠ¤í…œ">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ì—…ë¬´ê´€ë¦¬">
    <link rel="manifest" href="/static/manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="/static/icon-192.png">
    <link rel="apple-touch-icon" href="/static/icon-192.png">

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { margin-bottom: 30px; color: #333; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        input, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
        textarea { min-height: 80px; resize: vertical; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; margin-right: 10px; }
        button:hover { background: #0056b3; }
        button.delete { background: #dc3545; }
        button.delete:hover { background: #c82333; }
        button.edit { background: #28a745; }
        button.edit:hover { background: #218838; }
        table { width: 100%; border-collapse: collapse; margin-top: 30px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #f8f9fa; font-weight: bold; color: #333; }
        tr:hover { background: #f8f9fa; }
        .actions { white-space: nowrap; }
        #addForm { background: #f8f9fa; padding: 20px; border-radius: 4px; margin-bottom: 30px; }

        /* í† ìŠ¤íŠ¸ ì•Œë¦¼ */
        .toast-container { position: fixed; bottom: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px; max-width: 350px; }
        .toast { background: white; padding: 15px 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); cursor: pointer; transform: translateX(400px); animation: slideIn 0.3s forwards; border-left: 4px solid #667eea; display: flex; align-items: center; gap: 12px; }
        .toast:hover { box-shadow: 0 6px 16px rgba(0,0,0,0.4); transform: translateY(-2px); }
        .toast.slide-out { animation: slideOut 0.3s forwards; }
        @keyframes slideIn { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes slideOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(400px); opacity: 0; } }
        .toast-icon { font-size: 24px; flex-shrink: 0; }
        .toast-content { flex: 1; min-width: 0; }
        .toast-title { font-weight: bold; color: #333; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .toast-message { font-size: 13px; color: #666; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .toast-close { background: none; border: none; font-size: 20px; color: #999; cursor: pointer; padding: 0; width: 24px; height: 24px; flex-shrink: 0; }
        .toast-close:hover { color: #333; }

        /* PWA ì„¤ì¹˜ ë²„íŠ¼ */
        .install-btn { padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; display: none; font-size: 14px; }
        .install-btn:hover { background: #5568d3; }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; align-items: center; justify-content: center; }
        .modal-overlay.active { display: flex; }
        .modal-box { background: white; border-radius: 8px; padding: 30px; max-width: 400px; width: 90%; box-shadow: 0 4px 20px rgba(0,0,0,0.3); animation: modalSlideIn 0.3s; }
        @keyframes modalSlideIn { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .modal-title { font-size: 20px; font-weight: bold; margin-bottom: 15px; color: #333; }
        .modal-message { margin-bottom: 20px; color: #666; line-height: 1.5; }
        .modal-input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; margin-bottom: 20px; }
        .modal-buttons { display: flex; gap: 10px; justify-content: flex-end; }
        .modal-btn { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: bold; }
        .modal-btn-primary { background: #007bff; color: white; }
        .modal-btn-primary:hover { background: #0056b3; }
        .modal-btn-secondary { background: #6c757d; color: white; }
        .modal-btn-secondary:hover { background: #5a6268; }
        .modal-btn-danger { background: #dc3545; color: white; }
        .modal-btn-danger:hover { background: #c82333; }

        /* í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #paginationButtons button { padding: 6px 12px; border: 1px solid #ddd; background: white; color: #333; cursor: pointer; border-radius: 4px; font-size: 14px; min-width: 36px; }
        #paginationButtons button:hover:not(:disabled) { background: #007bff; color: white; border-color: #007bff; }
        #paginationButtons button.active { background: #007bff; color: white; border-color: #007bff; font-weight: bold; }
        #paginationButtons button:disabled { cursor: not-allowed; opacity: 0.5; background: #f5f5f5; }

        /* ë‹¹ì¼ ì˜ˆì•½ ë°°ë„ˆ */
        #reminderBanner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 9998;
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            padding: 12px 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            display: none;
            animation: slideDown 0.3s ease-out;
        }
        #reminderBanner.show { display: flex; align-items: center; justify-content: space-between; }
        @keyframes slideDown { from { transform: translateY(-100%); } to { transform: translateY(0); } }
        body.has-banner { padding-top: 60px; }
        #reminderBanner .banner-content { flex: 1; display: flex; align-items: center; gap: 12px; font-weight: bold; }
        #reminderBanner .banner-icon { font-size: 20px; }
        #reminderBanner .banner-close { background: rgba(255,255,255,0.2); border: none; color: white; padding: 4px 12px; border-radius: 4px; cursor: pointer; font-size: 14px; margin-left: 10px; }
        #reminderBanner .banner-close:hover { background: rgba(255,255,255,0.3); }
        #reminderBanner .banner-link { background: white; color: #dc3545; padding: 6px 16px; border-radius: 4px; text-decoration: none; font-weight: bold; margin-left: 10px; }
        #reminderBanner .banner-link:hover { background: #f8f9fa; }

        /* ë„ì›€ë§ ë²„íŠ¼ */
        .help-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            z-index: 9997;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .help-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.6);
        }
        .help-button:active {
            transform: scale(0.95);
        }

        /* ë„ì›€ë§ ëª¨ë‹¬ */
        .help-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }
        .help-modal.active {
            display: flex;
        }
        .help-modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .help-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #667eea;
        }
        .help-modal-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .help-modal-close {
            background: none;
            border: none;
            font-size: 28px;
            color: #999;
            cursor: pointer;
            transition: color 0.2s;
        }
        .help-modal-close:hover {
            color: #333;
        }
        .help-section {
            margin-bottom: 25px;
        }
        .help-section-title {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .help-content {
            color: #555;
            line-height: 1.8;
            font-size: 15px;
        }
        .help-content ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .help-content li {
            margin: 8px 0;
        }
        .help-content strong {
            color: #333;
            font-weight: 600;
        }
        .help-tip {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .help-tip strong {
            color: #667eea;
        }
    </style>
</head>
<body>
    <div id="reminderBanner">
        <div class="banner-content">
            <span class="banner-icon">ğŸ”´</span>
            <span id="bannerText">ì˜¤ëŠ˜ ì˜ˆì•½ì´ ìˆìŠµë‹ˆë‹¤!</span>
        </div>
        <a href="/reminders" class="banner-link">ì˜ˆì•½ í™•ì¸</a>
        <button class="banner-close" onclick="closeBanner()">ë‹«ê¸°</button>
    </div>
    <div class="toast-container" id="toastContainer"></div>
    <div class="container">
        {% include 'includes/header.html' %}


        <!-- í• ì¼ ê´€ë¦¬ -->
        <div id="content-manage">
            <!-- í•„í„° ë° ê²€ìƒ‰ ì˜ì—­ -->
            <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px;">
                <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 15px; flex-wrap: wrap;">
                    <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                        <h2 style="margin: 0;">ğŸ“‹ í• ì¼ ê´€ë¦¬</h2>
                        <button onclick="openTaskRegistrationModal()" style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 14px; display: flex; align-items: center; gap: 8px;">
                            â• í• ì¼ ë“±ë¡
                        </button>
                    </div>
                    <select id="assignmentFilter" onchange="applyFilters()" style="padding: 8px 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px;">
                        <option value="all">ì „ì²´</option>
                        <option value="assigned">ë°°ì •ë¨</option>
                        <option value="unassigned">ë¯¸ë°°ì •</option>
                    </select>
                    <select id="statusFilter" onchange="applyFilters()" style="padding: 8px 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px;">
                        <option value="all">ëª¨ë“  ìƒíƒœ</option>
                        <option value="ëŒ€ê¸°ì¤‘">ëŒ€ê¸°ì¤‘</option>
                        <option value="ì§„í–‰ì¤‘">ì§„í–‰ì¤‘</option>
                        <option value="ì™„ë£Œ">ì™„ë£Œ</option>
                    </select>
                    <div style="flex: 1; max-width: 400px; position: relative;">
                        <input type="text" id="searchInput" placeholder="ğŸ” ì œëª©, ë‚´ìš©, ë‹´ë‹¹ìë¡œ ê²€ìƒ‰..."
                               onkeyup="applyFilters()"
                               style="width: 100%; padding: 10px 40px 10px 15px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px; transition: all 0.3s;"
                               onfocus="this.style.borderColor='#667eea'"
                               onblur="this.style.borderColor='#ddd'">
                        <button onclick="document.getElementById('searchInput').value=''; applyFilters();"
                                style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #999; cursor: pointer; padding: 5px 10px; font-size: 18px;"
                                title="ê²€ìƒ‰ ì´ˆê¸°í™”">âœ•</button>
                    </div>
                </div>

                <!-- ë‚ ì§œ í•„í„° ì˜ì—­ -->
                <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap; padding-top: 15px; border-top: 1px solid #eee;">
                    <div style="display: flex; gap: 5px; align-items: center;">
                        <label style="font-size: 14px; font-weight: 600; color: #555; white-space: nowrap;">ë“±ë¡ì¼:</label>
                        <input type="date" id="createdFromDate" onchange="applyFilters()" style="padding: 6px 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px;">
                        <span style="color: #999;">~</span>
                        <input type="date" id="createdToDate" onchange="applyFilters()" style="padding: 6px 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px;">
                    </div>
                    <div style="display: flex; gap: 5px; align-items: center;">
                        <label style="font-size: 14px; font-weight: 600; color: #555; white-space: nowrap;">ë°°ì •ì¼:</label>
                        <input type="date" id="assignedFromDate" onchange="applyFilters()" style="padding: 6px 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px;">
                        <span style="color: #999;">~</span>
                        <input type="date" id="assignedToDate" onchange="applyFilters()" style="padding: 6px 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px;">
                    </div>
                    <button onclick="clearDateFilters()" style="padding: 6px 12px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">ì´ˆê¸°í™”</button>
                </div>

                <!-- ì¼ê´„ ì‘ì—… ë²„íŠ¼ -->
                <div style="display: flex; gap: 10px; flex-wrap: wrap; padding-top: 15px; border-top: 1px solid #eee;">
                    <button onclick="openBulkAssignModal()" style="background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%); color: white; border: none; padding: 10px 16px; border-radius: 6px; font-weight: 600; cursor: pointer; box-shadow: 0 2px 4px rgba(255,152,0,0.3); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                        ğŸ‘¥ ì„ íƒ í•­ëª© ë°°ì •
                    </button>
                    <button onclick="bulkUnassign()" style="background: linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%); color: white; border: none; padding: 10px 16px; border-radius: 6px; font-weight: 600; cursor: pointer; box-shadow: 0 2px 4px rgba(156,39,176,0.3); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                        â†©ï¸ ì„ íƒ í•­ëª© ë°°ì • í•´ì œ
                    </button>
                    <button onclick="bulkDelete()" style="background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%); color: white; border: none; padding: 10px 16px; border-radius: 6px; font-weight: 600; cursor: pointer; box-shadow: 0 2px 4px rgba(244,67,54,0.3); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                        ğŸ—‘ï¸ ì„ íƒ í•­ëª© ì‚­ì œ
                    </button>
                    <button onclick="selectAllUnassigned()" style="background: linear-gradient(135deg, #607d8b 0%, #455a64 100%); color: white; border: none; padding: 10px 16px; border-radius: 6px; font-weight: 600; cursor: pointer; box-shadow: 0 2px 4px rgba(96,125,139,0.3); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                        ğŸ“‹ ë¯¸ë°°ì • ì „ì²´ ì„ íƒ
                    </button>
                    <div style="flex: 1; text-align: right; color: #666; font-size: 14px; display: flex; align-items: center; justify-content: flex-end;">
                        <span id="resultCount">ê²€ìƒ‰ ê²°ê³¼: 0ê°œ</span>
                    </div>
                </div>
            </div>

            <!-- ë ˆì´ì•„ì›ƒ í”„ë¦¬ì…‹ ì„ íƒ -->
            <div style="background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 15px;">
                <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                    <label style="font-weight: 600; color: #555;">í…Œì´ë¸” ë ˆì´ì•„ì›ƒ:</label>
                    <select id="layoutPreset" onchange="loadLayoutPreset()" style="padding: 8px 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px; min-width: 200px;">
                        <optgroup label="ê¸°ë³¸ í”„ë¦¬ì…‹">
                            <option value="default">ê¸°ë³¸ (ë‚ ì§œ ë’¤ë¡œ)</option>
                            <option value="compact">ê°„ê²° (ë‚ ì§œ ìˆ¨ê¹€)</option>
                            <option value="detailed">ìƒì„¸ (ë‚ ì§œ ì•ìœ¼ë¡œ)</option>
                        </optgroup>
                        <optgroup label="ë‚˜ë§Œì˜ ë ˆì´ì•„ì›ƒ" id="customLayoutsGroup">
                            <!-- ì»¤ìŠ¤í…€ ë ˆì´ì•„ì›ƒë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
                        </optgroup>
                    </select>
                    <button onclick="openColumnManager()" style="padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">âš™ï¸ ì»¬ëŸ¼ ê´€ë¦¬</button>
                    <button onclick="openSaveLayoutDialog()" style="padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">ğŸ’¾ ìƒˆ ë ˆì´ì•„ì›ƒ ì €ì¥</button>
                    <button onclick="openManageLayoutsDialog()" style="padding: 8px 16px; background: #ff9800; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">ğŸ“‚ ë ˆì´ì•„ì›ƒ ê´€ë¦¬</button>
                </div>
            </div>

            <!-- í…Œì´ë¸” ì»¨í…Œì´ë„ˆ (ê°€ë¡œ/ì„¸ë¡œ ìŠ¤í¬ë¡¤) -->
            <div style="background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow: hidden;">
                <div style="max-height: 500px; overflow: auto;" id="tableContainer">
                    <table id="itemsTable" style="min-width: 100%; border-collapse: separate; border-spacing: 0; white-space: nowrap;">
                        <thead id="itemsTableHead" style="position: sticky; top: 0; background: #f8f9fa; z-index: 10;">
                        </thead>
                        <tbody id="itemsList">
                        </tbody>
                    </table>
                </div>

                <!-- í˜ì´ì§• ì˜ì—­ -->
                <div id="paginationContainer" style="padding: 15px; border-top: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; background: #f8f9fa;">
                    <div style="color: #666; font-size: 14px;">
                        <span id="pageInfo">1-20 / 100</span>
                    </div>
                    <div id="paginationButtons" style="display: flex; gap: 5px;">
                        <!-- í˜ì´ì§€ ë²„íŠ¼ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                    </div>
                    <div>
                        <select id="pageSizeSelect" onchange="changePageSize()" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                            <option value="20">20ê°œì”© ë³´ê¸°</option>
                            <option value="50">50ê°œì”© ë³´ê¸°</option>
                            <option value="100">100ê°œì”© ë³´ê¸°</option>
                            <option value="all">ì „ì²´ ë³´ê¸°</option>
                        </select>
                    </div>
                </div>
            </div>
        </div> <!-- content-manage ì¢…ë£Œ -->
    </div>

    <!-- ëª¨ë‹¬ -->
    <div id="modalOverlay" class="modal-overlay">
        <div class="modal-box">
            <div id="modalTitle" class="modal-title"></div>
            <div id="modalMessage" class="modal-message"></div>
            <input type="text" id="modalInput" class="modal-input" style="display: none;">
            <div id="modalContent" style="display: none;"></div>
            <div id="modalButtons" class="modal-buttons"></div>
        </div>
    </div>

    <!-- í• ì¼ ë“±ë¡ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="taskRegistrationModal">
        <div class="modal-box" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 class="modal-title" style="margin: 0;">âœï¸ í• ì¼ ë“±ë¡</h2>
                <button onclick="closeTaskRegistrationModal()" style="background: none; border: none; font-size: 24px; color: #999; cursor: pointer;">Ã—</button>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 25px;">
                <!-- ë‹¨ì¼ í•­ëª© ì¶”ê°€ -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #667eea;">
                    <h3 style="margin-bottom: 15px; color: #667eea;">ğŸ“ ë‹¨ì¼ í•­ëª© ì¶”ê°€</h3>
                    <div class="form-group">
                        <label>ëŒ€ìƒì (ì„ íƒ)</label>
                        <input type="text" id="taskRegModalAssignedTo" placeholder="ë°°ì •í•  ì‚¬ìš©ì ì´ë¦„ (ì„ íƒì‚¬í•­)">
                    </div>
                    <div class="form-group">
                        <label>ì œëª© <span style="color: red;">*</span></label>
                        <input type="text" id="taskRegModalTitle" placeholder="í• ì¼ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="form-group">
                        <label>ë‚´ìš© <span style="color: red;">*</span></label>
                        <textarea id="taskRegModalContent" placeholder="í• ì¼ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                    </div>
                    <button onclick="addSingleItemFromModal()" style="width: 100%; background: #667eea; padding: 12px; font-size: 15px; font-weight: bold;">ì¶”ê°€</button>
                </div>

                <!-- ì—‘ì…€ ì¼ê´„ ì—…ë¡œë“œ -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #28a745;">
                    <h3 style="margin-bottom: 15px; color: #28a745;">ğŸ“Š ì—‘ì…€ ì¼ê´„ ë“±ë¡</h3>
                    <div class="form-group">
                        <label>ì—‘ì…€ íŒŒì¼ ì„ íƒ (.xlsx, .xls)</label>
                        <input type="file" id="taskRegModalExcelFile" accept=".xlsx,.xls" style="padding: 8px;">
                    </div>
                    <div style="background: #fff; padding: 12px; border-radius: 6px; border: 1px solid #ddd; margin-bottom: 15px;">
                        <p style="font-size: 13px; color: #666; margin-bottom: 8px;"><strong>ì—‘ì…€ íŒŒì¼ í˜•ì‹:</strong></p>
                        <p style="font-size: 12px; color: #999; line-height: 1.6;">
                            â€¢ <strong>ì œëª©</strong> (í•„ìˆ˜): í• ì¼ ì œëª©<br>
                            â€¢ <strong>ë‚´ìš©</strong> (í•„ìˆ˜): í• ì¼ ë‚´ìš©<br>
                            â€¢ <strong>ëŒ€ìƒì</strong> (ì„ íƒ): ë°°ì •í•  ì‚¬ìš©ì ì´ë¦„<br>
                            â€¢ ì²« ë²ˆì§¸ í–‰ì€ í—¤ë”ë¡œ ì¸ì‹ë©ë‹ˆë‹¤
                        </p>
                        <button onclick="downloadExcelTemplate()" style="width: 100%; margin-top: 10px; padding: 8px; background: #fff; border: 2px solid #28a745; color: #28a745; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 13px;">
                            ğŸ“¥ ì„œì‹ ë‹¤ìš´ë¡œë“œ
                        </button>
                    </div>
                    <button onclick="uploadExcelFromModal()" style="width: 100%; background: #28a745; padding: 12px; font-size: 15px; font-weight: bold;">ì—…ë¡œë“œ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        const currentUsername = '{{ username }}';
        let editingId = null;
        let unreadCount = 0;
        let originalTitle = 'ê´€ë¦¬ì í˜ì´ì§€';
        let titleBlinkInterval = null;

        // ì»¬ëŸ¼ ì„¤ì •
        const COLUMN_DEFINITIONS = {
            checkbox: { key: 'checkbox', label: '', width: '40px', fixed: true },
            id: { key: 'id', label: 'ID', width: '60px' },
            status: { key: 'status', label: 'ìƒíƒœ', width: '100px' },
            team: { key: 'team', label: 'íŒ€', width: '100px' },
            assigned_to: { key: 'assigned_to', label: 'ëŒ€ìƒì', width: '100px' },
            title: { key: 'title', label: 'ì œëª©', width: 'auto' },
            content: { key: 'content', label: 'ë‚´ìš©', width: 'auto' },
            created_at: { key: 'created_at', label: 'ë“±ë¡ì¼', width: '110px' },
            assigned_at: { key: 'assigned_at', label: 'ë°°ì •ì¼', width: '110px' },
            updated_at: { key: 'updated_at', label: 'ìˆ˜ì •ì¼', width: '110px' },
            completed_at: { key: 'completed_at', label: 'ì™„ë£Œì¼', width: '110px' },
            actions: { key: 'actions', label: 'ì‘ì—…', width: '180px', fixed: true }
        };

        // ë ˆì´ì•„ì›ƒ í”„ë¦¬ì…‹
        const LAYOUT_PRESETS = {
            default: {
                name: 'ê¸°ë³¸ (ë‚ ì§œ ë’¤ë¡œ)',
                columns: ['checkbox', 'id', 'status', 'team', 'assigned_to', 'title', 'content', 'created_at', 'assigned_at', 'updated_at', 'completed_at', 'actions'],
                visible: ['checkbox', 'id', 'status', 'team', 'assigned_to', 'title', 'content', 'created_at', 'assigned_at', 'updated_at', 'completed_at', 'actions'],
                pinned: []
            },
            compact: {
                name: 'ê°„ê²° (ë‚ ì§œ ìˆ¨ê¹€)',
                columns: ['checkbox', 'id', 'status', 'team', 'assigned_to', 'title', 'content', 'actions'],
                visible: ['checkbox', 'id', 'status', 'team', 'assigned_to', 'title', 'content', 'actions'],
                pinned: []
            },
            detailed: {
                name: 'ìƒì„¸ (ë‚ ì§œ ì•ìœ¼ë¡œ)',
                columns: ['checkbox', 'id', 'created_at', 'assigned_at', 'updated_at', 'completed_at', 'status', 'team', 'assigned_to', 'title', 'content', 'actions'],
                visible: ['checkbox', 'id', 'created_at', 'assigned_at', 'updated_at', 'completed_at', 'status', 'team', 'assigned_to', 'title', 'content', 'actions'],
                pinned: []
            }
        };

        let currentLayout = null;

        // Excel ìŠ¤íƒ€ì¼ ì»¬ëŸ¼ í•„í„° ìƒíƒœ (ë‹¤ì¤‘ ì¡°ê±´ ì§€ì›)
        // { columnKey: { logic: 'AND', conditions: [{ operator: 'equals', value: 'somevalue' }, ...] } }
        let columnFilters = {};

        // ì •ë ¬ ìƒíƒœ { column: 'columnKey', direction: 'asc' | 'desc' }
        let sortState = null;

        // í´ë¦­ íƒ€ì´ë¨¸ (ì‹±ê¸€/ë”ë¸”í´ë¦­ êµ¬ë¶„ìš©)
        let clickTimer = null;
        let clickCount = 0;

        // ë“œë˜ê·¸ ìƒíƒœ
        let draggedColumn = null;
        let dragOverColumn = null;

        // í•„í„° ì—°ì‚°ì ì •ì˜
        const FILTER_OPERATORS = {
            text: [
                { value: 'equals', label: 'ê°™ìŒ' },
                { value: 'not_equals', label: 'ê°™ì§€ ì•ŠìŒ' },
                { value: 'contains', label: 'í¬í•¨' },
                { value: 'not_contains', label: 'í¬í•¨í•˜ì§€ ì•ŠìŒ' },
                { value: 'starts_with', label: 'ì‹œì‘í•¨' },
                { value: 'ends_with', label: 'ëë‚¨' },
                { value: 'in', label: 'IN (ë‹¤ìŒ ì¤‘ í•˜ë‚˜)' },
                { value: 'not_in', label: 'NOT IN (ë‹¤ìŒ ì œì™¸)' },
                { value: 'is_empty', label: 'ë¹„ì–´ìˆìŒ' },
                { value: 'not_empty', label: 'ë¹ˆ ê°’ ì œì™¸' }
            ],
            number: [
                { value: 'equals', label: 'ê°™ìŒ (=)' },
                { value: 'not_equals', label: 'ê°™ì§€ ì•ŠìŒ (â‰ )' },
                { value: 'greater', label: 'í¼ (>)' },
                { value: 'greater_equal', label: 'í¬ê±°ë‚˜ ê°™ìŒ (â‰¥)' },
                { value: 'less', label: 'ì‘ìŒ (<)' },
                { value: 'less_equal', label: 'ì‘ê±°ë‚˜ ê°™ìŒ (â‰¤)' },
                { value: 'between', label: 'ë²”ìœ„' },
                { value: 'in', label: 'IN (ë‹¤ìŒ ì¤‘ í•˜ë‚˜)' },
                { value: 'not_in', label: 'NOT IN (ë‹¤ìŒ ì œì™¸)' },
                { value: 'is_empty', label: 'ë¹„ì–´ìˆìŒ' },
                { value: 'not_empty', label: 'ë¹ˆ ê°’ ì œì™¸' }
            ],
            date: [
                { value: 'equals', label: 'ê°™ì€ ë‚ ì§œ' },
                { value: 'not_equals', label: 'ê°™ì§€ ì•ŠìŒ' },
                { value: 'after', label: 'ì´í›„' },
                { value: 'after_equal', label: 'ì´í›„ ë˜ëŠ” ê°™ìŒ' },
                { value: 'before', label: 'ì´ì „' },
                { value: 'before_equal', label: 'ì´ì „ ë˜ëŠ” ê°™ìŒ' },
                { value: 'between', label: 'ê¸°ê°„' },
                { value: 'in', label: 'IN (ë‹¤ìŒ ì¤‘ í•˜ë‚˜)' },
                { value: 'not_in', label: 'NOT IN (ë‹¤ìŒ ì œì™¸)' },
                { value: 'is_empty', label: 'ë¹„ì–´ìˆìŒ' },
                { value: 'not_empty', label: 'ë¹ˆ ê°’ ì œì™¸' }
            ],
            select: [
                { value: 'in', label: 'IN (ë‹¤ìŒ ì¤‘ í•˜ë‚˜)' },
                { value: 'not_in', label: 'NOT IN (ë‹¤ìŒ ì œì™¸)' },
                { value: 'is_empty', label: 'ë¹„ì–´ìˆìŒ' },
                { value: 'not_empty', label: 'ë¹ˆ ê°’ ì œì™¸' }
            ]
        };

        // í•€ ì»¬ëŸ¼ ìœ„ì¹˜ ìºì‹œ (í—¤ë”ì—ì„œ ê³„ì‚°í•œ ê°’ì„ ë°”ë””ì—ì„œ ì¬ì‚¬ìš©)
        let cachedPinnedPositions = {};

        // ì»¬ëŸ¼ íƒ€ì… ë§¤í•‘
        const COLUMN_TYPES = {
            id: 'number',
            status: 'text',      // í…ìŠ¤íŠ¸ë¡œ ë³€ê²½ - ëª¨ë“  ì—°ì‚°ì ì‚¬ìš© ê°€ëŠ¥
            team: 'text',        // í…ìŠ¤íŠ¸ë¡œ ë³€ê²½ - ëª¨ë“  ì—°ì‚°ì ì‚¬ìš© ê°€ëŠ¥
            assigned_to: 'text', // í…ìŠ¤íŠ¸ë¡œ ë³€ê²½ - ëª¨ë“  ì—°ì‚°ì ì‚¬ìš© ê°€ëŠ¥
            title: 'text',
            content: 'text',
            created_at: 'date',
            assigned_at: 'date',
            updated_at: 'date',
            completed_at: 'date'
        };

        // ëª¨ë‹¬ í•¨ìˆ˜
        function showModal(title, message, buttons) {
            const overlay = document.getElementById('modalOverlay');
            const modalTitle = document.getElementById('modalTitle');
            const modalMessage = document.getElementById('modalMessage');
            const modalInput = document.getElementById('modalInput');
            const modalButtons = document.getElementById('modalButtons');

            modalTitle.textContent = title;
            modalMessage.innerHTML = message;  // textContent â†’ innerHTMLë¡œ ë³€ê²½
            modalInput.style.display = 'none';
            modalInput.value = '';

            modalButtons.innerHTML = buttons.map(btn => {
                const className = btn.type === 'primary' ? 'modal-btn-primary' :
                                 btn.type === 'danger' ? 'modal-btn-danger' :
                                 'modal-btn-secondary';
                return `<button class="modal-btn ${className}" onclick="${btn.onclick}">${btn.text}</button>`;
            }).join('');

            overlay.classList.add('active');
        }

        function showPromptModal(title, message, callback) {
            const overlay = document.getElementById('modalOverlay');
            const modalTitle = document.getElementById('modalTitle');
            const modalMessage = document.getElementById('modalMessage');
            const modalInput = document.getElementById('modalInput');
            const modalButtons = document.getElementById('modalButtons');

            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modalInput.style.display = 'block';
            modalInput.value = '';
            modalInput.focus();

            modalButtons.innerHTML = `
                <button class="modal-btn modal-btn-secondary" onclick="closeModal()">ì·¨ì†Œ</button>
                <button class="modal-btn modal-btn-primary" onclick="confirmPrompt()">í™•ì¸</button>
            `;

            window.promptCallback = callback;
            overlay.classList.add('active');

            // Enter í‚¤ë¡œ í™•ì¸
            modalInput.onkeypress = (e) => {
                if (e.key === 'Enter') confirmPrompt();
            };
        }

        function confirmPrompt() {
            const value = document.getElementById('modalInput').value.trim();
            closeModal();
            if (window.promptCallback) {
                window.promptCallback(value);
            }
        }

        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('active');
        }

        // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ì‹œ ë‹«ê¸°
        document.getElementById('modalOverlay').addEventListener('click', (e) => {
            if (e.target.id === 'modalOverlay') {
                closeModal();
            }
        });

        function loadItems() {
            fetch('/api/items')
                .then(res => res.json())
                .then(data => {
                    allItemsData = data;  // ì „ì²´ ë°ì´í„° ì €ì¥
                    renderFilteredItems();  // í†µí•© í•„í„°ë§ ë° ë Œë”ë§
                });
        }

        // ì „ì²´ ì„ íƒ/í•´ì œ
        function toggleSelectAll() {
            const selectAll = document.getElementById('selectAll');
            const checkboxes = document.querySelectorAll('.task-checkbox');
            checkboxes.forEach(cb => cb.checked = selectAll.checked);
        }

        // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateSelectAllState() {
            const selectAll = document.getElementById('selectAll');
            const checkboxes = document.querySelectorAll('.task-checkbox');
            const checkedCheckboxes = document.querySelectorAll('.task-checkbox:checked');

            if (checkboxes.length === 0) {
                selectAll.checked = false;
                selectAll.indeterminate = false;
            } else if (checkedCheckboxes.length === checkboxes.length) {
                selectAll.checked = true;
                selectAll.indeterminate = false;
            } else if (checkedCheckboxes.length > 0) {
                selectAll.checked = false;
                selectAll.indeterminate = true;
            } else {
                selectAll.checked = false;
                selectAll.indeterminate = false;
            }
        }

        // í•„í„° ë° ê²€ìƒ‰ í†µí•© ê´€ë¦¬
        let allItemsData = [];  // ì „ì²´ ë°ì´í„° ì €ì¥
        let currentPage = 1;
        let pageSize = 20;

        // í•„í„° ì ìš© (í†µí•©)
        function applyFilters() {
            renderFilteredItems();
        }

        // í˜ì´ì§€ í¬ê¸° ë³€ê²½
        function changePageSize() {
            const selectValue = document.getElementById('pageSizeSelect').value;
            if (selectValue === 'all') {
                pageSize = -1;  // ì „ì²´ ë³´ê¸°
            } else {
                pageSize = parseInt(selectValue);
            }
            currentPage = 1;  // ì²« í˜ì´ì§€ë¡œ ë¦¬ì…‹
            renderFilteredItems();
        }

        // í•„í„°ë§ ë° ë Œë”ë§
        function renderFilteredItems() {
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            const assignmentFilter = document.getElementById('assignmentFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;

            // ë‚ ì§œ í•„í„° ê°’ ê°€ì ¸ì˜¤ê¸°
            const createdFromDate = document.getElementById('createdFromDate').value;
            const createdToDate = document.getElementById('createdToDate').value;
            const assignedFromDate = document.getElementById('assignedFromDate').value;
            const assignedToDate = document.getElementById('assignedToDate').value;

            // í•„í„° ì ìš©
            let filteredData = allItemsData;

            // ë°°ì • í•„í„°
            if (assignmentFilter === 'assigned') {
                filteredData = filteredData.filter(item => item.assigned_to);
            } else if (assignmentFilter === 'unassigned') {
                filteredData = filteredData.filter(item => !item.assigned_to);
            }

            // ìƒíƒœ í•„í„°
            if (statusFilter !== 'all') {
                filteredData = filteredData.filter(item => item.status === statusFilter);
            }

            // ê²€ìƒ‰ í•„í„°
            if (searchText) {
                filteredData = filteredData.filter(item => {
                    const title = (item.title || '').toLowerCase();
                    const content = (item.content || '').toLowerCase();
                    const assignedTo = (item.assigned_to || '').toLowerCase();
                    return title.includes(searchText) || content.includes(searchText) || assignedTo.includes(searchText);
                });
            }

            // ë“±ë¡ì¼ í•„í„° (created_at)
            if (createdFromDate) {
                filteredData = filteredData.filter(item => {
                    if (!item.created_at) return false;
                    const itemDate = item.created_at.split(' ')[0]; // "2025-01-15 10:30:45" -> "2025-01-15"
                    return itemDate >= createdFromDate;
                });
            }
            if (createdToDate) {
                filteredData = filteredData.filter(item => {
                    if (!item.created_at) return false;
                    const itemDate = item.created_at.split(' ')[0];
                    return itemDate <= createdToDate;
                });
            }

            // ë°°ì •ì¼ í•„í„° (assigned_at)
            if (assignedFromDate) {
                filteredData = filteredData.filter(item => {
                    if (!item.assigned_at) return false;
                    const itemDate = item.assigned_at.split(' ')[0];
                    return itemDate >= assignedFromDate;
                });
            }
            if (assignedToDate) {
                filteredData = filteredData.filter(item => {
                    if (!item.assigned_at) return false;
                    const itemDate = item.assigned_at.split(' ')[0];
                    return itemDate <= assignedToDate;
                });
            }

            // ë‹¤ì¤‘ ì¡°ê±´ í•„í„° ì ìš©
            Object.keys(columnFilters).forEach(columnKey => {
                const filterConfig = columnFilters[columnKey];
                const logic = filterConfig.logic || 'AND';
                const conditions = filterConfig.conditions || [];

                if (conditions.length === 0) return;

                filteredData = filteredData.filter(item => {
                    const itemValue = item[columnKey];

                    const results = conditions.map(condition => {
                        const operator = condition.operator;

                        if (operator === 'is_empty') {
                            return !itemValue || itemValue === '';
                        }
                        if (operator === 'not_empty') {
                            return itemValue && itemValue !== '';
                        }

                        if (operator === 'in') {
                            return condition.values.includes(itemValue);
                        }
                        if (operator === 'not_in') {
                            return !condition.values.includes(itemValue);
                        }

                        const itemStr = String(itemValue || '').toLowerCase();
                        const filterStr = String(condition.value || '').toLowerCase();

                        if (operator === 'equals') return itemStr === filterStr;
                        if (operator === 'not_equals') return itemStr !== filterStr;
                        if (operator === 'contains') return itemStr.includes(filterStr);
                        if (operator === 'not_contains') return !itemStr.includes(filterStr);
                        if (operator === 'starts_with') return itemStr.startsWith(filterStr);
                        if (operator === 'ends_with') return itemStr.endsWith(filterStr);

                        const itemNum = parseFloat(itemValue);
                        const filterNum = parseFloat(condition.value);

                        if (operator === 'greater') return itemNum > filterNum;
                        if (operator === 'greater_equal') return itemNum >= filterNum;
                        if (operator === 'less') return itemNum < filterNum;
                        if (operator === 'less_equal') return itemNum <= filterNum;

                        if (operator === 'after') return itemValue > condition.value;
                        if (operator === 'after_equal') return itemValue >= condition.value;
                        if (operator === 'before') return itemValue < condition.value;
                        if (operator === 'before_equal') return itemValue <= condition.value;

                        if (operator === 'between') {
                            const val1 = parseFloat(condition.value);
                            const val2 = parseFloat(condition.value2);
                            return itemNum >= val1 && itemNum <= val2;
                        }

                        return true;
                    });

                    if (logic === 'OR') {
                        return results.some(r => r);
                    } else {
                        return results.every(r => r);
                    }
                });
            });

            // ì •ë ¬ ì ìš©
            if (sortState) {
                const col = sortState.column;
                const dir = sortState.direction;

                filteredData.sort((a, b) => {
                    let aVal = a[col];
                    let bVal = b[col];

                    // null/undefined ì²˜ë¦¬
                    if (aVal === null || aVal === undefined) aVal = '';
                    if (bVal === null || bVal === undefined) bVal = '';

                    // ìˆ«ì íƒ€ì…ì´ë©´ ìˆ«ìë¡œ ë¹„êµ
                    if (COLUMN_TYPES[col] === 'number') {
                        aVal = parseFloat(aVal) || 0;
                        bVal = parseFloat(bVal) || 0;
                    } else {
                        // ë¬¸ìì—´ë¡œ ë¹„êµ
                        aVal = String(aVal).toLowerCase();
                        bVal = String(bVal).toLowerCase();
                    }

                    if (aVal < bVal) return dir === 'asc' ? -1 : 1;
                    if (aVal > bVal) return dir === 'asc' ? 1 : -1;
                    return 0;
                });
            }

            // ê²°ê³¼ ê°œìˆ˜ ì—…ë°ì´íŠ¸
            document.getElementById('resultCount').textContent = `ê²€ìƒ‰ ê²°ê³¼: ${filteredData.length}ê°œ`;

            // í˜ì´ì§• ì²˜ë¦¬
            let pageData;
            let totalPages;

            if (pageSize === -1) {
                // ì „ì²´ ë³´ê¸°
                pageData = filteredData;
                totalPages = 1;
                currentPage = 1;
            } else {
                totalPages = Math.ceil(filteredData.length / pageSize);
                if (currentPage > totalPages && totalPages > 0) {
                    currentPage = totalPages;
                }
                const startIdx = (currentPage - 1) * pageSize;
                const endIdx = startIdx + pageSize;
                pageData = filteredData.slice(startIdx, endIdx);
            }

            // í…Œì´ë¸” í—¤ë” ë Œë”ë§
            renderTableHeader();

            // í…Œì´ë¸” ë°”ë”” ë Œë”ë§
            const tbody = document.getElementById('itemsList');
            const checkedIds = new Set(
                Array.from(document.querySelectorAll('.task-checkbox:checked'))
                    .map(cb => parseInt(cb.value))
            );
            tbody.innerHTML = '';

            if (!currentLayout) currentLayout = LAYOUT_PRESETS.default;
            const visibleCols = currentLayout.visible || currentLayout.columns;
            const colCount = visibleCols.length;
            const pinnedColumns = currentLayout.pinned || [];

            if (pageData.length === 0) {
                tbody.innerHTML = `<tr><td colspan="${colCount}" style="text-align: center; padding: 40px; color: #999;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
            } else {
                pageData.forEach(item => {
                    const tr = document.createElement('tr');
                    let rowHTML = '';

                    currentLayout.columns.forEach(colKey => {
                        if (!visibleCols.includes(colKey)) return;

                        const align = colKey === 'actions' ? 'center' : 'left';
                        let cellStyle = `padding: 12px; text-align: ${align}; border-bottom: 1px solid #ddd;`;

                        // Apply sticky positioning to pinned columns (leftëŠ” ë‚˜ì¤‘ì— JSë¡œ ì„¤ì •)
                        if (pinnedColumns.includes(colKey)) {
                            cellStyle += ` position: sticky; left: 0px; background: white; z-index: 1; box-shadow: 2px 0 4px rgba(0,0,0,0.1);`;
                        }

                        rowHTML += `<td style="${cellStyle}">${getCellContent(item, colKey)}</td>`;
                    });

                    tr.innerHTML = rowHTML;
                    tbody.appendChild(tr);

                    if (checkedIds.has(item.id)) {
                        const checkbox = tr.querySelector('.task-checkbox');
                        if (checkbox) checkbox.checked = true;
                    }
                });
            }

            // í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ ë Œë”ë§
            renderPagination(filteredData.length, totalPages);
            updateSelectAllState();

            // ë°”ë”” ë Œë”ë§ í›„ í•€ ìœ„ì¹˜ ì—…ë°ì´íŠ¸ (ìºì‹œëœ ê°’ ì‚¬ìš©)
            setTimeout(() => {
                if (Object.keys(cachedPinnedPositions).length > 0) {
                    updateBodyPinnedPositions(cachedPinnedPositions);
                }
            }, 0);
        }

        // í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ ë Œë”ë§
        function renderPagination(totalItems, totalPages) {
            const pageInfo = document.getElementById('pageInfo');
            const pageButtons = document.getElementById('paginationButtons');  // ì˜¬ë°”ë¥¸ IDë¡œ ìˆ˜ì •

            // í˜ì´ì§€ ì •ë³´ ì—…ë°ì´íŠ¸
            if (pageSize === -1) {
                // ì „ì²´ ë³´ê¸° ëª¨ë“œ
                pageInfo.textContent = totalItems > 0 ? `ì „ì²´ ${totalItems}ê°œ` : '0ê°œ';
            } else {
                const startIdx = (currentPage - 1) * pageSize + 1;
                const endIdx = Math.min(currentPage * pageSize, totalItems);
                pageInfo.textContent = totalItems > 0 ? `${startIdx}-${endIdx} / ${totalItems}` : '0 / 0';
            }

            // í˜ì´ì§€ ë²„íŠ¼ ìƒì„±
            pageButtons.innerHTML = '';

            // ì „ì²´ ë³´ê¸° ëª¨ë“œì´ê±°ë‚˜ í˜ì´ì§€ê°€ 1ê°œ ì´í•˜ë©´ ë²„íŠ¼ ìˆ¨ê¹€
            if (pageSize === -1 || totalPages <= 1) return;

            // ì´ì „ ë²„íŠ¼
            const prevBtn = document.createElement('button');
            prevBtn.textContent = 'â€¹';
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = () => goToPage(currentPage - 1);
            pageButtons.appendChild(prevBtn);

            // í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼ (ìµœëŒ€ 5ê°œ í‘œì‹œ)
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, startPage + 4);

            for (let i = startPage; i <= endPage; i++) {
                const btn = document.createElement('button');
                btn.textContent = i;
                btn.className = i === currentPage ? 'active' : '';
                btn.onclick = () => goToPage(i);
                pageButtons.appendChild(btn);
            }

            // ë‹¤ìŒ ë²„íŠ¼
            const nextBtn = document.createElement('button');
            nextBtn.textContent = 'â€º';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.onclick = () => goToPage(currentPage + 1);
            pageButtons.appendChild(nextBtn);
        }

        // í˜ì´ì§€ ì´ë™
        function goToPage(page) {
            currentPage = page;
            renderFilteredItems();
        }

        // ê²€ìƒ‰ ê¸°ëŠ¥ (í†µí•© í•„í„° í˜¸ì¶œ)
        function searchItems() {
            applyFilters();
        }

        // ë‚ ì§œ í•„í„° ì´ˆê¸°í™”
        function clearDateFilters() {
            document.getElementById('createdFromDate').value = '';
            document.getElementById('createdToDate').value = '';
            document.getElementById('assignedFromDate').value = '';
            document.getElementById('assignedToDate').value = '';
            applyFilters();
        }

        // ë¯¸ë°°ì • í•­ëª© ì „ì²´ ì„ íƒ
        function selectAllUnassigned() {
            fetch('/api/items')
                .then(res => res.json())
                .then(data => {
                    const unassignedIds = data.filter(item => !item.assigned_to).map(item => item.id);
                    document.querySelectorAll('.task-checkbox').forEach(cb => {
                        cb.checked = unassignedIds.includes(parseInt(cb.value));
                    });
                    updateSelectAllState();
                    showModal('ì™„ë£Œ', `${unassignedIds.length}ê°œì˜ ë¯¸ë°°ì • í•­ëª©ì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤.`, [
                        { text: 'í™•ì¸', type: 'primary', onclick: 'closeModal()' }
                    ]);
                });
        }

        // ì¼ê´„ ë°°ì • í•´ì œ (ë¯¸ë°°ì •ìœ¼ë¡œ ë³€ê²½)
        function bulkUnassign() {
            const selected = Array.from(document.querySelectorAll('.task-checkbox:checked')).map(cb => parseInt(cb.value));

            if (selected.length === 0) {
                showModal('ì˜¤ë¥˜', 'ë°°ì • í•´ì œí•  í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”.', [
                    { text: 'í™•ì¸', type: 'primary', onclick: 'closeModal()' }
                ]);
                return;
            }

            showModal('í™•ì¸', `ì„ íƒí•œ ${selected.length}ê°œ í•­ëª©ì˜ ë°°ì •ì„ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`, [
                { text: 'ì·¨ì†Œ', type: 'secondary', onclick: 'closeModal()' },
                { text: 'í™•ì¸', type: 'primary', onclick: 'closeModal(); proceedBulkUnassign(' + JSON.stringify(selected) + ')' }
            ]);
        }

        function proceedBulkUnassign(taskIds) {
            const promises = taskIds.map(id =>
                fetch('/api/items/' + id + '/unassign', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                })
            );

            Promise.all(promises)
                .then(responses => Promise.all(responses.map(r => r.json())))
                .then(results => {
                    const successCount = results.filter(r => r.success).length;
                    showModal('ì™„ë£Œ', `${successCount}ê°œ í•­ëª©ì˜ ë°°ì •ì´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.`, [
                        { text: 'í™•ì¸', type: 'primary', onclick: 'closeModal(); loadItems();' }
                    ]);
                })
                .catch(err => {
                    showModal('ì˜¤ë¥˜', 'ë°°ì • í•´ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + err.message, [
                        { text: 'í™•ì¸', type: 'primary', onclick: 'closeModal()' }
                    ]);
                });
        }

        // ì¼ê´„ ì‚­ì œ
        function bulkDelete() {
            const selected = Array.from(document.querySelectorAll('.task-checkbox:checked')).map(cb => parseInt(cb.value));

            if (selected.length === 0) {
                showModal('ì˜¤ë¥˜', 'ì‚­ì œí•  í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”.', [
                    { text: 'í™•ì¸', type: 'primary', onclick: 'closeModal()' }
                ]);
                return;
            }

            showModal('ê²½ê³ ', `ì„ íƒí•œ ${selected.length}ê°œ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br><span style="color: #f44336; font-weight: bold;">ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</span>`, [
                { text: 'ì·¨ì†Œ', type: 'secondary', onclick: 'closeModal()' },
                { text: 'ì‚­ì œ', type: 'danger', onclick: 'closeModal(); proceedBulkDelete(' + JSON.stringify(selected) + ')' }
            ]);
        }

        function proceedBulkDelete(taskIds) {
            const promises = taskIds.map(id =>
                fetch('/api/items/' + id, {
                    method: 'DELETE'
                })
            );

            Promise.all(promises)
                .then(responses => Promise.all(responses.map(r => r.json())))
                .then(results => {
                    const successCount = results.filter(r => r.success).length;
                    showModal('ì™„ë£Œ', `${successCount}ê°œ í•­ëª©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`, [
                        { text: 'í™•ì¸', type: 'primary', onclick: 'closeModal(); loadItems();' }
                    ]);
                })
                .catch(err => {
                    showModal('ì˜¤ë¥˜', 'ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + err.message, [
                        { text: 'í™•ì¸', type: 'primary', onclick: 'closeModal()' }
                    ]);
                });
        }

        // í• ì¼ ë“±ë¡ ëª¨ë‹¬ ì—´ê¸°
        function openTaskRegistrationModal() {
            document.getElementById('taskRegistrationModal').classList.add('active');
        }

        // í• ì¼ ë“±ë¡ ëª¨ë‹¬ ë‹«ê¸°
        function closeTaskRegistrationModal() {
            document.getElementById('taskRegistrationModal').classList.remove('active');
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('taskRegModalAssignedTo').value = '';
            document.getElementById('taskRegModalTitle').value = '';
            document.getElementById('taskRegModalContent').value = '';
            document.getElementById('taskRegModalExcelFile').value = '';
        }

        // ëª¨ë‹¬ì—ì„œ ë‹¨ì¼ í•­ëª© ì¶”ê°€
        function addSingleItemFromModal() {
            const assignedTo = document.getElementById('taskRegModalAssignedTo').value.trim();
            const title = document.getElementById('taskRegModalTitle').value.trim();
            const content = document.getElementById('taskRegModalContent').value.trim();

            if (!title || !content) {
                showToast('âš ï¸ ì…ë ¥ ì˜¤ë¥˜', 'ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }

            const data = { title, content };
            if (assignedTo) {
                data.assigned_to = assignedTo;
            }

            fetch('/api/items', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showToast('âœ… ì„±ê³µ', 'í• ì¼ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                    document.getElementById('taskRegModalAssignedTo').value = '';
                    document.getElementById('taskRegModalTitle').value = '';
                    document.getElementById('taskRegModalContent').value = '';
                    // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    loadItems();
                } else {
                    showToast('âŒ ì‹¤íŒ¨', data.message || 'ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showToast('âŒ ì˜¤ë¥˜', 'ì„œë²„ì™€ì˜ í†µì‹ ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            });
        }

        // ì—‘ì…€ ì„œì‹ ë‹¤ìš´ë¡œë“œ
        function downloadExcelTemplate() {
            // ê°„ë‹¨í•œ CSV í˜•ì‹ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ
            const csvContent = "ì œëª©,ë‚´ìš©,ëŒ€ìƒì\n" +
                               "í• ì¼ ì œëª© ì˜ˆì‹œ,í• ì¼ ë‚´ìš© ì˜ˆì‹œ,í™ê¸¸ë™\n" +
                               "ë‘ ë²ˆì§¸ í• ì¼,ë‘ ë²ˆì§¸ ë‚´ìš©,ê¹€ì² ìˆ˜\n" +
                               "ì„¸ ë²ˆì§¸ í• ì¼,ì„¸ ë²ˆì§¸ ë‚´ìš©,";

            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'í• ì¼_ë“±ë¡_ì„œì‹.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showToast('ğŸ“¥ ë‹¤ìš´ë¡œë“œ', 'ì„œì‹ íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ëª¨ë‹¬ì—ì„œ ì—‘ì…€ ì—…ë¡œë“œ
        function uploadExcelFromModal() {
            const fileInput = document.getElementById('taskRegModalExcelFile');
            const file = fileInput.files[0];

            if (!file) {
                showToast('âš ï¸ íŒŒì¼ ì„ íƒ', 'ì—…ë¡œë“œí•  ì—‘ì…€ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }

            const formData = new FormData();
            formData.append('file', file);

            showToast('â³ ì—…ë¡œë“œ ì¤‘', 'ì—‘ì…€ íŒŒì¼ì„ ì²˜ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤...');

            fetch('/api/items/bulk-upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showToast('âœ… ì„±ê³µ', `${data.count || 0}ê°œì˜ í• ì¼ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    fileInput.value = '';
                    loadItems();
                } else {
                    showToast('âŒ ì‹¤íŒ¨', data.message || 'ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showToast('âŒ ì˜¤ë¥˜', 'íŒŒì¼ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            });
        }

        // ì¼ê´„ ë°°ì • ëª¨ë‹¬ ì—´ê¸°
        function openBulkAssignModal() {
            const selected = Array.from(document.querySelectorAll('.task-checkbox:checked')).map(cb => parseInt(cb.value));

            if (selected.length === 0) {
                showModal('ì˜¤ë¥˜', 'ë°°ì •í•  í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”.', [
                    { text: 'í™•ì¸', type: 'primary', onclick: 'closeModal()' }
                ]);
                return;
            }

            // íŒ€ ëª©ë¡ê³¼ ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ
            Promise.all([
                fetch('/api/teams').then(res => res.json()),
                fetch('/api/users/by-team?team=ì „ì²´').then(res => res.json())
            ])
                .then(([teams, users]) => {
                    if (users.length === 0) {
                        showModal('ì˜¤ë¥˜', 'ë°°ì • ê°€ëŠ¥í•œ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.', [
                            { text: 'í™•ì¸', type: 'primary', onclick: 'closeModal()' }
                        ]);
                        return;
                    }

                    window.allUsersData = users; // ì „ì²´ ì‚¬ìš©ì ë°ì´í„° ì €ì¥
                    window.teamsData = teams; // íŒ€ ë°ì´í„° ì €ì¥

                    showBulkAssignModal(selected, teams, users);
                });
        }

        // ì¼ê´„ ë°°ì • ëª¨ë‹¬ í‘œì‹œ
        function showBulkAssignModal(selected, teams, users) {
            const overlay = document.getElementById('modalOverlay');
            const modalTitle = document.getElementById('modalTitle');
            const modalMessage = document.getElementById('modalMessage');
            const modalInput = document.getElementById('modalInput');
            const modalContent = document.getElementById('modalContent');
            const modalButtons = document.getElementById('modalButtons');

            modalTitle.textContent = 'ì¼ê´„ ë°°ì •';
            modalMessage.textContent = `${selected.length}ê°œ í•­ëª©ì„ ë°°ì •í•©ë‹ˆë‹¤.`;
            modalInput.style.display = 'none';

            // ì‚¬ìš©ì ì„ íƒ UI
            modalContent.style.display = 'block';
            modalContent.innerHTML = `
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">íŒ€ ì„ íƒ:</label>
                    <select id="teamFilter" onchange="onTeamChange(${JSON.stringify(selected)})" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 15px;">
                        <option value="ì „ì²´">ì „ì²´</option>
                        ${teams.map(team => `<option value="${team}">${team}</option>`).join('')}
                    </select>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">ë°°ì • ë°©ì‹:</label>
                    <select id="assignMode" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="random">ëœë¤ ë°°ì • (ê° í• ì¼ì„ ë¬´ì‘ìœ„ ì‚¬ìš©ìì—ê²Œ)</option>
                        <option value="sequential">ìˆœì°¨ ë°°ì • (ì„ íƒí•œ ì‚¬ìš©ì ìˆœì„œëŒ€ë¡œ ëŒì•„ê°€ë©°)</option>
                    </select>
                </div>
                <div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                        <label style="font-weight: bold;">ë°°ì •í•  ì‚¬ìš©ì (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥):</label>
                        <div style="display: flex; gap: 5px;">
                            <button onclick="selectAllUsers()" style="padding: 4px 8px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">ì „ì²´ ì„ íƒ</button>
                            <button onclick="deselectAllUsers()" style="padding: 4px 8px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">ì„ íƒ í•´ì œ</button>
                        </div>
                    </div>
                    <input type="text" id="userSearchInput" placeholder="ì‚¬ìš©ì ì´ë¦„ ê²€ìƒ‰..." onkeyup="filterUsers()" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 10px; font-size: 14px;">
                    <div id="userListContainer" style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; padding: 0; background: white;">
                        ${users.map((user, index) => `
                            <label class="user-item" style="display: flex; align-items: center; padding: 12px 15px; cursor: pointer; border-bottom: ${index < users.length - 1 ? '1px solid #f0f0f0' : 'none'}; transition: background 0.2s;">
                                <input type="checkbox" class="user-checkbox" value="${user}" onchange="updateSelectedCount()" style="margin: 0; width: 18px; height: 18px; cursor: pointer; flex-shrink: 0;">
                                <span style="margin-left: 12px; font-size: 14px; color: #333;">${user}</span>
                            </label>
                        `).join('')}
                    </div>
                    <style>
                        .user-item:hover {
                            background: #f8f9fa !important;
                        }
                        .user-checkbox:checked + span {
                            font-weight: bold;
                            color: #007bff;
                        }
                    </style>
                    <div style="margin-top: 5px; font-size: 12px; color: #666;">
                        ì„ íƒë¨: <span id="selectedCount">0</span> / ${users.length}ëª…
                    </div>
                </div>
            `;

            modalButtons.innerHTML = `
                <button class="modal-btn modal-btn-secondary" onclick="closeModal()">ì·¨ì†Œ</button>
                <button class="modal-btn modal-btn-primary" onclick="confirmBulkAssign(${JSON.stringify(selected)})">ë°°ì •</button>
            `;

            overlay.classList.add('active');
        }

        // íŒ€ ì„ íƒ ë³€ê²½ ì‹œ ì‚¬ìš©ì ëª©ë¡ ì—…ë°ì´íŠ¸
        function onTeamChange(selected) {
            const team = document.getElementById('teamFilter').value;

            fetch(`/api/users/by-team?team=${encodeURIComponent(team)}`)
                .then(res => res.json())
                .then(users => {
                    if (users.length === 0) {
                        showModal('ì˜¤ë¥˜', 'í•´ë‹¹ íŒ€ì— ë°°ì • ê°€ëŠ¥í•œ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.', [
                            { text: 'í™•ì¸', type: 'primary', onclick: 'closeModal()' }
                        ]);
                        return;
                    }

                    // ì‚¬ìš©ì ëª©ë¡ ì—…ë°ì´íŠ¸
                    const userListContainer = document.getElementById('userListContainer');
                    userListContainer.innerHTML = users.map((user, index) => `
                        <label class="user-item" style="display: flex; align-items: center; padding: 12px 15px; cursor: pointer; border-bottom: ${index < users.length - 1 ? '1px solid #f0f0f0' : 'none'}; transition: background 0.2s;">
                            <input type="checkbox" class="user-checkbox" value="${user}" onchange="updateSelectedCount()" style="margin: 0; width: 18px; height: 18px; cursor: pointer; flex-shrink: 0;">
                            <span style="margin-left: 12px; font-size: 14px; color: #333;">${user}</span>
                        </label>
                    `).join('');

                    // ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
                    const selectedCountElement = document.getElementById('selectedCount');
                    if (selectedCountElement) {
                        selectedCountElement.textContent = '0';
                        selectedCountElement.parentElement.innerHTML = `ì„ íƒë¨: <span id="selectedCount">0</span> / ${users.length}ëª…`;
                    }
                })
                .catch(err => {
                    console.error('íŒ€ë³„ ì‚¬ìš©ì ì¡°íšŒ ì‹¤íŒ¨:', err);
                });
        }

        // ì‚¬ìš©ì ê²€ìƒ‰ í•„í„°
        function filterUsers() {
            const searchInput = document.getElementById('userSearchInput');
            const filter = searchInput.value.toLowerCase();
            const userItems = document.querySelectorAll('.user-item');

            userItems.forEach(item => {
                const username = item.textContent.trim().toLowerCase();
                if (username.includes(filter)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // ì„ íƒ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
        function updateSelectedCount() {
            const selectedCount = document.querySelectorAll('.user-checkbox:checked').length;
            const countElement = document.getElementById('selectedCount');
            if (countElement) {
                countElement.textContent = selectedCount;
            }
        }

        // ì‚¬ìš©ì ì „ì²´ ì„ íƒ (ê²€ìƒ‰ í•„í„° ì ìš©)
        function selectAllUsers() {
            document.querySelectorAll('.user-item').forEach(item => {
                if (item.style.display !== 'none') {
                    const checkbox = item.querySelector('.user-checkbox');
                    checkbox.checked = true;
                }
            });
            updateSelectedCount();
        }

        // ì‚¬ìš©ì ì„ íƒ í•´ì œ (ê²€ìƒ‰ í•„í„° ì ìš©)
        function deselectAllUsers() {
            document.querySelectorAll('.user-item').forEach(item => {
                if (item.style.display !== 'none') {
                    const checkbox = item.querySelector('.user-checkbox');
                    checkbox.checked = false;
                }
            });
            updateSelectedCount();
        }

        // ì¼ê´„ ë°°ì • í™•ì¸
        function confirmBulkAssign(taskIds) {
            const selectedUsers = Array.from(document.querySelectorAll('.user-checkbox:checked')).map(cb => cb.value);
            const mode = document.getElementById('assignMode').value;

            if (selectedUsers.length === 0) {
                showModal('ì˜¤ë¥˜', 'ë°°ì •í•  ì‚¬ìš©ìë¥¼ ì„ íƒí•˜ì„¸ìš”.', [
                    { text: 'í™•ì¸', type: 'primary', onclick: 'closeModal()' }
                ]);
                return;
            }

            // í• ì¼ ìˆ˜ê°€ ì‚¬ìš©ì ìˆ˜ë³´ë‹¤ ì ìœ¼ë©´ ê²½ê³ 
            if (taskIds.length < selectedUsers.length) {
                window.tempBulkAssignData = { taskIds, selectedUsers, mode };
                showModal('ë°°ì • ìˆ˜ëŸ‰ ë¶€ì¡±',
                    `ë°°ì •í•  í• ì¼(${taskIds.length}ê°œ)ì´ ì„ íƒí•œ ì‚¬ìš©ì(${selectedUsers.length}ëª…)ë³´ë‹¤ ì ìŠµë‹ˆë‹¤.\n` +
                    `ì¼ë¶€ ì‚¬ìš©ìëŠ” í• ì¼ì„ ë°›ì§€ ëª»í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nê³„ì† ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`, [
                    { text: 'ì·¨ì†Œ', type: 'secondary', onclick: 'closeModal(); openBulkAssignModal();' },
                    { text: 'ê³„ì†', type: 'primary', onclick: 'closeModal(); proceedBulkAssign(window.tempBulkAssignData.taskIds, window.tempBulkAssignData.selectedUsers, window.tempBulkAssignData.mode);' }
                ]);
                return;
            }

            // ë‚˜ë¨¸ì§€ê°€ ë°œìƒí•˜ëŠ” ê²½ìš°: ëª¨ë“œì— ë”°ë¼ ë‹¤ë¥´ê²Œ ì²˜ë¦¬
            const remainder = taskIds.length % selectedUsers.length;
            if (remainder > 0) {
                const assignableCount = taskIds.length - remainder;
                const perUser = Math.floor(taskIds.length / selectedUsers.length);

                if (mode === 'sequential') {
                    // ìˆœì°¨ ë°°ì •: ë‚˜ë¨¸ì§€ëŠ” ë¯¸ë°°ì •
                    window.tempBulkAssignData = { taskIds: taskIds.slice(0, assignableCount), selectedUsers, mode };
                    showModal('ë‚˜ë¨¸ì§€ í• ì¼ ì²˜ë¦¬',
                        `í• ì¼ ${taskIds.length}ê°œë¥¼ ${selectedUsers.length}ëª…ì—ê²Œ ë°°ì •í•˜ë©´ ${remainder}ê°œê°€ ë‚¨ìŠµë‹ˆë‹¤.\n` +
                        `${assignableCount}ê°œë§Œ ë°°ì •(1ì¸ë‹¹ ${perUser}ê±´)í•˜ê³  ë‚˜ë¨¸ì§€ ${remainder}ê°œëŠ” ë¯¸ë°°ì • ìƒíƒœë¡œ ë‘ì‹œê² ìŠµë‹ˆê¹Œ?`, [
                        { text: 'ì·¨ì†Œ', type: 'secondary', onclick: 'closeModal(); openBulkAssignModal();' },
                        { text: 'í™•ì¸', type: 'primary', onclick: 'closeModal(); proceedBulkAssign(window.tempBulkAssignData.taskIds, window.tempBulkAssignData.selectedUsers, window.tempBulkAssignData.mode);' }
                    ]);
                    return;
                } else if (mode === 'random') {
                    // ëœë¤ ë°°ì •: ë‚˜ë¨¸ì§€ë„ ëœë¤í•˜ê²Œ ì¶”ê°€ ë°°ì •
                    window.tempBulkAssignData = { taskIds, selectedUsers, mode };
                    showModal('ë‚˜ë¨¸ì§€ í• ì¼ ì²˜ë¦¬',
                        `í• ì¼ ${taskIds.length}ê°œë¥¼ ${selectedUsers.length}ëª…ì—ê²Œ ë°°ì •í•©ë‹ˆë‹¤.\n` +
                        `ëª¨ë‘ì—ê²Œ ìµœì†Œ ${perUser}ê±´ì”© ë°°ì •í•˜ê³ , ë‚˜ë¨¸ì§€ ${remainder}ê±´ì€ ëœë¤í•˜ê²Œ ì¶”ê°€ ë°°ì •í•©ë‹ˆë‹¤.\nê³„ì† ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`, [
                        { text: 'ì·¨ì†Œ', type: 'secondary', onclick: 'closeModal(); openBulkAssignModal();' },
                        { text: 'í™•ì¸', type: 'primary', onclick: 'closeModal(); proceedBulkAssign(window.tempBulkAssignData.taskIds, window.tempBulkAssignData.selectedUsers, window.tempBulkAssignData.mode);' }
                    ]);
                    return;
                }
            }

            closeModal();
            proceedBulkAssign(taskIds, selectedUsers, mode);
        }

        // ì‹¤ì œ ë°°ì • ì‹¤í–‰
        function proceedBulkAssign(taskIds, selectedUsers, mode) {

            fetch('/api/items/bulk-assign', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    task_ids: taskIds,
                    mode: mode,
                    users: selectedUsers
                })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    // ë°°ì • ê²°ê³¼ ê³„ì‚°
                    const tasksPerUser = Math.floor(taskIds.length / selectedUsers.length);
                    const modeText = mode === 'random' ? 'ëœë¤ ë°°ì •' : 'ìˆœì°¨ ë°°ì •';

                    let resultMessage = `âœ… ${modeText} ì™„ë£Œ\n\n`;
                    resultMessage += `ğŸ“‹ ì´ ${data.count}ê°œ í• ì¼ì´ ${selectedUsers.length}ëª…ì—ê²Œ ë°°ì •ë˜ì—ˆìŠµë‹ˆë‹¤.\n\n`;

                    if (mode === 'sequential') {
                        resultMessage += `ğŸ‘¥ ë°°ì • ë‚´ì—­:\n`;
                        selectedUsers.forEach((user, index) => {
                            const count = index < (taskIds.length % selectedUsers.length) ? tasksPerUser + 1 : tasksPerUser;
                            resultMessage += `   â€¢ ${user}: ${count}ê±´\n`;
                        });
                    } else {
                        resultMessage += `ğŸ‘¥ ê° ì‚¬ìš©ìê°€ ë¬´ì‘ìœ„ë¡œ í• ì¼ì„ ë°›ì•˜ìŠµë‹ˆë‹¤.\n`;
                        resultMessage += `   (í‰ê·  ì•½ ${tasksPerUser}ê±´)`;
                    }

                    showModal('ë°°ì • ì™„ë£Œ', resultMessage, [
                        { text: 'í™•ì¸', type: 'primary', onclick: 'closeModal(); loadItems();' }
                    ]);
                    document.getElementById('selectAll').checked = false;
                } else {
                    showModal('ì˜¤ë¥˜', data.error || 'ë°°ì • ì‹¤íŒ¨', [
                        { text: 'í™•ì¸', type: 'primary', onclick: 'closeModal()' }
                    ]);
                }
            })
            .catch(err => {
                showModal('ì˜¤ë¥˜', 'ë°°ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + err.message, [
                    { text: 'í™•ì¸', type: 'primary', onclick: 'closeModal()' }
                ]);
            });
        }


        function editItem(id) {
            fetch('/api/items')
                .then(res => res.json())
                .then(data => {
                    const item = data.find(i => i.id === id);
                    if (item) {
                        // ìˆ˜ì • ëª¨ë‹¬ í‘œì‹œ
                        showModal('í• ì¼ ìˆ˜ì •', `
                            <div style="text-align: left;">
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">ë°°ì • ëŒ€ìƒ:</label>
                                    <input type="text" id="editModalAssignedTo" value="${item.assigned_to || ''}" placeholder="ë°°ì • ëŒ€ìƒ ì…ë ¥ (ì„ íƒ)" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">ì œëª©:</label>
                                    <input type="text" id="editModalTitle" value="${item.title || ''}" placeholder="ì œëª© ì…ë ¥" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">ë‚´ìš©:</label>
                                    <textarea id="editModalContent" placeholder="ë‚´ìš© ì…ë ¥" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; min-height: 120px; resize: vertical;">${item.content || ''}</textarea>
                                </div>
                            </div>
                        `, [
                            { text: 'ì·¨ì†Œ', type: 'secondary', onclick: 'closeModal()' },
                            { text: 'ìˆ˜ì •', type: 'primary', onclick: `confirmEdit(${id})` }
                        ]);
                    }
                });
        }

        function confirmEdit(id) {
            const assignedTo = document.getElementById('editModalAssignedTo').value.trim();
            const title = document.getElementById('editModalTitle').value.trim();
            const content = document.getElementById('editModalContent').value.trim();

            if (!title) {
                alert('ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }

            const data = { title, content };
            if (assignedTo) {
                data.assigned_to = assignedTo;
            }

            fetch(`/api/items/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(res => res.json())
            .then(() => {
                closeModal();
                loadItems();
                showModal('ì™„ë£Œ', 'ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.', [
                    { text: 'í™•ì¸', type: 'primary', onclick: 'closeModal()' }
                ]);
            })
            .catch(err => {
                closeModal();
                showModal('ì˜¤ë¥˜', 'ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + err.message, [
                    { text: 'í™•ì¸', type: 'primary', onclick: 'closeModal()' }
                ]);
            });
        }

        function deleteItem(id) {
            showModal('ì‚­ì œ í™•ì¸', 'ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', [
                { text: 'ì·¨ì†Œ', type: 'secondary', onclick: 'closeModal()' },
                { text: 'ì‚­ì œ', type: 'danger', onclick: `confirmDelete(${id})` }
            ]);
        }

        function confirmDelete(id) {
            closeModal();
            fetch(`/api/items/${id}`, { method: 'DELETE' })
                .then(() => {
                    loadItems();
                    showModal('ì™„ë£Œ', 'ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', [
                        { text: 'í™•ì¸', type: 'primary', onclick: 'closeModal()' }
                    ]);
                });
        }


        function assignItem(id) {
            showPromptModal('í• ì¼ ë°°ì •', 'ë°°ì •í•  ì‚¬ìš©ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:', (username) => {
                if (!username) return;

                fetch(`/api/items/${id}/assign`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ assigned_to: username })
                })
                .then(res => res.json())
                .then(() => {
                    loadItems();
                    showModal('ì™„ë£Œ', 'ë°°ì •ë˜ì—ˆìŠµë‹ˆë‹¤.', [
                        { text: 'í™•ì¸', type: 'primary', onclick: 'closeModal()' }
                    ]);
                });
            });
        }

        function unassignItem(id) {
            showModal('íšŒìˆ˜ í™•ì¸', 'ì´ í• ì¼ì„ íšŒìˆ˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', [
                { text: 'ì·¨ì†Œ', type: 'secondary', onclick: 'closeModal()' },
                { text: 'íšŒìˆ˜', type: 'primary', onclick: `confirmUnassign(${id})` }
            ]);
        }

        function confirmUnassign(id) {
            closeModal();
            fetch(`/api/items/${id}/assign`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ assigned_to: null })
            })
            .then(res => res.json())
            .then(() => {
                loadItems();
                showModal('ì™„ë£Œ', 'íšŒìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.', [
                    { text: 'í™•ì¸', type: 'primary', onclick: 'closeModal()' }
                ]);
            });
        }

        // ì‚¬ìš©ìë³„ roomì— join (ì „ì—­ ì•Œë¦¼ ë°›ê¸° ìœ„í•¨)
        socket.emit('join_user_room', { username: currentUsername });

        // í† ìŠ¤íŠ¸ ì•Œë¦¼ í‘œì‹œ
        function showToast(chatId, title, message, sender) {
            console.log('í† ìŠ¤íŠ¸ ì•Œë¦¼ í‘œì‹œ:', chatId, title, message);
            const toastContainer = document.getElementById('toastContainer');

            const toast = document.createElement('div');
            toast.className = 'toast';

            // HTML ì´ìŠ¤ì¼€ì´í”„
            const escapeHtml = (text) => {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            };

            toast.innerHTML = `
                <div class="toast-icon">ğŸ’¬</div>
                <div class="toast-content">
                    <div class="toast-title">${escapeHtml(title)}</div>
                    <div class="toast-message">${escapeHtml(sender)}: ${escapeHtml(message)}</div>
                </div>
                <button class="toast-close">Ã—</button>
            `;

            // X ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            const closeBtn = toast.querySelector('.toast-close');
            closeBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                closeToastElement(toast);
            });

            // í† ìŠ¤íŠ¸ í´ë¦­ì‹œ ì±„íŒ…ë°©ìœ¼ë¡œ ì´ë™
            toast.addEventListener('click', () => {
                location.href = `/chat/${chatId}`;
            });

            toastContainer.appendChild(toast);
            console.log('í† ìŠ¤íŠ¸ ì¶”ê°€ë¨:', toast);

            // 5ì´ˆ í›„ ìë™ ì œê±°
            setTimeout(() => {
                closeToastElement(toast);
            }, 5000);
        }

        function closeToastElement(toast) {
            if (!toast || !toast.classList) return;
            toast.classList.add('slide-out');
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, 300);
        }

        // ì „ì—­ ìƒˆ ë©”ì‹œì§€ ì•Œë¦¼ ìˆ˜ì‹ 
        socket.on('global_new_message', (data) => {
            console.log('ì „ì—­ ìƒˆ ë©”ì‹œì§€ ìˆ˜ì‹ :', data);

            // 1:1 ì±„íŒ…ì¸ ê²½ìš° ìƒëŒ€ë°© ì´ë¦„, ê·¸ë£¹ ì±„íŒ…ì¸ ê²½ìš° ì±„íŒ…ë°© ì œëª© í‘œì‹œ
            let displayTitle = data.chat_title;
            if (data.is_one_to_one) {
                const otherUser = data.participants.find(p => p !== currentUsername);
                displayTitle = otherUser || data.chat_title;
            }

            // í† ìŠ¤íŠ¸ ì•Œë¦¼ í‘œì‹œ
            showToast(data.chat_id, displayTitle, data.message, data.sender);

            // íƒ­ì´ í¬ì»¤ìŠ¤ë˜ì–´ ìˆì§€ ì•Šìœ¼ë©´ ì œëª© ê¹œë¹¡ì„
            if (!document.hasFocus()) {
                unreadCount++;
                startTitleBlink();
            }
        });

        window.addEventListener('focus', () => {
            unreadCount = 0;
            stopTitleBlink();
            document.title = originalTitle;
        });

        function startTitleBlink() {
            if (titleBlinkInterval) return;
            let isOriginal = true;
            titleBlinkInterval = setInterval(() => {
                document.title = isOriginal ? `ğŸ”´ (${unreadCount}) ìƒˆ ë©”ì‹œì§€` : originalTitle;
                isOriginal = !isOriginal;
            }, 1000);
        }

        function stopTitleBlink() {
            if (titleBlinkInterval) {
                clearInterval(titleBlinkInterval);
                titleBlinkInterval = null;
            }
        }

        // ë ˆì´ì•„ì›ƒ ê´€ë¦¬ í•¨ìˆ˜ë“¤
        function getStorageKey(key) {
            return `crm_${currentUsername}_${key}`;
        }

        // ì»¤ìŠ¤í…€ ë ˆì´ì•„ì›ƒ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        function getCustomLayouts() {
            const layoutsJson = localStorage.getItem(getStorageKey('customLayouts'));
            return layoutsJson ? JSON.parse(layoutsJson) : {};
        }

        // ì»¤ìŠ¤í…€ ë ˆì´ì•„ì›ƒ ì €ì¥
        function setCustomLayouts(layouts) {
            localStorage.setItem(getStorageKey('customLayouts'), JSON.stringify(layouts));
        }

        // ë ˆì´ì•„ì›ƒ ì…€ë ‰í„° ì—…ë°ì´íŠ¸
        function updateLayoutSelector() {
            const customLayouts = getCustomLayouts();
            const customGroup = document.getElementById('customLayoutsGroup');

            // ê¸°ì¡´ ì˜µì…˜ ì œê±°
            customGroup.innerHTML = '';

            // ì»¤ìŠ¤í…€ ë ˆì´ì•„ì›ƒ ì˜µì…˜ ì¶”ê°€
            Object.keys(customLayouts).forEach(layoutId => {
                const layout = customLayouts[layoutId];
                const option = document.createElement('option');
                option.value = `custom:${layoutId}`;
                option.textContent = layout.name;
                customGroup.appendChild(option);
            });
        }

        function loadLayoutPreset() {
            const presetValue = document.getElementById('layoutPreset').value;

            if (presetValue.startsWith('custom:')) {
                // ì»¤ìŠ¤í…€ ë ˆì´ì•„ì›ƒ
                const layoutId = presetValue.substring(7); // 'custom:' ì œê±°
                const customLayouts = getCustomLayouts();

                if (customLayouts[layoutId]) {
                    currentLayout = customLayouts[layoutId].layout;
                } else {
                    showModal('ì˜¤ë¥˜', 'ë ˆì´ì•„ì›ƒì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ ë ˆì´ì•„ì›ƒì„ ì‚¬ìš©í•©ë‹ˆë‹¤.', [
                        { text: 'í™•ì¸', type: 'primary', onclick: 'closeModal()' }
                    ]);
                    document.getElementById('layoutPreset').value = 'default';
                    currentLayout = LAYOUT_PRESETS.default;
                }
            } else {
                // ê¸°ë³¸ í”„ë¦¬ì…‹
                currentLayout = LAYOUT_PRESETS[presetValue];
            }

            // ë§ˆì§€ë§‰ ì„ íƒ ì €ì¥ (ì‚¬ìš©ìë³„)
            localStorage.setItem(getStorageKey('lastLayoutPreset'), presetValue);
            renderFilteredItems();
        }

        // ìƒˆ ë ˆì´ì•„ì›ƒ ì €ì¥ ë‹¤ì´ì–¼ë¡œê·¸
        function openSaveLayoutDialog() {
            if (!currentLayout) {
                showModal('ì˜¤ë¥˜', 'í˜„ì¬ ë ˆì´ì•„ì›ƒì´ ì—†ìŠµë‹ˆë‹¤.', [
                    { text: 'í™•ì¸', type: 'primary', onclick: 'closeModal()' }
                ]);
                return;
            }

            showModal('ë ˆì´ì•„ì›ƒ ì €ì¥', `
                <div style="text-align: left;">
                    <p style="margin-bottom: 15px; color: #666;">í˜„ì¬ ì»¬ëŸ¼ ì„¤ì •ì„ ì €ì¥í•©ë‹ˆë‹¤.</p>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">ë ˆì´ì•„ì›ƒ ì´ë¦„:</label>
                        <input type="text" id="layoutNameInput" placeholder="ì˜ˆ: ì‘ì—…ìš© ë ˆì´ì•„ì›ƒ" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                    </div>
                </div>
            `, [
                { text: 'ì·¨ì†Œ', type: 'secondary', onclick: 'closeModal()' },
                { text: 'ì €ì¥', type: 'primary', onclick: 'confirmSaveLayout()' }
            ]);

            setTimeout(() => {
                document.getElementById('layoutNameInput').focus();
            }, 100);
        }

        function confirmSaveLayout() {
            const layoutName = document.getElementById('layoutNameInput').value.trim();

            if (!layoutName) {
                alert('ë ˆì´ì•„ì›ƒ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }

            // ê³ ìœ  ID ìƒì„± (íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜)
            const layoutId = `layout_${Date.now()}`;

            // ì»¤ìŠ¤í…€ ë ˆì´ì•„ì›ƒ ì €ì¥
            const customLayouts = getCustomLayouts();
            customLayouts[layoutId] = {
                name: layoutName,
                layout: currentLayout,
                createdAt: new Date().toISOString()
            };
            setCustomLayouts(customLayouts);

            // ì…€ë ‰í„° ì—…ë°ì´íŠ¸
            updateLayoutSelector();

            // ë°©ê¸ˆ ì €ì¥í•œ ë ˆì´ì•„ì›ƒìœ¼ë¡œ ì„ íƒ
            document.getElementById('layoutPreset').value = `custom:${layoutId}`;
            localStorage.setItem(getStorageKey('lastLayoutPreset'), `custom:${layoutId}`);

            closeModal();
            showModal('ì™„ë£Œ', `"${layoutName}" ë ˆì´ì•„ì›ƒì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`, [
                { text: 'í™•ì¸', type: 'primary', onclick: 'closeModal()' }
            ]);
        }

        // ë ˆì´ì•„ì›ƒ ê´€ë¦¬ ë‹¤ì´ì–¼ë¡œê·¸
        function openManageLayoutsDialog() {
            const customLayouts = getCustomLayouts();
            const layoutKeys = Object.keys(customLayouts);

            if (layoutKeys.length === 0) {
                showModal('ë ˆì´ì•„ì›ƒ ê´€ë¦¬', 'ì €ì¥ëœ ë ˆì´ì•„ì›ƒì´ ì—†ìŠµë‹ˆë‹¤.', [
                    { text: 'í™•ì¸', type: 'primary', onclick: 'closeModal()' }
                ]);
                return;
            }

            let html = '<div style="text-align: left;">';
            html += '<p style="margin-bottom: 15px; color: #666;">ì €ì¥ëœ ë ˆì´ì•„ì›ƒì„ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>';
            html += '<div style="max-height: 400px; overflow-y: auto;">';

            layoutKeys.forEach(layoutId => {
                const layout = customLayouts[layoutId];
                const createdDate = new Date(layout.createdAt).toLocaleString('ko-KR');

                html += `
                    <div style="background: #f8f9fa; padding: 15px; margin-bottom: 10px; border-radius: 6px; border-left: 4px solid #667eea;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="flex: 1;">
                                <div style="font-weight: bold; font-size: 15px; margin-bottom: 5px;">${layout.name}</div>
                                <div style="font-size: 12px; color: #999;">ìƒì„±ì¼: ${createdDate}</div>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button onclick="renameLayout('${layoutId}')" style="padding: 6px 12px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">ì´ë¦„ ë³€ê²½</button>
                                <button onclick="deleteLayout('${layoutId}')" style="padding: 6px 12px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">ì‚­ì œ</button>
                            </div>
                        </div>
                    </div>
                `;
            });

            html += '</div></div>';

            showModal('ë ˆì´ì•„ì›ƒ ê´€ë¦¬', html, [
                { text: 'ë‹«ê¸°', type: 'primary', onclick: 'closeModal()' }
            ]);
        }

        // ë ˆì´ì•„ì›ƒ ì´ë¦„ ë³€ê²½
        function renameLayout(layoutId) {
            const customLayouts = getCustomLayouts();
            const layout = customLayouts[layoutId];

            if (!layout) return;

            closeModal();

            setTimeout(() => {
                showModal('ë ˆì´ì•„ì›ƒ ì´ë¦„ ë³€ê²½', `
                    <div style="text-align: left;">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">ìƒˆ ì´ë¦„:</label>
                            <input type="text" id="newLayoutNameInput" value="${layout.name}" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                        </div>
                    </div>
                `, [
                    { text: 'ì·¨ì†Œ', type: 'secondary', onclick: 'closeModal(); openManageLayoutsDialog();' },
                    { text: 'ë³€ê²½', type: 'primary', onclick: `confirmRenameLayout('${layoutId}')` }
                ]);

                setTimeout(() => {
                    const input = document.getElementById('newLayoutNameInput');
                    input.focus();
                    input.select();
                }, 100);
            }, 100);
        }

        function confirmRenameLayout(layoutId) {
            const newName = document.getElementById('newLayoutNameInput').value.trim();

            if (!newName) {
                alert('ë ˆì´ì•„ì›ƒ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }

            const customLayouts = getCustomLayouts();
            if (customLayouts[layoutId]) {
                customLayouts[layoutId].name = newName;
                setCustomLayouts(customLayouts);
                updateLayoutSelector();

                closeModal();
                showModal('ì™„ë£Œ', 'ë ˆì´ì•„ì›ƒ ì´ë¦„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.', [
                    { text: 'í™•ì¸', type: 'primary', onclick: 'closeModal(); openManageLayoutsDialog();' }
                ]);
            }
        }

        // ë ˆì´ì•„ì›ƒ ì‚­ì œ
        function deleteLayout(layoutId) {
            const customLayouts = getCustomLayouts();
            const layout = customLayouts[layoutId];

            if (!layout) return;

            closeModal();

            setTimeout(() => {
                showModal('ë ˆì´ì•„ì›ƒ ì‚­ì œ', `"${layout.name}" ë ˆì´ì•„ì›ƒì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`, [
                    { text: 'ì·¨ì†Œ', type: 'secondary', onclick: 'closeModal(); openManageLayoutsDialog();' },
                    { text: 'ì‚­ì œ', type: 'danger', onclick: `confirmDeleteLayout('${layoutId}')` }
                ]);
            }, 100);
        }

        function confirmDeleteLayout(layoutId) {
            const customLayouts = getCustomLayouts();
            const currentPreset = document.getElementById('layoutPreset').value;

            delete customLayouts[layoutId];
            setCustomLayouts(customLayouts);
            updateLayoutSelector();

            // ì‚­ì œëœ ë ˆì´ì•„ì›ƒì´ í˜„ì¬ ì„ íƒëœ ë ˆì´ì•„ì›ƒì´ë©´ ê¸°ë³¸ìœ¼ë¡œ ë³€ê²½
            if (currentPreset === `custom:${layoutId}`) {
                document.getElementById('layoutPreset').value = 'default';
                loadLayoutPreset();
            }

            closeModal();
            showModal('ì™„ë£Œ', 'ë ˆì´ì•„ì›ƒì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', [
                { text: 'í™•ì¸', type: 'primary', onclick: 'closeModal(); openManageLayoutsDialog();' }
            ]);
        }

        function openColumnManager() {
            if (!currentLayout) currentLayout = LAYOUT_PRESETS.default;

            const allColumns = Object.keys(COLUMN_DEFINITIONS);
            const visibleCols = currentLayout.visible || currentLayout.columns;

            let html = '<div style="text-align: left;">';
            html += '<p style="margin-bottom: 15px; color: #666;">ì»¬ëŸ¼ì„ ë“œë˜ê·¸í•˜ì—¬ ìˆœì„œë¥¼ ë³€ê²½í•˜ê³ , ì²´í¬ë°•ìŠ¤ë¡œ í‘œì‹œ/ìˆ¨ê¹€ì„ ì„¤ì •í•˜ì„¸ìš”.</p>';
            html += '<div id="columnList" style="background: #f8f9fa; padding: 15px; border-radius: 6px; max-height: 400px; overflow-y: auto;">';

            currentLayout.columns.forEach((colKey, index) => {
                const col = COLUMN_DEFINITIONS[colKey];
                if (!col) return;

                const isVisible = visibleCols.includes(colKey);
                const isFixed = col.fixed;

                html += `
                    <div class="column-item" draggable="${!isFixed}" data-col="${colKey}" style="background: white; padding: 12px; margin-bottom: 8px; border-radius: 4px; border: 2px solid #ddd; cursor: ${isFixed ? 'default' : 'move'}; display: flex; align-items: center; gap: 10px;">
                        <span style="color: #999; font-size: 18px;">${isFixed ? 'ğŸ”’' : 'â˜°'}</span>
                        <input type="checkbox" ${isVisible ? 'checked' : ''} ${isFixed ? 'disabled' : ''} onchange="toggleColumnVisibility('${colKey}')" style="width: 18px; height: 18px; cursor: ${isFixed ? 'not-allowed' : 'pointer'};">
                        <span style="flex: 1; font-weight: 500;">${col.label || colKey}</span>
                        <span style="color: #999; font-size: 12px;">${col.width}</span>
                    </div>
                `;
            });

            html += '</div></div>';

            showModal('ì»¬ëŸ¼ ê´€ë¦¬', html, [
                { text: 'ì·¨ì†Œ', type: 'secondary', onclick: 'closeModal()' },
                { text: 'ì ìš©', type: 'primary', onclick: 'applyColumnChanges()' }
            ]);

            // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸ ì„¤ì •
            setTimeout(() => {
                const columnList = document.getElementById('columnList');
                const items = columnList.querySelectorAll('.column-item[draggable="true"]');
                let draggedItem = null;

                items.forEach(item => {
                    item.addEventListener('dragstart', (e) => {
                        draggedItem = item;
                        item.style.opacity = '0.5';
                    });

                    item.addEventListener('dragend', (e) => {
                        item.style.opacity = '1';
                    });

                    item.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        if (item !== draggedItem && item.getAttribute('draggable') === 'true') {
                            const rect = item.getBoundingClientRect();
                            const midpoint = rect.top + rect.height / 2;
                            if (e.clientY < midpoint) {
                                item.parentNode.insertBefore(draggedItem, item);
                            } else {
                                item.parentNode.insertBefore(draggedItem, item.nextSibling);
                            }
                        }
                    });
                });
            }, 100);
        }

        function toggleColumnVisibility(colKey) {
            // ì´ í•¨ìˆ˜ëŠ” ì²´í¬ë°•ìŠ¤ ìƒíƒœë¥¼ ì¶”ì í•˜ëŠ” ìš©ë„ë¡œë§Œ ì‚¬ìš©
            // ì‹¤ì œ ì ìš©ì€ applyColumnChangesì—ì„œ ìˆ˜í–‰
        }

        function applyColumnChanges() {
            const columnList = document.getElementById('columnList');
            const items = columnList.querySelectorAll('.column-item');

            const newColumns = [];
            const newVisible = [];

            items.forEach(item => {
                const colKey = item.getAttribute('data-col');
                newColumns.push(colKey);

                const checkbox = item.querySelector('input[type="checkbox"]');
                if (checkbox && checkbox.checked) {
                    newVisible.push(colKey);
                }
            });

            currentLayout = {
                columns: newColumns,
                visible: newVisible
            };

            closeModal();
            renderFilteredItems();

            showModal('ì™„ë£Œ', 'ì»¬ëŸ¼ ì„¤ì •ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤. "í˜„ì¬ ë ˆì´ì•„ì›ƒ ì €ì¥" ë²„íŠ¼ì„ ëˆŒëŸ¬ ì €ì¥í•˜ì„¸ìš”.', [
                { text: 'í™•ì¸', type: 'primary', onclick: 'closeModal()' }
            ]);
        }

        // ë Œë”ë§ í—¬í¼ í•¨ìˆ˜ë“¤
        function renderTableHeader() {
            if (!currentLayout) currentLayout = LAYOUT_PRESETS.default;

            const thead = document.getElementById('itemsTableHead');
            const visibleCols = currentLayout.visible || currentLayout.columns;
            const pinnedColumns = currentLayout.pinned || [];

            // ë‹¨ì¼ í—¤ë” í–‰ (Excel ìŠ¤íƒ€ì¼) - ë¨¼ì € sticky ì—†ì´ ë Œë”ë§
            let headerHTML = '<tr>';

            currentLayout.columns.forEach(colKey => {
                if (!visibleCols.includes(colKey)) return;

                const col = COLUMN_DEFINITIONS[colKey];
                if (!col) return;

                const width = col.width !== 'auto' ? `width: ${col.width};` : '';
                const align = colKey === 'actions' ? 'center' : 'left';
                const fontSize = ['created_at', 'assigned_at', 'updated_at', 'completed_at'].includes(colKey) ? 'font-size: 12px;' : '';
                const isPinned = pinnedColumns.includes(colKey);

                // í•€ í‘œì‹œìš© ì„ì‹œ ìŠ¤íƒ€ì¼ (ì‹¤ì œ left ê°’ì€ ë‚˜ì¤‘ì— JSë¡œ ì ìš©)
                let stickyStyle = '';
                if (isPinned) {
                    stickyStyle = `position: sticky; left: 0px; z-index: 11; box-shadow: 2px 0 4px rgba(0,0,0,0.1);`;
                }

                if (colKey === 'checkbox') {
                    headerHTML += `<th style="padding: 12px 8px; text-align: ${align}; border-bottom: 2px solid #ddd; ${width} background: #f8f9fa; ${stickyStyle}" draggable="false"><input type="checkbox" id="selectAll" onchange="toggleSelectAll()"></th>`;
                } else if (colKey === 'actions') {
                    // actions ì»¬ëŸ¼ì€ í•„í„° ì—†ìŒ, ë“œë˜ê·¸ ë¶ˆê°€
                    headerHTML += `<th style="padding: 12px 8px; text-align: ${align}; border-bottom: 2px solid #ddd; ${width} ${fontSize} background: #f8f9fa; font-weight: bold; ${stickyStyle}" draggable="false">${col.label}</th>`;
                } else {
                    // í•„í„° ê°€ëŠ¥í•œ ì»¬ëŸ¼ - í—¤ë”ì— ì•„ì´ì½˜ í¬í•¨
                    const hasFilter = columnFilters[colKey];
                    const filterIcon = hasFilter ? 'ğŸ”½' : 'â–¼';
                    const sortIcon = sortState && sortState.column === colKey
                        ? (sortState.direction === 'asc' ? ' â†‘' : ' â†“')
                        : '';
                    const pinIcon = isPinned ? ' ğŸ“Œ' : '';
                    const headerBg = hasFilter ? '#fff3cd' : '#f8f9fa';
                    const headerColor = hasFilter ? '#856404' : '#333';
                    const draggableAttr = col.fixed ? 'draggable="false"' : 'draggable="true"';
                    const headerStyle = `padding: 12px 8px; text-align: ${align}; border-bottom: 2px solid #ddd; ${width} ${fontSize} background: ${headerBg}; font-weight: bold; cursor: pointer; user-select: none; color: ${headerColor}; transition: background 0.2s; ${stickyStyle}`;
                    const hoverStyle = 'onmouseover="this.style.background=\'#e9ecef\'" onmouseout="this.style.background=\'' + headerBg + '\'"';

                    headerHTML += `<th
                        style="${headerStyle}"
                        ${draggableAttr}
                        onclick="handleHeaderClick('${colKey}')"
                        ondragstart="handleColumnDragStart(event, '${colKey}')"
                        ondragover="handleColumnDragOver(event, '${colKey}')"
                        ondrop="handleColumnDrop(event, '${colKey}')"
                        ondragleave="handleColumnDragLeave(event)"
                        oncontextmenu="showColumnContextMenu(event, '${colKey}'); return false;"
                        ${hoverStyle}>
                        <div style="display: flex; align-items: center; justify-content: space-between; gap: 4px;">
                            <span>${col.label}</span>
                            <span style="font-size: 10px; opacity: 0.7;">${filterIcon}${sortIcon}${pinIcon}</span>
                        </div>
                    </th>`;
                }
            });
            headerHTML += '</tr>';

            thead.innerHTML = headerHTML;

            // ë Œë”ë§ í›„ ì‹¤ì œ DOM ë„ˆë¹„ë¥¼ ì¸¡ì •í•˜ì—¬ í•€ ìœ„ì¹˜ ì¬ì¡°ì •
            setTimeout(() => {
                const headerCells = thead.querySelectorAll('th');
                const pinnedWidths = {}; // ê° í•€ ì»¬ëŸ¼ì˜ ì¸¡ì •ëœ ë„ˆë¹„ ì €ì¥
                let cumulativeLeft = 0;
                let colIndex = 0;

                currentLayout.columns.forEach(colKey => {
                    if (!visibleCols.includes(colKey)) return;

                    const isPinned = pinnedColumns.includes(colKey);
                    const cell = headerCells[colIndex];

                    if (cell && isPinned) {
                        // ì‹¤ì œ ì¸¡ì •ëœ ë„ˆë¹„ë¡œ left ê°’ ì„¤ì •
                        cell.style.left = `${cumulativeLeft}px`;
                        pinnedWidths[colKey] = cell.offsetWidth;
                        cumulativeLeft += cell.offsetWidth;
                    }

                    colIndex++;
                });

                // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
                cachedPinnedPositions = pinnedWidths;

                // ë°”ë”” ì…€ë„ í—¤ë”ì™€ ë™ì¼í•œ ë„ˆë¹„ë¡œ ì—…ë°ì´íŠ¸
                updateBodyPinnedPositions(pinnedWidths);
            }, 0);
        }

        // ë°”ë””ì˜ í•€ ê³ ì • ìœ„ì¹˜ ì—…ë°ì´íŠ¸ (í—¤ë” ë„ˆë¹„ ê¸°ì¤€)
        function updateBodyPinnedPositions(pinnedWidths) {
            const visibleCols = currentLayout.visible || currentLayout.columns;
            const pinnedColumns = currentLayout.pinned || [];
            const tbody = document.getElementById('itemsList');
            if (!tbody) return;

            const rows = tbody.querySelectorAll('tr');
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                let cumulativeLeft = 0;
                let colIndex = 0;

                currentLayout.columns.forEach(colKey => {
                    if (!visibleCols.includes(colKey)) return;

                    const isPinned = pinnedColumns.includes(colKey);
                    const cell = cells[colIndex];

                    if (cell && isPinned) {
                        cell.style.left = `${cumulativeLeft}px`;
                        cumulativeLeft += pinnedWidths[colKey] || cell.offsetWidth;
                    }

                    colIndex++;
                });
            });
        }

        // í—¤ë” í´ë¦­ ì²˜ë¦¬ (ì‹±ê¸€í´ë¦­: í•„í„°, ë”ë¸”í´ë¦­: ì •ë ¬)
        function handleHeaderClick(columnKey) {
            clickCount++;

            if (clickCount === 1) {
                // ì²« ë²ˆì§¸ í´ë¦­ - 300ms ëŒ€ê¸°
                clickTimer = setTimeout(() => {
                    // ë”ë¸”í´ë¦­ ì•„ë‹˜ - í•„í„° ì—´ê¸°
                    toggleColumnFilter(columnKey);
                    clickCount = 0;
                }, 300);
            } else if (clickCount === 2) {
                // ë‘ ë²ˆì§¸ í´ë¦­ - ë”ë¸”í´ë¦­
                clearTimeout(clickTimer);
                toggleSort(columnKey);
                clickCount = 0;
            }
        }

        // ì»¬ëŸ¼ ì •ë ¬ í† ê¸€
        function toggleSort(columnKey) {
            if (sortState && sortState.column === columnKey) {
                // ê°™ì€ ì»¬ëŸ¼: asc -> desc -> null (ì •ë ¬ í•´ì œ)
                if (sortState.direction === 'asc') {
                    sortState.direction = 'desc';
                } else {
                    sortState = null;
                }
            } else {
                // ìƒˆ ì»¬ëŸ¼: ì˜¤ë¦„ì°¨ìˆœìœ¼ë¡œ ì‹œì‘
                sortState = { column: columnKey, direction: 'asc' };
            }

            applyFilters();
        }

        // ì»¬ëŸ¼ ë“œë˜ê·¸ ì‹œì‘
        function handleColumnDragStart(event, columnKey) {
            draggedColumn = columnKey;
            event.dataTransfer.effectAllowed = 'move';
            event.target.style.opacity = '0.5';
        }

        // ì»¬ëŸ¼ ìœ„ë¡œ ë“œë˜ê·¸
        function handleColumnDragOver(event, columnKey) {
            event.preventDefault();
            event.dataTransfer.dropEffect = 'move';

            if (draggedColumn && draggedColumn !== columnKey) {
                dragOverColumn = columnKey;
                event.currentTarget.style.background = '#d4e3fc';
            }
        }

        // ë“œë˜ê·¸ ë– ë‚¨
        function handleColumnDragLeave(event) {
            event.currentTarget.style.background = '';
        }

        // ì»¬ëŸ¼ ë“œë¡­
        function handleColumnDrop(event, targetColumn) {
            event.preventDefault();
            event.currentTarget.style.background = '';

            if (!draggedColumn || draggedColumn === targetColumn) {
                return;
            }

            // ê³ ì • ì»¬ëŸ¼ì€ ì´ë™ ë¶ˆê°€
            const draggedCol = COLUMN_DEFINITIONS[draggedColumn];
            const targetCol = COLUMN_DEFINITIONS[targetColumn];
            if (draggedCol?.fixed || targetCol?.fixed) {
                showToast('ì•Œë¦¼', 'ê³ ì •ëœ ì»¬ëŸ¼ì€ ì´ë™í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                draggedColumn = null;
                return;
            }

            // í•€ ê²½ê³„ ì²´í¬: í•€ ì»¬ëŸ¼ì€ í•€ ì˜ì—­ ë‚´ì—ì„œë§Œ, ì¼ë°˜ ì»¬ëŸ¼ì€ ì¼ë°˜ ì˜ì—­ ë‚´ì—ì„œë§Œ ì´ë™ ê°€ëŠ¥
            const pinnedColumns = currentLayout.pinned || [];
            const isDraggedPinned = pinnedColumns.includes(draggedColumn);
            const isTargetPinned = pinnedColumns.includes(targetColumn);

            if (isDraggedPinned !== isTargetPinned) {
                showToast('ì•Œë¦¼', 'í•€ ê³ ì •ëœ ì»¬ëŸ¼ê³¼ ì¼ë°˜ ì»¬ëŸ¼ ì‚¬ì´ì—ëŠ” ì´ë™í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                draggedColumn = null;
                return;
            }

            // ì»¬ëŸ¼ ìˆœì„œ ë³€ê²½
            const columns = [...currentLayout.columns];
            const draggedIndex = columns.indexOf(draggedColumn);
            const targetIndex = columns.indexOf(targetColumn);

            // ë°°ì—´ì—ì„œ ì œê±° í›„ ìƒˆ ìœ„ì¹˜ì— ì‚½ì…
            columns.splice(draggedIndex, 1);
            columns.splice(targetIndex, 0, draggedColumn);

            currentLayout.columns = columns;

            // ë Œë”ë§ ì—…ë°ì´íŠ¸
            renderFilteredItems();

            draggedColumn = null;
            dragOverColumn = null;

            showToast('ì„±ê³µ', 'ì»¬ëŸ¼ ìˆœì„œê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ìš°í´ë¦­ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´
        function showColumnContextMenu(event, columnKey) {
            event.preventDefault();

            const col = COLUMN_DEFINITIONS[columnKey];
            if (col?.fixed) {
                showToast('ì•ˆë‚´', 'ì´ ì»¬ëŸ¼ì€ ê³ ì •ë˜ì–´ ìˆì–´ í•€ ì„¤ì •ì„ ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            if (!currentLayout.pinned) {
                currentLayout.pinned = [];
            }

            const isPinned = currentLayout.pinned.includes(columnKey);
            const action = isPinned ? 'í•€ í•´ì œ' : 'í•€ ê³ ì •';

            showModal('ì»¬ëŸ¼ ì„¤ì •', `"${col.label}" ì»¬ëŸ¼ì„ ${action}í•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br><br><small style="color: #666;">í•€ ê³ ì •ëœ ì»¬ëŸ¼ì€ ì¢Œì¸¡ì— ê³ ì •ë˜ì–´ ìŠ¤í¬ë¡¤ ì‹œì—ë„ ë³´ì…ë‹ˆë‹¤.</small>`, [
                { text: action, type: 'primary', onclick: `toggleColumnPin('${columnKey}')` },
                { text: 'ì·¨ì†Œ', type: 'default', onclick: 'closeModal()' }
            ]);
        }

        // ì»¬ëŸ¼ í•€ í† ê¸€
        function toggleColumnPin(columnKey) {
            if (!currentLayout.pinned) {
                currentLayout.pinned = [];
            }

            const index = currentLayout.pinned.indexOf(columnKey);
            if (index > -1) {
                // í•€ í•´ì œ - í•€ ëª©ë¡ì—ì„œ ì œê±°í•˜ê³  ì»¬ëŸ¼ì„ í•€ì´ ì•„ë‹Œ ì˜ì—­ì˜ ì²« ë²ˆì§¸ë¡œ ì´ë™
                currentLayout.pinned.splice(index, 1);

                // ì»¬ëŸ¼ ë°°ì—´ì—ì„œ ì œê±°
                const colIndex = currentLayout.columns.indexOf(columnKey);
                if (colIndex > -1) {
                    currentLayout.columns.splice(colIndex, 1);
                }

                // ì²« ë²ˆì§¸ í•€ ì•„ë‹Œ ì»¬ëŸ¼ ìœ„ì¹˜ ì°¾ê¸°
                let insertIndex = currentLayout.columns.length; // ê¸°ë³¸ê°’: ë§¨ ë
                for (let i = 0; i < currentLayout.columns.length; i++) {
                    if (!currentLayout.pinned.includes(currentLayout.columns[i])) {
                        insertIndex = i;
                        break;
                    }
                }

                // í•´ë‹¹ ìœ„ì¹˜ì— ì‚½ì…
                currentLayout.columns.splice(insertIndex, 0, columnKey);
                showToast('í•€ í•´ì œ', `ì»¬ëŸ¼ì´ í•€ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
            } else {
                // í•€ ê³ ì • - í•€ ëª©ë¡ì— ì¶”ê°€í•˜ê³  ì»¬ëŸ¼ì„ ë§ˆì§€ë§‰ í•€ ì»¬ëŸ¼ ë’¤ë¡œ ì´ë™
                currentLayout.pinned.push(columnKey);

                // ì»¬ëŸ¼ ë°°ì—´ì—ì„œ ì œê±°
                const colIndex = currentLayout.columns.indexOf(columnKey);
                if (colIndex > -1) {
                    currentLayout.columns.splice(colIndex, 1);
                }

                // ë§ˆì§€ë§‰ í•€ ì»¬ëŸ¼ ë’¤ì— ì‚½ì… (ìƒˆë¡œ ì¶”ê°€ëœ í•€ ì œì™¸í•˜ê³  ê²€ìƒ‰)
                let insertIndex = 0;
                for (let i = currentLayout.columns.length - 1; i >= 0; i--) {
                    if (currentLayout.pinned.includes(currentLayout.columns[i]) && currentLayout.columns[i] !== columnKey) {
                        insertIndex = i + 1;
                        break;
                    }
                }

                currentLayout.columns.splice(insertIndex, 0, columnKey);
                showToast('í•€ ê³ ì •', `ì»¬ëŸ¼ì´ ì¢Œì¸¡ì— ê³ ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            }

            closeModal();
            renderFilteredItems();
        }

        function getCellContent(item, colKey) {
            // ë‚ ì§œ í¬ë§·íŒ… í•¨ìˆ˜
            const formatDate = (dateStr) => {
                if (!dateStr) return '<span style="color: #ccc;">-</span>';
                try {
                    const parts = dateStr.split(' ');
                    if (parts.length >= 2) {
                        const datePart = parts[0].split('-');
                        const timePart = parts[1].split(':');
                        return `<span style="font-size: 11px; color: #666;">${datePart[1]}-${datePart[2]} ${timePart[0]}:${timePart[1]}</span>`;
                    }
                    return `<span style="font-size: 11px; color: #666;">${dateStr}</span>`;
                } catch (e) {
                    return '<span style="color: #ccc;">-</span>';
                }
            };

            switch (colKey) {
                case 'checkbox':
                    return `<input type="checkbox" class="task-checkbox" value="${item.id}">`;
                case 'id':
                    return item.id;
                case 'status':
                    let statusColor = '#6c757d';
                    if (item.status === 'ì§„í–‰ì¤‘') statusColor = '#ffc107';
                    if (item.status === 'ì™„ë£Œ') statusColor = '#28a745';
                    return `<span style="background: ${statusColor}; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">${item.status || 'ëŒ€ê¸°ì¤‘'}</span>`;
                case 'team':
                    return item.team || '<span style="color: #999;">-</span>';
                case 'assigned_to':
                    return item.assigned_to || '<span style="color: #999;">ë¯¸ë°°ì •</span>';
                case 'title':
                    return item.title || '';
                case 'content':
                    return item.content || '';
                case 'created_at':
                case 'assigned_at':
                case 'updated_at':
                case 'completed_at':
                    return formatDate(item[colKey]);
                case 'actions':
                    return `
                        ${!item.assigned_to ? `<button onclick="assignItem(${item.id})" style="background: #17a2b8;">ë°°ì •</button>` : `<button onclick="unassignItem(${item.id})" style="background: #ffc107;">íšŒìˆ˜</button>`}
                        <button class="edit" onclick="editItem(${item.id})">ìˆ˜ì •</button>
                        <button class="delete" onclick="deleteItem(${item.id})">ì‚­ì œ</button>
                    `;
                default:
                    return '';
            }
        }

        // ì—°ì‚°ì ë¼ë²¨ ê°€ì ¸ì˜¤ê¸°
        function getOperatorLabel(columnType, operatorValue) {
            const operators = FILTER_OPERATORS[columnType] || FILTER_OPERATORS.text;
            const op = operators.find(o => o.value === operatorValue);
            return op ? op.label : operatorValue;
        }

        // Excel ìŠ¤íƒ€ì¼ í•„í„° UI í‘œì‹œ (ë‹¤ì¤‘ ì¡°ê±´ ì§€ì›)
        function toggleColumnFilter(columnKey) {
            const columnType = COLUMN_TYPES[columnKey] || 'text';
            const currentFilter = columnFilters[columnKey] || { logic: 'AND', conditions: [] };
            const operators = FILTER_OPERATORS[columnType];

            let filterHTML = '<div style="text-align: left; max-width: 500px;">';

            // ê¸°ì¡´ ì¡°ê±´ ëª©ë¡ (ìˆìœ¼ë©´ í‘œì‹œ)
            if (currentFilter.conditions && currentFilter.conditions.length > 0) {
                filterHTML += '<div style="margin-bottom: 20px; padding: 12px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #667eea;">';
                filterHTML += '<div style="font-weight: bold; margin-bottom: 10px; color: #333;">ì ìš©ëœ ì¡°ê±´:</div>';

                currentFilter.conditions.forEach((cond, idx) => {
                    const opLabel = getOperatorLabel(columnType, cond.operator);
                    let valueDisplay = '';

                    if (cond.operator === 'is_empty' || cond.operator === 'not_empty') {
                        valueDisplay = '';
                    } else if (cond.values) {
                        valueDisplay = ': ' + cond.values.join(', ');
                    } else if (cond.value2) {
                        valueDisplay = ': ' + cond.value + ' ~ ' + cond.value2;
                    } else {
                        valueDisplay = ': ' + cond.value;
                    }

                    filterHTML += `<div style="padding: 8px 10px; background: white; margin-bottom: 6px; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">`;
                    filterHTML += `<span style="font-size: 13px; color: #555;"><strong>${opLabel}</strong>${valueDisplay}</span>`;
                    filterHTML += `<button onclick="removeCondition('${columnKey}', ${idx}); event.stopPropagation();" style="padding: 4px 10px; background: #dc3545; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 11px; font-weight: bold;">ì‚­ì œ</button>`;
                    filterHTML += `</div>`;

                    if (idx < currentFilter.conditions.length - 1) {
                        filterHTML += `<div style="text-align: center; padding: 4px; font-weight: bold; font-size: 12px; color: #667eea;">${currentFilter.logic}</div>`;
                    }
                });

                // AND/OR ì„ íƒ
                filterHTML += '<div style="margin-top: 12px; padding-top: 10px; border-top: 1px solid #ddd;">';
                filterHTML += '<label style="font-weight: bold; margin-right: 10px; color: #555; font-size: 13px;">ì¡°ê±´ ì—°ê²°:</label>';
                filterHTML += `<select id="filterLogic_${columnKey}" style="padding: 6px 10px; border: 2px solid #ddd; border-radius: 4px; font-size: 13px;">`;
                filterHTML += `<option value="AND" ${currentFilter.logic === 'AND' ? 'selected' : ''}>AND (ëª¨ë‘ ë§Œì¡±)</option>`;
                filterHTML += `<option value="OR" ${currentFilter.logic === 'OR' ? 'selected' : ''}>OR (í•˜ë‚˜ë¼ë„ ë§Œì¡±)</option>`;
                filterHTML += `</select>`;
                filterHTML += '</div>';

                filterHTML += '</div>';
            }

            // ìƒˆ ì¡°ê±´ ì¶”ê°€ ì„¹ì…˜
            filterHTML += '<div style="padding: 15px; border: 2px dashed #ccc; border-radius: 6px; background: #fefefe;">';
            filterHTML += '<div style="font-weight: bold; margin-bottom: 12px; color: #667eea; font-size: 14px;">ìƒˆ ì¡°ê±´ ì¶”ê°€</div>';

            // ì—°ì‚°ì ì„ íƒ
            filterHTML += `<div style="margin-bottom: 12px;">`;
            filterHTML += `<label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 13px; color: #555;">ì¡°ê±´:</label>`;
            filterHTML += `<select id="filterOperator_${columnKey}" onchange="updateFilterOperator('${columnKey}')" style="width: 100%; padding: 8px 12px; border: 2px solid #ddd; border-radius: 4px; font-size: 13px; background: white;">`;
            operators.forEach(op => {
                filterHTML += `<option value="${op.value}">${op.label}</option>`;
            });
            filterHTML += `</select></div>`;

            // ê°’ ì…ë ¥ ì˜ì—­
            filterHTML += `<div id="filterValueContainer_${columnKey}"></div>`;

            filterHTML += '</div>';
            filterHTML += '</div>';

            showModal(COLUMN_DEFINITIONS[columnKey].label + ' í•„í„°', filterHTML, [
                { text: 'ì¡°ê±´ ì¶”ê°€', type: 'primary', onclick: `addCondition('${columnKey}')` },
                { text: 'ëª¨ë‘ ì´ˆê¸°í™”', type: 'danger', onclick: `clearColumnFilter('${columnKey}')` },
                { text: 'ë‹«ê¸°', type: 'default', onclick: 'closeModal()' }
            ]);

            updateFilterOperator(columnKey);
        }

        // í•„í„° ì—°ì‚°ì ë³€ê²½ ì‹œ ì…ë ¥ í•„ë“œ ì—…ë°ì´íŠ¸
        function updateFilterOperator(columnKey) {
            const operator = document.getElementById('filterOperator_' + columnKey).value;
            const container = document.getElementById('filterValueContainer_' + columnKey);
            const columnType = COLUMN_TYPES[columnKey] || 'text';

            let html = '';

            if (operator === 'is_empty' || operator === 'not_empty') {
                // ê°’ ì…ë ¥ ë¶ˆí•„ìš”
                html = '<p style="color: #888; font-size: 13px; padding: 10px; text-align: center;">ì´ ì¡°ê±´ì€ ê°’ì´ í•„ìš” ì—†ìŠµë‹ˆë‹¤.</p>';
            } else if (operator === 'between') {
                // ë²”ìœ„ ì…ë ¥ (ë‘ ê°œì˜ ê°’)
                html += '<div style="margin-bottom: 8px;">';
                html += '<label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 13px; color: #555;">ì‹œì‘:</label>';
                if (columnType === 'date') {
                    html += `<input type="date" id="filterValue1_${columnKey}" style="width: 100%; padding: 8px 12px; border: 2px solid #ddd; border-radius: 4px; font-size: 13px;">`;
                } else {
                    html += `<input type="number" id="filterValue1_${columnKey}" style="width: 100%; padding: 8px 12px; border: 2px solid #ddd; border-radius: 4px; font-size: 13px;">`;
                }
                html += '</div>';
                html += '<div>';
                html += '<label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 13px; color: #555;">ë:</label>';
                if (columnType === 'date') {
                    html += `<input type="date" id="filterValue2_${columnKey}" style="width: 100%; padding: 8px 12px; border: 2px solid #ddd; border-radius: 4px; font-size: 13px;">`;
                } else {
                    html += `<input type="number" id="filterValue2_${columnKey}" style="width: 100%; padding: 8px 12px; border: 2px solid #ddd; border-radius: 4px; font-size: 13px;">`;
                }
                html += '</div>';
            } else if (operator === 'in' || operator === 'not_in') {
                // IN/NOT IN: ì½¤ë§ˆë¡œ êµ¬ë¶„ëœ ì—¬ëŸ¬ ê°’ ì…ë ¥
                html += '<div>';
                html += '<label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 13px; color: #555;">ê°’ (ì½¤ë§ˆë¡œ êµ¬ë¶„):</label>';
                html += `<textarea id="filterValue_${columnKey}" rows="3" placeholder="ì˜ˆ: ê°’1, ê°’2, ê°’3" style="width: 100%; padding: 8px 12px; border: 2px solid #ddd; border-radius: 4px; font-size: 13px; resize: vertical;"></textarea>`;
                html += '<p style="color: #888; font-size: 11px; margin-top: 4px;">ì‰¼í‘œ(,)ë¡œ êµ¬ë¶„í•˜ì—¬ ì—¬ëŸ¬ ê°’ì„ ì…ë ¥í•˜ì„¸ìš”.</p>';
                html += '</div>';
            } else {
                // ë‹¨ì¼ ê°’ ì…ë ¥
                html += '<div>';
                html += '<label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 13px; color: #555;">ê°’:</label>';
                if (columnType === 'date') {
                    html += `<input type="date" id="filterValue_${columnKey}" style="width: 100%; padding: 8px 12px; border: 2px solid #ddd; border-radius: 4px; font-size: 13px;">`;
                } else if (columnType === 'number') {
                    html += `<input type="number" id="filterValue_${columnKey}" style="width: 100%; padding: 8px 12px; border: 2px solid #ddd; border-radius: 4px; font-size: 13px;">`;
                } else {
                    html += `<input type="text" id="filterValue_${columnKey}" style="width: 100%; padding: 8px 12px; border: 2px solid #ddd; border-radius: 4px; font-size: 13px;">`;
                }
                html += '</div>';
            }

            container.innerHTML = html;
        }

        // ì¡°ê±´ ì¶”ê°€
        function addCondition(columnKey) {
            const operator = document.getElementById('filterOperator_' + columnKey).value;

            let condition = { operator };

            if (operator === 'is_empty' || operator === 'not_empty') {
                // ê°’ ì—†ìŒ
            } else if (operator === 'between') {
                const value1 = document.getElementById('filterValue1_' + columnKey).value;
                const value2 = document.getElementById('filterValue2_' + columnKey).value;
                if (!value1 || !value2) {
                    alert('ì‹œì‘ê³¼ ë ê°’ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                condition.value = value1;
                condition.value2 = value2;
            } else if (operator === 'in' || operator === 'not_in') {
                const valueText = document.getElementById('filterValue_' + columnKey).value;
                if (!valueText.trim()) {
                    alert('ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                condition.values = valueText.split(',').map(v => v.trim()).filter(v => v);
                if (condition.values.length === 0) {
                    alert('ìœ íš¨í•œ ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
            } else {
                const value = document.getElementById('filterValue_' + columnKey).value;
                if (!value && value !== 0) {
                    alert('ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                condition.value = value;
            }

            if (!columnFilters[columnKey]) {
                columnFilters[columnKey] = { logic: 'AND', conditions: [] };
            }

            // AND/OR ë¡œì§ ì—…ë°ì´íŠ¸ (ê¸°ì¡´ ì¡°ê±´ì´ ìˆì„ ë•Œë§Œ)
            const logicSelect = document.getElementById('filterLogic_' + columnKey);
            if (logicSelect) {
                columnFilters[columnKey].logic = logicSelect.value;
            }

            columnFilters[columnKey].conditions.push(condition);

            closeModal();
            applyFilters();
        }

        // ì¡°ê±´ ì‚­ì œ
        function removeCondition(columnKey, index) {
            if (columnFilters[columnKey] && columnFilters[columnKey].conditions) {
                columnFilters[columnKey].conditions.splice(index, 1);

                if (columnFilters[columnKey].conditions.length === 0) {
                    delete columnFilters[columnKey];
                }

                closeModal();
                applyFilters();

                // í•„í„° ë‹¤ì´ì–¼ë¡œê·¸ ë‹¤ì‹œ ì—´ê¸°
                setTimeout(() => toggleColumnFilter(columnKey), 100);
            }
        }

        // ì»¬ëŸ¼ í•„í„° ì „ì²´ ì´ˆê¸°í™”
        function clearColumnFilter(columnKey) {
            delete columnFilters[columnKey];
            closeModal();
            applyFilters();
        }

        // ë‹¹ì¼ ì˜ˆì•½ ë°°ë„ˆ ì²´í¬
        async function checkTodayReminders() {
            try {
                const response = await fetch('/api/reminders?show_completed=false');
                const reminders = await response.json();

                const today = new Date().toISOString().split('T')[0];
                const todayReminders = reminders.filter(r => r.scheduled_date === today);

                if (todayReminders.length > 0) {
                    const banner = document.getElementById('reminderBanner');
                    const bannerText = document.getElementById('bannerText');
                    bannerText.textContent = `ì˜¤ëŠ˜ ì˜ˆì•½ ${todayReminders.length}ê±´ì´ ìˆìŠµë‹ˆë‹¤!`;
                    banner.classList.add('show');
                    document.body.classList.add('has-banner');
                }
            } catch (error) {
                console.log('ì˜ˆì•½ ì²´í¬ ì‹¤íŒ¨:', error);
            }
        }

        function closeBanner() {
            const banner = document.getElementById('reminderBanner');
            banner.classList.remove('show');
            document.body.classList.remove('has-banner');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë§ˆì§€ë§‰ ë ˆì´ì•„ì›ƒ ë³µì› (ì‚¬ìš©ìë³„)
        window.addEventListener('DOMContentLoaded', () => {
            // ë‹¹ì¼ ì˜ˆì•½ ì²´í¬
            checkTodayReminders();

            // ì»¤ìŠ¤í…€ ë ˆì´ì•„ì›ƒ ì…€ë ‰í„° ì—…ë°ì´íŠ¸
            updateLayoutSelector();

            const lastPreset = localStorage.getItem(getStorageKey('lastLayoutPreset'));

            // ê¸°ë³¸ í”„ë¦¬ì…‹ì¸ ê²½ìš°
            if (lastPreset && LAYOUT_PRESETS[lastPreset]) {
                document.getElementById('layoutPreset').value = lastPreset;
                currentLayout = LAYOUT_PRESETS[lastPreset];
            }
            // ì»¤ìŠ¤í…€ ë ˆì´ì•„ì›ƒì¸ ê²½ìš° (custom:layoutId í˜•ì‹)
            else if (lastPreset && lastPreset.startsWith('custom:')) {
                const layoutId = lastPreset.split(':')[1];
                const customLayouts = getCustomLayouts();

                if (customLayouts[layoutId]) {
                    document.getElementById('layoutPreset').value = lastPreset;
                    currentLayout = customLayouts[layoutId].layout;
                } else {
                    // ì €ì¥ëœ ì»¤ìŠ¤í…€ ë ˆì´ì•„ì›ƒì´ ì‚­ì œëœ ê²½ìš° ê¸°ë³¸ìœ¼ë¡œ ë³µì›
                    currentLayout = LAYOUT_PRESETS.default;
                }
            }
            // ê¸°ì¡´ ë‹¨ì¼ ì»¤ìŠ¤í…€ ë ˆì´ì•„ì›ƒ ë§ˆì´ê·¸ë ˆì´ì…˜ (í•˜ìœ„ í˜¸í™˜ì„±)
            else if (lastPreset === 'custom') {
                const oldCustomLayout = localStorage.getItem(getStorageKey('customLayout'));
                if (oldCustomLayout) {
                    // ê¸°ì¡´ ë‹¨ì¼ ì»¤ìŠ¤í…€ ë ˆì´ì•„ì›ƒì„ ìƒˆ ë‹¤ì¤‘ ë ˆì´ì•„ì›ƒ ì‹œìŠ¤í…œìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜
                    const layoutId = `layout_${Date.now()}`;
                    const customLayouts = getCustomLayouts();
                    customLayouts[layoutId] = {
                        name: 'ë§ˆì´ê·¸ë ˆì´ì…˜ëœ ë ˆì´ì•„ì›ƒ',
                        layout: JSON.parse(oldCustomLayout),
                        createdAt: new Date().toISOString()
                    };
                    setCustomLayouts(customLayouts);

                    // ë§ˆì´ê·¸ë ˆì´ì…˜ í›„ ì„ íƒ
                    const newPresetValue = `custom:${layoutId}`;
                    document.getElementById('layoutPreset').value = newPresetValue;
                    localStorage.setItem(getStorageKey('lastLayoutPreset'), newPresetValue);
                    currentLayout = customLayouts[layoutId].layout;

                    // ê¸°ì¡´ ë‹¨ì¼ ë ˆì´ì•„ì›ƒ ì œê±°
                    localStorage.removeItem(getStorageKey('customLayout'));

                    updateLayoutSelector();
                } else {
                    currentLayout = LAYOUT_PRESETS.default;
                }
            }
            else {
                currentLayout = LAYOUT_PRESETS.default;
            }
        });

        loadItems();
        setInterval(loadItems, 5000);

        // PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸
        let deferredPrompt;
        const installBtn = document.getElementById('installBtn');

        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('PWA ì„¤ì¹˜ ê°€ëŠ¥!');
            e.preventDefault();
            deferredPrompt = e;
            if (installBtn) installBtn.style.display = 'block';
        });

        if (installBtn) {
            installBtn.addEventListener('click', async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    console.log(`ì‚¬ìš©ì ì„ íƒ: ${outcome}`);
                    deferredPrompt = null;
                    installBtn.style.display = 'none';
                } else {
                    // beforeinstallpromptê°€ ì—†ëŠ” ê²½ìš° (HTTP í™˜ê²½)
                    alert('ì´ ì•±ì„ ì„¤ì¹˜í•˜ë ¤ë©´:\n\n1. Chrome ì£¼ì†Œì°½ ì˜¤ë¥¸ìª½ ë©”ë‰´(â‹®) í´ë¦­\n2. "ì•± ì„¤ì¹˜" ë˜ëŠ” "ë°”ë¡œê°€ê¸° ë§Œë“¤ê¸°" ì„ íƒ\n\në˜ëŠ” ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ë°”ë¡œê°€ê¸°ë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”.');
                }
            });

            window.addEventListener('appinstalled', () => {
                console.log('PWA ì„¤ì¹˜ ì™„ë£Œ!');
                installBtn.style.display = 'none';
                deferredPrompt = null;
            });

            // HTTP í™˜ê²½ì—ì„œë„ ì„¤ì¹˜ ë²„íŠ¼ í‘œì‹œ (3ì´ˆ í›„)
            setTimeout(() => {
                if (!deferredPrompt) {
                    installBtn.style.display = 'block';
                    console.log('HTTP í™˜ê²½: ìˆ˜ë™ ì„¤ì¹˜ ë²„íŠ¼ í‘œì‹œ');
                }
            }, 3000);
        }

        // PWA ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/static/service-worker.js')
                .then(registration => {
                    console.log('Service Worker ë“±ë¡ ì„±ê³µ:', registration.scope);
                })
                .catch(error => {
                    console.log('Service Worker ë“±ë¡ ì‹¤íŒ¨:', error);
                });
        }

        // ë„ì›€ë§ ëª¨ë‹¬ ì œì–´
        function openHelpModal() {
            document.getElementById('helpModal').classList.add('active');
        }

        function closeHelpModal() {
            document.getElementById('helpModal').classList.remove('active');
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.addEventListener('DOMContentLoaded', () => {
            const helpModal = document.getElementById('helpModal');
            if (helpModal) {
                helpModal.addEventListener('click', (e) => {
                    if (e.target === helpModal) {
                        closeHelpModal();
                    }
                });
            }
        });
    </script>

    <!-- ë„ì›€ë§ ë²„íŠ¼ -->
    <button class="help-button" onclick="openHelpModal()" title="ì‚¬ìš©ë²• ë„ì›€ë§">
        â“
    </button>

    <!-- ë„ì›€ë§ ëª¨ë‹¬ -->
    <div class="help-modal" id="helpModal">
        <div class="help-modal-content">
            <div class="help-modal-header">
                <div class="help-modal-title">
                    ğŸ“– í• ì¼ê´€ë¦¬ ì‚¬ìš©ë²•
                </div>
                <button class="help-modal-close" onclick="closeHelpModal()">&times;</button>
            </div>

            <div class="help-section">
                <div class="help-section-title">ğŸ“ í• ì¼ ì¶”ê°€í•˜ê¸°</div>
                <div class="help-content">
                    <ul>
                        <li><strong>"+ ìƒˆ í• ì¼ ì¶”ê°€"</strong> ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤</li>
                        <li><strong>ì œëª©</strong>: í• ì¼ì˜ ì œëª©ì„ ì…ë ¥í•©ë‹ˆë‹¤</li>
                        <li><strong>ë‹´ë‹¹ì</strong>: í• ì¼ì„ ë°°ì •í•  íŒ€ì›ì„ ì„ íƒí•©ë‹ˆë‹¤</li>
                        <li><strong>ìš°ì„ ìˆœìœ„</strong>: ë†’ìŒ/ì¤‘ê°„/ë‚®ìŒ ì¤‘ ì„ íƒí•©ë‹ˆë‹¤</li>
                        <li><strong>ìƒíƒœ</strong>: ëŒ€ê¸°ì¤‘/ì§„í–‰ì¤‘/ì™„ë£Œ ì¤‘ ì„ íƒí•©ë‹ˆë‹¤</li>
                        <li><strong>ë§ˆê°ì¼</strong>: í• ì¼ì˜ ë§ˆê°ì¼ì„ ì„¤ì •í•©ë‹ˆë‹¤ (ì„ íƒì‚¬í•­)</li>
                        <li><strong>ë‚´ìš©</strong>: í• ì¼ì˜ ìƒì„¸ ë‚´ìš©ì„ ì…ë ¥í•©ë‹ˆë‹¤</li>
                    </ul>
                </div>
            </div>

            <div class="help-section">
                <div class="help-section-title">ğŸ” í• ì¼ í•„í„°ë§</div>
                <div class="help-content">
                    <ul>
                        <li><strong>ë‹´ë‹¹ìë³„ í•„í„°</strong>: íŠ¹ì • ë‹´ë‹¹ìì˜ í• ì¼ë§Œ ì¡°íšŒ</li>
                        <li><strong>ìš°ì„ ìˆœìœ„ë³„ í•„í„°</strong>: ë†’ìŒ/ì¤‘ê°„/ë‚®ìŒ ìš°ì„ ìˆœìœ„ë¡œ í•„í„°ë§</li>
                        <li><strong>ìƒíƒœë³„ í•„í„°</strong>: ëŒ€ê¸°ì¤‘/ì§„í–‰ì¤‘/ì™„ë£Œ ìƒíƒœë¡œ í•„í„°ë§</li>
                        <li><strong>ê²€ìƒ‰</strong>: ì œëª©ì´ë‚˜ ë‚´ìš©ìœ¼ë¡œ í• ì¼ ê²€ìƒ‰</li>
                        <li><strong>ì™„ë£Œ í•­ëª© ìˆ¨ê¹€</strong>: ì²´í¬í•˜ë©´ ì™„ë£Œëœ í• ì¼ì„ ëª©ë¡ì—ì„œ ì œì™¸</li>
                    </ul>
                </div>
            </div>

            <div class="help-section">
                <div class="help-section-title">âœï¸ í• ì¼ ìˆ˜ì • ë° ì‚­ì œ</div>
                <div class="help-content">
                    <ul>
                        <li>ê° í• ì¼ ì¹´ë“œë¥¼ í´ë¦­í•˜ë©´ <strong>ìƒì„¸ ëª¨ë‹¬</strong>ì´ ì—´ë¦½ë‹ˆë‹¤</li>
                        <li>ìƒì„¸ ëª¨ë‹¬ì—ì„œ <strong>"ìˆ˜ì •"</strong> ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë‚´ìš© ë³€ê²½</li>
                        <li><strong>"ì‚­ì œ"</strong> ë²„íŠ¼ìœ¼ë¡œ í• ì¼ì„ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                        <li><strong>"ì™„ë£Œë¡œ ë³€ê²½"</strong> ë²„íŠ¼ìœ¼ë¡œ ë¹ ë¥´ê²Œ ìƒíƒœ ë³€ê²½ ê°€ëŠ¥</li>
                    </ul>
                </div>
            </div>

            <div class="help-section">
                <div class="help-section-title">ğŸ¨ ìš°ì„ ìˆœìœ„ ìƒ‰ìƒ</div>
                <div class="help-content">
                    <ul>
                        <li><strong style="color: #dc3545;">ë¹¨ê°„ìƒ‰</strong>: ë†’ìŒ ìš°ì„ ìˆœìœ„</li>
                        <li><strong style="color: #ffc107;">ë…¸ë€ìƒ‰</strong>: ì¤‘ê°„ ìš°ì„ ìˆœìœ„</li>
                        <li><strong style="color: #28a745;">ì´ˆë¡ìƒ‰</strong>: ë‚®ìŒ ìš°ì„ ìˆœìœ„</li>
                    </ul>
                </div>
            </div>

            <div class="help-tip">
                <strong>ğŸ’¡ Tip:</strong> ë§ˆê°ì¼ì´ ì„ë°•í•œ í• ì¼ì€ ìƒë‹¨ì— í‘œì‹œë˜ë©°, ì™„ë£Œëœ í• ì¼ì€ íšŒìƒ‰ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤. í•„í„°ë¥¼ ì¡°í•©í•˜ì—¬ ì›í•˜ëŠ” í• ì¼ë§Œ ë¹ ë¥´ê²Œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤!
            </div>
        </div>
    </div>

    {% include 'includes/today_reminders.html' %}
</body>
</html>
