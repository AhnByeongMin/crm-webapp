<style>
/* ì¼ê´„ ìˆ˜ì • ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
.bulk-edit-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10002; align-items: center; justify-content: center; }
.bulk-edit-modal.show { display: flex; }
.bulk-edit-modal-content { background: white; border-radius: 12px; max-width: 95%; width: 1400px; max-height: 90vh; display: flex; flex-direction: column; box-shadow: 0 8px 32px rgba(0,0,0,0.3); }
.bulk-edit-modal-header { display: flex; justify-content: space-between; align-items: center; padding: 20px 30px; border-bottom: 2px solid #667eea; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px 12px 0 0; }
.bulk-edit-modal-title { font-size: 24px; font-weight: bold; color: white; }
.bulk-edit-modal-body { padding: 30px; overflow-y: auto; flex: 1; }

/* íƒ­ ìŠ¤íƒ€ì¼ */
.bulk-edit-tabs { display: flex; gap: 0; margin-bottom: 25px; border-bottom: 2px solid #e9ecef; }
.bulk-edit-tab { flex: 1; padding: 15px 20px; border: none; background: none; cursor: pointer; font-weight: bold; font-size: 15px; color: #999; border-bottom: 3px solid transparent; transition: all 0.3s; }
.bulk-edit-tab:hover { color: #667eea; background: #f8f9ff; }
.bulk-edit-tab.active { color: #667eea; border-bottom-color: #667eea; background: #f0f4ff; }

/* íƒ­ ì»¨í…ì¸  */
.bulk-edit-tab-content { display: none; }
.bulk-edit-tab-content.active { display: block; }

/* ì „ì²´ ìˆ˜ì • í…Œì´ë¸” */
.bulk-edit-table { width: 100%; border-collapse: collapse; font-size: 14px; }
.bulk-edit-table th { background: #667eea; color: white; padding: 12px 8px; text-align: left; font-weight: bold; position: sticky; top: 0; z-index: 1; white-space: nowrap; }
.bulk-edit-table td { padding: 8px 6px; border: 1px solid #ddd; vertical-align: top; }
.bulk-edit-table tr:nth-child(even) { background: #f8f9fa; }
.bulk-edit-table tr:hover { background: #e9ecef; }
.bulk-edit-table input, .bulk-edit-table textarea, .bulk-edit-table select { width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; }
.bulk-edit-table textarea { min-height: 50px; resize: vertical; }
.bulk-edit-table input[type="date"] { min-width: 120px; }

/* ë¹ ë¥¸ ìˆ˜ì • ìŠ¤íƒ€ì¼ */
.quick-edit-section { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
.quick-edit-title { font-size: 16px; font-weight: bold; color: #333; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
.quick-edit-row { display: flex; gap: 15px; align-items: flex-end; flex-wrap: wrap; margin-bottom: 15px; }
.quick-edit-field { flex: 1; min-width: 150px; }
.quick-edit-field label { display: block; font-weight: 600; color: #555; margin-bottom: 5px; font-size: 13px; }
.quick-edit-field input, .quick-edit-field select { width: 100%; padding: 10px 12px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 14px; }
.quick-edit-field input:focus, .quick-edit-field select:focus { border-color: #667eea; outline: none; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }

/* ì¼ê´„ ì ìš© ì˜µì…˜ */
.bulk-apply-option { background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107; margin-bottom: 15px; }
.bulk-apply-option label { display: flex; align-items: center; gap: 10px; cursor: pointer; font-weight: 600; color: #856404; }
.bulk-apply-option input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; }

/* ë‚ ì§œ ì—°ì¥ ì˜µì…˜ */
.date-extend-option { background: #d1ecf1; padding: 15px; border-radius: 8px; border-left: 4px solid #17a2b8; margin-bottom: 15px; }
.date-extend-option label { font-weight: 600; color: #0c5460; margin-bottom: 10px; display: block; }
.date-extend-row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
.date-extend-row input { width: 80px; padding: 8px; border: 2px solid #e0e0e0; border-radius: 6px; text-align: center; }
.date-extend-row select { padding: 8px 12px; border: 2px solid #e0e0e0; border-radius: 6px; }

/* ì„ íƒëœ í•­ëª© ìš”ì•½ */
.selected-summary { background: #d4edda; padding: 12px 15px; border-radius: 6px; margin-bottom: 20px; color: #155724; font-weight: 600; display: flex; justify-content: space-between; align-items: center; }
.selected-summary .count { font-size: 18px; color: #28a745; }

/* ë¯¸ë¦¬ë³´ê¸° ë¦¬ìŠ¤íŠ¸ */
.preview-list { max-height: 200px; overflow-y: auto; border: 1px solid #ddd; border-radius: 6px; margin-bottom: 15px; }
.preview-list-item { padding: 10px 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
.preview-list-item:last-child { border-bottom: none; }
.preview-list-item:hover { background: #f8f9fa; }
.preview-list-item .item-name { font-weight: 600; color: #333; }
.preview-list-item .item-detail { font-size: 12px; color: #666; }

/* ë²„íŠ¼ ê·¸ë£¹ */
.bulk-edit-actions { padding: 20px 30px; border-top: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; gap: 15px; }
.btn-warning { background: linear-gradient(135deg, #ffc107 0%, #ffb300 100%); color: #212529; box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3); }
.btn-warning:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(255, 193, 7, 0.4); }

/* ì²´í¬ë°•ìŠ¤ ì—´ */
.checkbox-cell { width: 40px; text-align: center; }
.checkbox-cell input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; accent-color: #667eea; }

/* ì„ íƒ ì»¨íŠ¸ë¡¤ ë°” */
.selection-control-bar { display: none; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 12px 20px; border-radius: 8px; margin-bottom: 20px; color: white; align-items: center; justify-content: space-between; gap: 15px; flex-wrap: wrap; }
.selection-control-bar.show { display: flex; }
.selection-info { font-weight: 600; font-size: 15px; }
.selection-actions { display: flex; gap: 10px; }
.selection-actions .btn { padding: 8px 16px; font-size: 14px; }

/* ë°˜ì‘í˜• */
@media (max-width: 768px) {
    .bulk-edit-modal-content { width: 98%; max-height: 95vh; }
    .bulk-edit-modal-body { padding: 15px; }
    .quick-edit-row { flex-direction: column; }
    .quick-edit-field { min-width: 100%; }
    .bulk-edit-actions { flex-direction: column; }
    .selection-control-bar { flex-direction: column; text-align: center; }
}
</style>

<!-- ì¼ê´„ ìˆ˜ì • ëª¨ë‹¬ -->
<div class="bulk-edit-modal" id="bulkEditModal">
    <div class="bulk-edit-modal-content">
        <div class="bulk-edit-modal-header">
            <div class="bulk-edit-modal-title">ğŸ“ í”„ë¡œëª¨ì…˜ ì¼ê´„ ìˆ˜ì •</div>
            <button class="close-btn" onclick="closeBulkEditModal()" style="color: white; font-size: 28px;">&times;</button>
        </div>
        <div class="bulk-edit-modal-body">
            <!-- ì„ íƒëœ í•­ëª© ìš”ì•½ -->
            <div class="selected-summary">
                <span><span class="count" id="bulkEditCount">0</span>ê°œì˜ í”„ë¡œëª¨ì…˜ì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤</span>
                <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 13px;" onclick="togglePreviewList()">ì„ íƒ í•­ëª© ë³´ê¸°</button>
            </div>

            <!-- ì„ íƒëœ í•­ëª© ë¯¸ë¦¬ë³´ê¸° (ì ‘íŒ ìƒíƒœ) -->
            <div class="preview-list" id="bulkEditPreviewList" style="display: none;"></div>

            <!-- íƒ­ ì „í™˜ -->
            <div class="bulk-edit-tabs">
                <button class="bulk-edit-tab active" id="fullEditTab" onclick="switchBulkEditTab('full')">
                    ğŸ“‹ ì „ì²´ ë‚´ìš© ìˆ˜ì •
                </button>
                <button class="bulk-edit-tab" id="quickEditTab" onclick="switchBulkEditTab('quick')">
                    âš¡ ë¹ ë¥¸ ìˆ˜ì • (ìƒíƒœ/ë‚ ì§œ)
                </button>
            </div>

            <!-- íƒ­1: ì „ì²´ ë‚´ìš© ìˆ˜ì • -->
            <div class="bulk-edit-tab-content active" id="fullEditContent">
                <div style="background: #f0f4ff; border-left: 4px solid #667eea; padding: 12px 15px; margin-bottom: 20px; border-radius: 4px;">
                    <strong>ğŸ’¡ ì „ì²´ ìˆ˜ì • ëª¨ë“œ:</strong> ê° í”„ë¡œëª¨ì…˜ì˜ ëª¨ë“  í•„ë“œë¥¼ ê°œë³„ì ìœ¼ë¡œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </div>
                <div style="overflow-x: auto; max-height: 400px;">
                    <table class="bulk-edit-table" id="bulkEditTable">
                        <thead>
                            <tr>
                                <th style="width: 40px;">#</th>
                                <th style="width: 100px;">ëŒ€ë¶„ë¥˜</th>
                                <th style="width: 120px;">ìƒí’ˆëª…</th>
                                <th style="width: 80px;">ì±„ë„</th>
                                <th style="width: 150px;">í”„ë¡œëª¨ì…˜ëª…</th>
                                <th style="width: 90px;">ê¸ˆì•¡í• ì¸</th>
                                <th style="width: 90px;">íšŒì°¨ë©´ì œ</th>
                                <th style="width: 100px;">ì¤‘ë³µì—¬ë¶€</th>
                                <th style="width: 100px;">ì •ì±…ë²ˆí˜¸</th>
                                <th style="width: 180px;">ë‚´ìš©</th>
                                <th style="width: 110px;">ì‹œì‘ì¼</th>
                                <th style="width: 110px;">ì¢…ë£Œì¼</th>
                            </tr>
                        </thead>
                        <tbody id="bulkEditTableBody">
                            <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- íƒ­2: ë¹ ë¥¸ ìˆ˜ì • -->
            <div class="bulk-edit-tab-content" id="quickEditContent">
                <div style="background: #f0f4ff; border-left: 4px solid #667eea; padding: 12px 15px; margin-bottom: 20px; border-radius: 4px;">
                    <strong>âš¡ ë¹ ë¥¸ ìˆ˜ì • ëª¨ë“œ:</strong> ì„ íƒí•œ ëª¨ë“  í”„ë¡œëª¨ì…˜ì— ë™ì¼í•œ ê°’ì„ ì¼ê´„ ì ìš©í•©ë‹ˆë‹¤. ë³€ê²½í•˜ì§€ ì•Šì„ í•„ë“œëŠ” ë¹„ì›Œë‘ì„¸ìš”.
                </div>

                <!-- ìƒíƒœ ë³€ê²½ -->
                <div class="quick-edit-section">
                    <div class="quick-edit-title">ğŸ“Š ìƒíƒœ ì¼ê´„ ë³€ê²½</div>
                    <div class="bulk-apply-option">
                        <label>
                            <input type="checkbox" id="applyStatusChange">
                            ì„ íƒí•œ í”„ë¡œëª¨ì…˜ì˜ ì¢…ë£Œì¼ì„ ë³€ê²½í•˜ì—¬ ìƒíƒœ ë³€ê²½
                        </label>
                    </div>
                    <div class="quick-edit-row" id="statusChangeFields" style="display: none;">
                        <div class="quick-edit-field">
                            <label>ë³€ê²½í•  ìƒíƒœ</label>
                            <select id="quickStatusSelect">
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="active">ì§„í–‰ì¤‘ (ì¢…ë£Œì¼ ì—°ì¥)</option>
                                <option value="expired">ì¢…ë£Œ (ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì¢…ë£Œ)</option>
                                <option value="unlimited">ë¬´ê¸°í•œ</option>
                            </select>
                        </div>
                        <div class="quick-edit-field" id="extendDateField" style="display: none;">
                            <label>ì—°ì¥ ì¢…ë£Œì¼</label>
                            <input type="date" id="quickExtendDate">
                        </div>
                    </div>
                </div>

                <!-- ë‚ ì§œ ì¼ê´„ ìˆ˜ì • -->
                <div class="quick-edit-section">
                    <div class="quick-edit-title">ğŸ“… ë‚ ì§œ ì¼ê´„ ìˆ˜ì •</div>

                    <!-- ì‹œì‘ì¼ ìˆ˜ì • -->
                    <div class="bulk-apply-option" style="background: #d4edda; border-left-color: #28a745;">
                        <label style="color: #155724;">
                            <input type="checkbox" id="applyStartDateChange">
                            ì‹œì‘ì¼ ì¼ê´„ ë³€ê²½
                        </label>
                    </div>
                    <div class="quick-edit-row" id="startDateFields" style="display: none;">
                        <div class="quick-edit-field">
                            <label>ìƒˆ ì‹œì‘ì¼</label>
                            <input type="date" id="quickStartDate">
                        </div>
                    </div>

                    <!-- ì¢…ë£Œì¼ ìˆ˜ì • -->
                    <div class="bulk-apply-option" style="background: #f8d7da; border-left-color: #dc3545; margin-top: 15px;">
                        <label style="color: #721c24;">
                            <input type="checkbox" id="applyEndDateChange">
                            ì¢…ë£Œì¼ ì¼ê´„ ë³€ê²½
                        </label>
                    </div>
                    <div class="quick-edit-row" id="endDateFields" style="display: none;">
                        <div class="quick-edit-field">
                            <label>ìƒˆ ì¢…ë£Œì¼</label>
                            <input type="date" id="quickEndDate">
                        </div>
                        <div class="quick-edit-field">
                            <label style="visibility: hidden;">ë˜ëŠ”</label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 10px 0;">
                                <input type="checkbox" id="setUnlimited" style="width: 18px; height: 18px;">
                                ë¬´ê¸°í•œìœ¼ë¡œ ì„¤ì •
                            </label>
                        </div>
                    </div>

                    <!-- ë‚ ì§œ ì—°ì¥ ì˜µì…˜ -->
                    <div class="date-extend-option" style="margin-top: 15px;">
                        <label>
                            <input type="checkbox" id="applyDateExtend" style="margin-right: 8px;">
                            ê¸°ì¡´ ì¢…ë£Œì¼ ê¸°ì¤€ Nì¼ ì—°ì¥
                        </label>
                        <div class="date-extend-row" id="dateExtendFields" style="display: none; margin-top: 10px;">
                            <span>ì¢…ë£Œì¼ì„</span>
                            <input type="number" id="extendDays" value="30" min="1" max="365">
                            <span>ì¼ ì—°ì¥</span>
                            <span style="color: #666; font-size: 12px; margin-left: 10px;">â€» 'ë¬´ê¸°í•œ' í”„ë¡œëª¨ì…˜ì€ ì œì™¸ë©ë‹ˆë‹¤</span>
                        </div>
                    </div>
                </div>

                <!-- ê¸°íƒ€ í•„ë“œ ì¼ê´„ ìˆ˜ì • -->
                <div class="quick-edit-section">
                    <div class="quick-edit-title">ğŸ”§ ê¸°íƒ€ í•„ë“œ ì¼ê´„ ìˆ˜ì •</div>
                    <div class="quick-edit-row">
                        <div class="quick-edit-field">
                            <label>ì±„ë„ (ë¹„ì›Œë‘ë©´ ë³€ê²½ ì•ˆí•¨)</label>
                            <input type="text" id="quickChannel" placeholder="ì˜ˆ: ì „ì‚¬, ë¼ìš´ì§€">
                        </div>
                        <div class="quick-edit-field">
                            <label>ëŒ€ë¶„ë¥˜ (ë¹„ì›Œë‘ë©´ ë³€ê²½ ì•ˆí•¨)</label>
                            <input type="text" id="quickCategory" placeholder="ì˜ˆ: í”¼ë¶€ê´€ë¦¬">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="bulk-edit-actions">
            <div style="color: #666; font-size: 13px;">
                ğŸ’¡ ë³€ê²½ì‚¬í•­ì€ ì €ì¥ ë²„íŠ¼ì„ í´ë¦­í•´ì•¼ ì ìš©ë©ë‹ˆë‹¤
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-secondary" onclick="closeBulkEditModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="saveBulkEdit()">âœ… ë³€ê²½ì‚¬í•­ ì €ì¥</button>
            </div>
        </div>
    </div>
</div>

<script>
let bulkEditData = []; // ì„ íƒëœ í”„ë¡œëª¨ì…˜ ë°ì´í„°
let bulkEditMode = 'full'; // 'full' ë˜ëŠ” 'quick'

// ì¼ê´„ ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
function openBulkEditModal() {
    const selectedIds = getSelectedPromotionIds();
    if (selectedIds.length === 0) {
        showSimpleToast('ì•Œë¦¼', 'ìˆ˜ì •í•  í”„ë¡œëª¨ì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”', 'warning');
        return;
    }

    // ì„ íƒëœ í”„ë¡œëª¨ì…˜ ë°ì´í„° ë¡œë“œ
    bulkEditData = allPromotions.filter(p => selectedIds.includes(p.id));

    document.getElementById('bulkEditCount').textContent = bulkEditData.length;
    renderBulkEditPreviewList();
    renderBulkEditTable();

    document.getElementById('bulkEditModal').classList.add('show');

    // íƒ­ ì´ˆê¸°í™”
    switchBulkEditTab('full');
}

// ì¼ê´„ ìˆ˜ì • ëª¨ë‹¬ ë‹«ê¸°
function closeBulkEditModal() {
    document.getElementById('bulkEditModal').classList.remove('show');
    bulkEditData = [];
    bulkEditMode = 'full';

    // ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
    resetQuickEditFields();
}

// ë¹ ë¥¸ ìˆ˜ì • í•„ë“œ ì´ˆê¸°í™”
function resetQuickEditFields() {
    document.getElementById('applyStatusChange').checked = false;
    document.getElementById('applyStartDateChange').checked = false;
    document.getElementById('applyEndDateChange').checked = false;
    document.getElementById('applyDateExtend').checked = false;
    document.getElementById('setUnlimited').checked = false;
    document.getElementById('statusChangeFields').style.display = 'none';
    document.getElementById('startDateFields').style.display = 'none';
    document.getElementById('endDateFields').style.display = 'none';
    document.getElementById('dateExtendFields').style.display = 'none';
    document.getElementById('quickStatusSelect').value = '';
    document.getElementById('quickExtendDate').value = '';
    document.getElementById('quickStartDate').value = '';
    document.getElementById('quickEndDate').value = '';
    document.getElementById('quickChannel').value = '';
    document.getElementById('quickCategory').value = '';
    document.getElementById('extendDays').value = '30';
}

// íƒ­ ì „í™˜
function switchBulkEditTab(mode) {
    bulkEditMode = mode;

    const fullTab = document.getElementById('fullEditTab');
    const quickTab = document.getElementById('quickEditTab');
    const fullContent = document.getElementById('fullEditContent');
    const quickContent = document.getElementById('quickEditContent');

    if (mode === 'full') {
        fullTab.classList.add('active');
        quickTab.classList.remove('active');
        fullContent.classList.add('active');
        quickContent.classList.remove('active');
    } else {
        quickTab.classList.add('active');
        fullTab.classList.remove('active');
        quickContent.classList.add('active');
        fullContent.classList.remove('active');
    }
}

// ì„ íƒ í•­ëª© ë¯¸ë¦¬ë³´ê¸° í† ê¸€
function togglePreviewList() {
    const list = document.getElementById('bulkEditPreviewList');
    list.style.display = list.style.display === 'none' ? 'block' : 'none';
}

// ë¯¸ë¦¬ë³´ê¸° ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
function renderBulkEditPreviewList() {
    const container = document.getElementById('bulkEditPreviewList');
    container.innerHTML = bulkEditData.map(p => `
        <div class="preview-list-item">
            <div>
                <div class="item-name">${escapeHtml(p.promotion_name)}</div>
                <div class="item-detail">${escapeHtml(p.product_name)} | ${escapeHtml(p.channel)} | ${p.start_date} ~ ${p.end_date}</div>
            </div>
        </div>
    `).join('');
}

// ì „ì²´ ìˆ˜ì • í…Œì´ë¸” ë Œë”ë§
function renderBulkEditTable() {
    const tbody = document.getElementById('bulkEditTableBody');
    tbody.innerHTML = bulkEditData.map((p, idx) => `
        <tr data-id="${p.id}" data-index="${idx}">
            <td style="text-align: center; font-weight: bold;">${idx + 1}</td>
            <td><input type="text" value="${escapeHtml(p.category || '')}" data-field="category"></td>
            <td><input type="text" value="${escapeHtml(p.product_name)}" data-field="product_name"></td>
            <td><input type="text" value="${escapeHtml(p.channel)}" data-field="channel"></td>
            <td><input type="text" value="${escapeHtml(p.promotion_name)}" data-field="promotion_name"></td>
            <td><input type="text" value="${escapeHtml(p.discount_amount || '')}" data-field="discount_amount"></td>
            <td><input type="text" value="${escapeHtml(p.session_exemption || '')}" data-field="session_exemption"></td>
            <td><input type="text" value="${(p.subscription_types || []).join(',')}" data-field="subscription_types"></td>
            <td><input type="text" value="${escapeHtml(p.promotion_code || '')}" data-field="promotion_code"></td>
            <td><textarea data-field="content">${escapeHtml(p.content)}</textarea></td>
            <td><input type="date" value="${p.start_date}" data-field="start_date"></td>
            <td><input type="text" value="${p.end_date}" data-field="end_date" placeholder="ë¬´ê¸°í•œ"></td>
        </tr>
    `).join('');
}

// ì²´í¬ë°•ìŠ¤ ë³€ê²½ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
document.addEventListener('DOMContentLoaded', function() {
    // ìƒíƒœ ë³€ê²½ ì²´í¬ë°•ìŠ¤
    const applyStatusChange = document.getElementById('applyStatusChange');
    if (applyStatusChange) {
        applyStatusChange.addEventListener('change', function() {
            document.getElementById('statusChangeFields').style.display = this.checked ? 'flex' : 'none';
        });
    }

    // ìƒíƒœ ì„ íƒ ë³€ê²½
    const quickStatusSelect = document.getElementById('quickStatusSelect');
    if (quickStatusSelect) {
        quickStatusSelect.addEventListener('change', function() {
            document.getElementById('extendDateField').style.display = this.value === 'active' ? 'block' : 'none';
        });
    }

    // ì‹œì‘ì¼ ë³€ê²½ ì²´í¬ë°•ìŠ¤
    const applyStartDateChange = document.getElementById('applyStartDateChange');
    if (applyStartDateChange) {
        applyStartDateChange.addEventListener('change', function() {
            document.getElementById('startDateFields').style.display = this.checked ? 'flex' : 'none';
        });
    }

    // ì¢…ë£Œì¼ ë³€ê²½ ì²´í¬ë°•ìŠ¤
    const applyEndDateChange = document.getElementById('applyEndDateChange');
    if (applyEndDateChange) {
        applyEndDateChange.addEventListener('change', function() {
            document.getElementById('endDateFields').style.display = this.checked ? 'flex' : 'none';
        });
    }

    // ë‚ ì§œ ì—°ì¥ ì²´í¬ë°•ìŠ¤
    const applyDateExtend = document.getElementById('applyDateExtend');
    if (applyDateExtend) {
        applyDateExtend.addEventListener('change', function() {
            document.getElementById('dateExtendFields').style.display = this.checked ? 'flex' : 'none';
        });
    }

    // ë¬´ê¸°í•œ ì²´í¬ë°•ìŠ¤
    const setUnlimited = document.getElementById('setUnlimited');
    if (setUnlimited) {
        setUnlimited.addEventListener('change', function() {
            document.getElementById('quickEndDate').disabled = this.checked;
            if (this.checked) {
                document.getElementById('quickEndDate').value = '';
            }
        });
    }

    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    const bulkEditModal = document.getElementById('bulkEditModal');
    if (bulkEditModal) {
        bulkEditModal.addEventListener('click', function(e) {
            if (e.target === bulkEditModal) {
                closeBulkEditModal();
            }
        });
    }
});

// ì¼ê´„ ìˆ˜ì • ì €ì¥
async function saveBulkEdit() {
    let updateData = [];

    if (bulkEditMode === 'full') {
        // ì „ì²´ ìˆ˜ì • ëª¨ë“œ: í…Œì´ë¸”ì—ì„œ ë°ì´í„° ìˆ˜ì§‘
        const rows = document.querySelectorAll('#bulkEditTableBody tr');
        rows.forEach(row => {
            const id = parseInt(row.dataset.id);
            const data = { id };

            row.querySelectorAll('input, textarea').forEach(input => {
                const field = input.dataset.field;
                let value = input.value;

                if (field === 'subscription_types') {
                    value = value.split(',').map(t => t.trim()).filter(t => t);
                }

                data[field] = value;
            });

            updateData.push(data);
        });
    } else {
        // ë¹ ë¥¸ ìˆ˜ì • ëª¨ë“œ: ì„ íƒëœ ì˜µì…˜ì— ë”°ë¼ ì—…ë°ì´íŠ¸
        const updates = {};

        // ìƒíƒœ ë³€ê²½
        if (document.getElementById('applyStatusChange').checked) {
            const status = document.getElementById('quickStatusSelect').value;
            if (status === 'active') {
                const extendDate = document.getElementById('quickExtendDate').value;
                if (extendDate) {
                    updates.end_date = extendDate;
                }
            } else if (status === 'expired') {
                const today = new Date().toISOString().split('T')[0];
                updates.end_date = today;
            } else if (status === 'unlimited') {
                updates.end_date = 'ë¬´ê¸°í•œ';
            }
        }

        // ì‹œì‘ì¼ ë³€ê²½
        if (document.getElementById('applyStartDateChange').checked) {
            const startDate = document.getElementById('quickStartDate').value;
            if (startDate) {
                updates.start_date = startDate;
            }
        }

        // ì¢…ë£Œì¼ ë³€ê²½
        if (document.getElementById('applyEndDateChange').checked) {
            if (document.getElementById('setUnlimited').checked) {
                updates.end_date = 'ë¬´ê¸°í•œ';
            } else {
                const endDate = document.getElementById('quickEndDate').value;
                if (endDate) {
                    updates.end_date = endDate;
                }
            }
        }

        // ë‚ ì§œ ì—°ì¥
        if (document.getElementById('applyDateExtend').checked) {
            const extendDays = parseInt(document.getElementById('extendDays').value) || 0;
            if (extendDays > 0) {
                updates.extend_days = extendDays;
            }
        }

        // ì±„ë„/ëŒ€ë¶„ë¥˜ ë³€ê²½
        const channel = document.getElementById('quickChannel').value.trim();
        const category = document.getElementById('quickCategory').value.trim();
        if (channel) updates.channel = channel;
        if (category) updates.category = category;

        // ëª¨ë“  ì„ íƒëœ í”„ë¡œëª¨ì…˜ì— ì—…ë°ì´íŠ¸ ì ìš©
        bulkEditData.forEach(p => {
            const data = { id: p.id, ...updates };
            updateData.push(data);
        });
    }

    if (updateData.length === 0) {
        showSimpleToast('ì•Œë¦¼', 'ë³€ê²½í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤', 'warning');
        return;
    }

    if (!confirm(`${updateData.length}ê°œì˜ í”„ë¡œëª¨ì…˜ì„ ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        return;
    }

    try {
        const response = await fetch('/api/promotions/bulk-update', {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ promotions: updateData, mode: bulkEditMode })
        });

        const result = await response.json();

        if (response.ok) {
            showSimpleToast('ì„±ê³µ', result.message || 'í”„ë¡œëª¨ì…˜ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            closeBulkEditModal();
            clearAllSelections();
            loadPromotions();
        } else {
            showSimpleToast('ì˜¤ë¥˜', result.error || 'ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
        }
    } catch (error) {
        console.error('ì¼ê´„ ìˆ˜ì • ì‹¤íŒ¨:', error);
        showSimpleToast('ì˜¤ë¥˜', 'ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
    }
}

// ì¼ê´„ ì‚­ì œ
async function bulkDeletePromotions() {
    const selectedIds = getSelectedPromotionIds();
    if (selectedIds.length === 0) {
        showSimpleToast('ì•Œë¦¼', 'ì‚­ì œí•  í”„ë¡œëª¨ì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”', 'warning');
        return;
    }

    if (!confirm(`ì •ë§ ${selectedIds.length}ê°œì˜ í”„ë¡œëª¨ì…˜ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
        return;
    }

    try {
        const response = await fetch('/api/promotions/bulk-delete', {
            method: 'DELETE',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ ids: selectedIds })
        });

        const result = await response.json();

        if (response.ok) {
            showSimpleToast('ì„±ê³µ', result.message || 'í”„ë¡œëª¨ì…˜ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            clearAllSelections();
            loadPromotions();
            loadFilters();
        } else {
            showSimpleToast('ì˜¤ë¥˜', result.error || 'ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
        }
    } catch (error) {
        console.error('ì¼ê´„ ì‚­ì œ ì‹¤íŒ¨:', error);
        showSimpleToast('ì˜¤ë¥˜', 'ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
    }
}
</script>
